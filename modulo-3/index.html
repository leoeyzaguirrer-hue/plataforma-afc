<!DOCTYPE html>
<html lang="es" data-theme="light">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>M√≥dulo 3 ‚Äî El Est√≠mulo ¬∑ AFC Praxis</title>
<link href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,wght@0,300;0,400;0,500;0,600;0,700;1,400&family=Space+Mono:wght@400;700&family=Fraunces:ital,opsz,wght@0,9..144,300;0,9..144,600;0,9..144,700;1,9..144,400&display=swap" rel="stylesheet">
<style>
:root,[data-theme="light"]{--bg:#f0f4f8;--bg2:#f7f9fc;--card:#fff;--card2:#f4f7fa;--text:#334155;--dim:#64748b;--bright:#0f172a;--muted:#94a3b8;--accent:#0891b2;--accent-b:#22d3ee;--accent-g:rgba(8,145,178,0.06);--accent-l:#cffafe;--gold:#d97706;--gold-b:#f59e0b;--gold-g:rgba(217,119,6,0.06);--green:#059669;--green-b:#10b981;--green-g:rgba(5,150,105,0.06);--red:#dc2626;--red-b:#ef4444;--red-g:rgba(220,38,38,0.05);--purple:#7c3aed;--purple-g:rgba(124,58,237,0.05);--border:rgba(15,23,42,0.08);--border2:rgba(15,23,42,0.04);--shadow:0 2px 8px rgba(0,0,0,0.06);--shadow-lg:0 8px 30px rgba(0,0,0,0.08);--overlay:rgba(255,255,255,0.92);--r:14px;--rs:10px}
[data-theme="dark"]{--bg:#0f172a;--bg2:#1e293b;--card:#1e293b;--card2:#334155;--text:#cbd5e1;--dim:#94a3b8;--bright:#f1f5f9;--muted:#64748b;--accent:#22d3ee;--accent-b:#67e8f9;--accent-g:rgba(34,211,238,0.1);--accent-l:#164e63;--gold:#fbbf24;--gold-b:#fcd34d;--gold-g:rgba(251,191,36,0.08);--green:#34d399;--green-b:#6ee7b7;--green-g:rgba(52,211,153,0.08);--red:#f87171;--red-b:#fca5a5;--red-g:rgba(248,113,113,0.08);--purple:#a78bfa;--purple-g:rgba(167,139,250,0.08);--border:rgba(148,163,184,0.12);--border2:rgba(148,163,184,0.06);--shadow:0 2px 8px rgba(0,0,0,0.2);--shadow-lg:0 8px 30px rgba(0,0,0,0.3);--overlay:rgba(15,23,42,0.95);--r:14px;--rs:10px}
*{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent}:focus-visible{outline:2px solid var(--accent);outline-offset:2px;border-radius:4px}html,body{height:100%;overflow:hidden;background:var(--bg);color:var(--text);font-family:'DM Sans',system-ui,sans-serif;font-size:18px;line-height:1.65;transition:background .3s,color .3s}.app{position:fixed;inset:0;display:flex;flex-direction:column;z-index:1}
.top{display:flex;align-items:center;gap:10px;padding:10px 16px;height:56px;background:var(--overlay);backdrop-filter:blur(12px);-webkit-backdrop-filter:blur(12px);border-bottom:1px solid var(--border);flex-shrink:0;z-index:20}.top-back{width:38px;height:38px;border-radius:10px;background:var(--bg);border:1px solid var(--border);color:var(--accent);display:flex;align-items:center;justify-content:center;cursor:pointer;transition:all .15s;flex-shrink:0}.top-back:hover{background:var(--accent-g);border-color:var(--accent)}.top-back svg{width:18px;height:18px;stroke:currentColor;fill:none;stroke-width:2.5;stroke-linecap:round;stroke-linejoin:round}.top-t{font-family:'Fraunces',serif;font-size:16px;font-weight:600;color:var(--bright);line-height:1.2}.top-s{font-size:12px;color:var(--dim)}.top-prog{margin-left:auto;display:flex;align-items:center;gap:6px;flex-shrink:0}.top-prog-bar{width:52px;height:5px;border-radius:3px;background:var(--border);overflow:hidden}.top-prog-fill{height:100%;background:var(--accent);border-radius:3px;transition:width .4s}.top-prog-pct{font-family:'Space Mono',monospace;font-size:11px;color:var(--dim)}.top-acts{display:flex;gap:4px;flex-shrink:0}.top-btn{width:36px;height:36px;border-radius:8px;background:transparent;border:1px solid var(--border);color:var(--dim);display:flex;align-items:center;justify-content:center;cursor:pointer;transition:all .15s}.top-btn:hover{color:var(--accent);border-color:var(--accent);background:var(--accent-g)}.top-btn svg{width:16px;height:16px;stroke:currentColor;fill:none;stroke-width:2}
.cnt{flex:1;overflow-y:auto;overflow-x:hidden;padding:20px 16px 110px;-webkit-overflow-scrolling:touch}.cnt::-webkit-scrollbar{width:3px}.cnt::-webkit-scrollbar-thumb{background:var(--border);border-radius:3px}.bot{position:fixed;bottom:0;left:0;right:0;padding:10px 16px;padding-bottom:max(10px,env(safe-area-inset-bottom));background:var(--overlay);backdrop-filter:blur(12px);border-top:1px solid var(--border2);z-index:20;display:flex;gap:8px}
.btn{flex:1;padding:14px 20px;border-radius:var(--rs);font-family:'DM Sans',sans-serif;font-size:16px;font-weight:600;border:none;cursor:pointer;transition:all .15s;text-align:center;display:inline-flex;align-items:center;justify-content:center;gap:6px}.btn:active{transform:scale(0.97)}.btn-p{background:var(--accent);color:#fff;box-shadow:0 2px 10px rgba(8,145,178,0.2)}.btn-p:disabled{opacity:.35;pointer-events:none}.btn-g{background:var(--green);color:#fff}.btn-o{background:var(--card);color:var(--text);border:1px solid var(--border);flex:none}.btn-w{background:var(--gold);color:#fff}.btn-sm{flex:none;padding:10px 16px;font-size:14px}.btn-icon{flex:none;width:44px;padding:0}
.card{background:var(--card);border:1px solid var(--border);border-radius:var(--r);padding:22px;margin-bottom:14px;box-shadow:var(--shadow)}.tag{font-family:'Space Mono',monospace;font-size:11px;text-transform:uppercase;letter-spacing:1px;display:inline-flex;align-items:center;gap:5px;padding:4px 10px;border-radius:6px;margin-bottom:10px}.tag-b{color:var(--accent);background:var(--accent-g)}.tag-g{color:var(--gold);background:var(--gold-g)}.tag-gr{color:var(--green);background:var(--green-g)}.tag-p{color:var(--purple);background:var(--purple-g)}.card-t{font-family:'Fraunces',serif;font-size:22px;font-weight:700;color:var(--bright);line-height:1.3;margin-bottom:6px}.card-d{font-size:16px;color:var(--dim);line-height:1.6}
.prose{font-size:16px;color:var(--text);line-height:1.75}.prose p{margin-bottom:10px}.prose b,.prose strong{color:var(--bright)}.callout{background:var(--accent-g);border-left:3px solid var(--accent);padding:14px 16px;border-radius:0 var(--rs) var(--rs) 0;margin:12px 0;font-size:15px;color:var(--bright);line-height:1.65}.callout em{color:var(--accent);font-style:normal;font-weight:600}.callout-g{background:var(--gold-g);border-color:var(--gold)}.callout-g em{color:var(--gold)}.ex-box{background:var(--bg2);border:1px solid var(--border);border-radius:var(--rs);padding:14px 16px;margin:12px 0}.ex-box-l{font-size:11px;font-weight:700;color:var(--accent);text-transform:uppercase;letter-spacing:.8px;margin-bottom:4px}.ex-box p{font-size:15px;color:var(--text);margin:0;line-height:1.6}
.acc{border:1px solid var(--border);border-radius:var(--rs);margin-bottom:8px;overflow:hidden;background:var(--card)}.acc-h{display:flex;align-items:center;gap:10px;padding:14px 16px;cursor:pointer;user-select:none}.acc-i{width:30px;height:30px;border-radius:8px;display:flex;align-items:center;justify-content:center;font-size:16px;flex-shrink:0}.acc-l{font-weight:600;font-size:16px;color:var(--bright);flex:1}.acc-a{font-size:10px;color:var(--muted);transition:transform .3s}.acc.open .acc-a{transform:rotate(180deg)}.acc-b{max-height:0;overflow:hidden;transition:max-height .4s ease}.acc.open .acc-b{max-height:2000px}.acc-in{padding:0 16px 16px}
.tp-overlay{position:fixed;inset:0;background:rgba(0,0,0,0.3);z-index:25;display:none}.tp-overlay.open{display:block}.tp{position:fixed;top:56px;right:0;bottom:0;width:88%;max-width:420px;background:var(--card);border-left:1px solid var(--border);z-index:30;overflow-y:auto;padding:20px;box-shadow:-4px 0 20px rgba(0,0,0,0.1);display:none}.tp.open{display:block}.tp-close{position:absolute;top:12px;right:12px;cursor:pointer;font-size:22px;color:var(--dim);background:none;border:none}
.tip{position:relative;border-bottom:1.5px dashed var(--accent);cursor:help;color:var(--accent);font-weight:500}.tip::after{content:attr(data-tip);position:absolute;bottom:calc(100% + 6px);left:50%;transform:translateX(-50%);background:var(--bright);color:var(--bg);padding:8px 12px;border-radius:8px;font-size:13px;font-weight:400;line-height:1.5;white-space:normal;width:240px;z-index:50;box-shadow:var(--shadow-lg);pointer-events:none;opacity:0;transition:opacity .2s}.tip:hover::after,.tip:focus::after{opacity:1}@media(max-width:640px){.tip::after{left:0;transform:none;width:200px}}
.lcard{display:flex;align-items:center;gap:14px;background:var(--card);border:1.5px solid var(--border);border-radius:var(--r);padding:16px 18px;margin-bottom:10px;cursor:pointer;transition:all .2s;box-shadow:var(--shadow)}.lcard:hover:not(.locked){border-color:rgba(8,145,178,0.2);box-shadow:var(--shadow-lg)}.lcard:active:not(.locked){transform:scale(0.98)}.lcard.locked{opacity:.35;pointer-events:none}.lcard.done{border-color:rgba(5,150,105,0.2)}.lcard-icon{width:50px;height:50px;border-radius:14px;display:flex;align-items:center;justify-content:center;font-size:24px;flex-shrink:0}.lcard.done .lcard-icon{background:var(--green-g)!important}.lcard-name{font-weight:600;font-size:16px;color:var(--bright);margin-bottom:2px}.lcard-sub{font-size:13px;color:var(--dim)}.lcard-arrow{color:var(--muted);margin-left:auto;font-size:20px}.lbar{width:100%;height:4px;border-radius:2px;background:var(--border);margin-top:6px;overflow:hidden}.lbar-f{height:100%;border-radius:2px;transition:width .4s}
.pips{display:flex;align-items:center;gap:3px;justify-content:center;margin-bottom:16px;flex-wrap:wrap}.pip{width:18px;height:5px;border-radius:3px;background:var(--border);transition:all .3s}.pip.ok{background:var(--green)}.pip.fail{background:var(--red)}.pip.cur{background:var(--accent);width:26px}
.q-h{display:flex;align-items:center;gap:8px;margin-bottom:8px}.q-type{font-size:22px}.q-tag{font-family:'Space Mono',monospace;font-size:10px;text-transform:uppercase;letter-spacing:1px;color:var(--accent);padding:3px 8px;background:var(--accent-g);border-radius:4px}.q-n{font-family:'Space Mono',monospace;font-size:11px;color:var(--muted);margin-left:auto}.q-text{font-size:18px;font-weight:500;color:var(--bright);margin-bottom:16px;line-height:1.55}.q-ctx{font-size:15px;color:var(--dim);font-style:italic;margin-bottom:14px;padding:12px 14px;background:var(--bg2);border-radius:var(--rs);border-left:3px solid var(--border)}
.opt{display:flex;align-items:flex-start;gap:12px;padding:14px 16px;border:1.5px solid var(--border);border-radius:var(--rs);margin-bottom:7px;cursor:pointer;transition:all .2s;user-select:none}.opt:active{transform:scale(0.98)}.opt:hover:not(.dis){background:var(--bg2)}.opt.pick{border-color:var(--accent);background:var(--accent-g)}.opt.ok{border-color:var(--green);background:var(--green-g)}.opt.bad{border-color:var(--red);background:var(--red-g)}.opt.rev{border-color:var(--green);background:var(--green-g);opacity:.5}.opt.dis{pointer-events:none}.opt-m{width:24px;height:24px;border-radius:50%;border:2px solid var(--border);display:flex;align-items:center;justify-content:center;flex-shrink:0;font-size:12px;font-weight:700;color:var(--muted);transition:all .2s}.opt.pick .opt-m{border-color:var(--accent);color:var(--accent);background:var(--accent-g)}.opt.ok .opt-m{border-color:var(--green);color:#fff;background:var(--green)}.opt.bad .opt-m{border-color:var(--red);color:#fff;background:var(--red)}.opt-m.chk{border-radius:6px}.opt-t{font-size:16px;color:var(--text);line-height:1.5;flex:1}
.tf{display:flex;gap:10px;margin-bottom:8px}.tf-b{flex:1;padding:18px;border:2px solid var(--border);border-radius:var(--rs);font-size:18px;font-weight:600;text-align:center;cursor:pointer;transition:all .15s;background:var(--card);color:var(--text)}.tf-b:active{transform:scale(0.97)}.tf-b:hover:not(.dis){border-color:var(--accent);background:var(--accent-g)}.tf-b.ok{border-color:var(--green);background:var(--green-g);color:var(--green)}.tf-b.bad{border-color:var(--red);background:var(--red-g);color:var(--red)}.tf-b.dis{pointer-events:none}
.cl-cats{display:flex;gap:8px;flex-wrap:wrap}.cl-c{padding:10px 18px;border-radius:8px;font-size:15px;font-weight:500;border:1.5px solid var(--border);background:var(--card);color:var(--text);cursor:pointer;transition:all .15s}.cl-c:active{transform:scale(0.96)}.cl-c.ok{border-color:var(--green);background:var(--green-g);color:var(--green)}.cl-c.bad{border-color:var(--red);background:var(--red-g);color:var(--red)}.cl-c.dis{pointer-events:none}
.mat-w{display:flex;gap:12px;align-items:flex-start;margin-bottom:12px}.mat-c{flex:1;display:flex;flex-direction:column;gap:6px}.mat-i{padding:12px;border-radius:var(--rs);font-size:14px;border:1.5px solid var(--border);background:var(--card);color:var(--text);cursor:pointer;transition:all .15s;text-align:center}.mat-i:hover:not(.dis){border-color:var(--accent)}.mat-i.sel{border-color:var(--accent);background:var(--accent-g);color:var(--accent)}.mat-i.ok{border-color:var(--green);background:var(--green-g);color:var(--green)}.mat-i.bad{border-color:var(--red);background:var(--red-g);color:var(--red)}.mat-i.dis{pointer-events:none}
.pat{background:var(--card);border:1.5px solid rgba(217,119,6,0.15);border-radius:var(--r);padding:18px;margin-bottom:14px;box-shadow:0 2px 10px rgba(217,119,6,0.04)}.pat-h{display:flex;align-items:center;gap:12px;margin-bottom:12px}.pat-av{width:48px;height:48px;border-radius:14px;display:flex;align-items:center;justify-content:center;font-size:20px;font-weight:700;color:#fff;flex-shrink:0}.pat-av.f{background:linear-gradient(135deg,#db2777,#f472b6)}.pat-av.m{background:linear-gradient(135deg,#2563eb,#60a5fa)}.pat-av.c{background:linear-gradient(135deg,#d97706,#fbbf24)}.pat-name{font-family:'Fraunces',serif;font-size:18px;font-weight:700;color:var(--bright)}.pat-age{font-size:12px;color:var(--dim)}.pat-badge{font-family:'Space Mono',monospace;font-size:9px;text-transform:uppercase;letter-spacing:.8px;padding:3px 8px;border-radius:4px;background:var(--gold-g);color:var(--gold);border:1px solid rgba(217,119,6,0.12);margin-left:auto}.pat-q{font-size:16px;font-style:italic;color:var(--text);line-height:1.65;padding:12px 14px;background:var(--bg2);border-radius:var(--rs);border-left:3px solid var(--gold)}
.fb{padding:14px 16px;border-radius:var(--rs);margin-top:12px;font-size:15px;line-height:1.6;display:none}.fb.show{display:block;animation:fbIn .3s ease}@keyframes fbIn{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}.fb.fbok{background:var(--green-g);border:1px solid rgba(5,150,105,0.15);color:var(--green)}.fb.fbfail{background:var(--red-g);border:1px solid rgba(220,38,38,0.1);color:var(--red)}[data-theme="dark"] .fb.fbok{color:var(--green-b)}[data-theme="dark"] .fb.fbfail{color:var(--red-b)}.fb strong{display:block;margin-bottom:3px;font-size:14px}
.gate{text-align:center;padding:20px}.gate-ic{font-size:52px;margin-bottom:10px}.gate-t{font-family:'Fraunces',serif;font-size:24px;font-weight:700;color:var(--bright);margin-bottom:6px}.gate-d{font-size:15px;color:var(--dim);margin-bottom:16px;max-width:320px;margin-left:auto;margin-right:auto}.gate-bar{width:200px;height:8px;border-radius:4px;background:var(--border);margin:0 auto 8px;overflow:hidden}.gate-bar-f{height:100%;border-radius:4px}.gate-sc{font-family:'Space Mono',monospace;font-size:15px;font-weight:700;margin-bottom:16px}
.sum-c{width:130px;height:130px;border-radius:50%;border:5px solid var(--border);display:flex;flex-direction:column;align-items:center;justify-content:center;margin:16px auto}.sum-c.great{border-color:var(--green)}.sum-c.mid{border-color:var(--gold)}.sum-c.low{border-color:var(--red)}.sum-n{font-family:'Space Mono',monospace;font-size:40px;font-weight:700;color:var(--bright)}.sum-t{font-size:13px;color:var(--dim)}.sum-msg{text-align:center;font-family:'Fraunces',serif;font-size:22px;font-weight:600;color:var(--bright);margin:10px 0 4px}.sum-sub{text-align:center;font-size:14px;color:var(--dim);margin-bottom:14px}
.sk-grid{display:flex;flex-direction:column;gap:6px;margin:12px 0}.sk-r{display:flex;align-items:center;gap:8px;font-size:14px}.sk-name{flex:1;color:var(--text)}.sk-bar{width:80px;height:5px;border-radius:3px;background:var(--border);overflow:hidden}.sk-bar-f{height:100%;border-radius:3px}.sk-pct{font-family:'Space Mono',monospace;font-size:12px;font-weight:700;width:36px;text-align:right}
.rev{background:var(--red-g);border:1px solid rgba(220,38,38,0.08);border-radius:var(--rs);padding:10px 12px;margin-bottom:6px}.rev-q{font-size:14px;color:var(--bright);margin-bottom:3px}.rev-a{font-size:13px;color:var(--green)}
.cheat{background:var(--card);border:1.5px solid var(--accent);border-radius:var(--r);padding:18px;margin-top:14px}.cheat-t{font-family:'Fraunces',serif;font-size:16px;font-weight:700;color:var(--accent);margin-bottom:8px}.cheat-i{font-size:14px;color:var(--text);padding:5px 0;border-bottom:1px solid var(--border2)}
.ring{position:relative;display:inline-flex;align-items:center;justify-content:center}.ring svg{transform:rotate(-90deg)}.ring-v{position:absolute;font-family:'Space Mono',monospace;font-size:20px;font-weight:700;color:var(--bright)}
@keyframes up{from{opacity:0;transform:translateY(14px)}to{opacity:1;transform:translateY(0)}}.anim{animation:up .35s ease forwards}.d1{animation-delay:.06s;opacity:0}.d2{animation-delay:.12s;opacity:0}.d3{animation-delay:.18s;opacity:0}@keyframes shake{0%,100%{transform:translateX(0)}25%{transform:translateX(-5px)}75%{transform:translateX(5px)}}.shake{animation:shake .35s ease}@keyframes confDrop{0%{transform:translateY(-20px) rotate(0);opacity:1}100%{transform:translateY(50vh) rotate(720deg);opacity:0}}
@media(min-width:640px){body{font-size:18px}.cnt{padding:24px 24px 100px}.card{padding:24px 28px}}@media(min-width:768px){.app{max-width:700px;margin:0 auto;left:50%;transform:translateX(-50%);right:auto;width:100%;border-left:1px solid var(--border2);border-right:1px solid var(--border2)}.top,.bot{max-width:700px;left:50%;transform:translateX(-50%);right:auto;width:100%}.cnt{padding:28px 32px 110px}}@media(min-width:1024px){.app{max-width:780px}.top,.bot{max-width:780px}body{font-size:19px}}
</style>
</head>
<body>
<div class="app" id="app"></div>
<div id="confWrap" style="position:fixed;top:0;left:0;right:0;height:50vh;pointer-events:none;z-index:999;overflow:hidden"></div>
<script>
const IC={back:'<svg viewBox="0 0 24 24"><polyline points="15 18 9 12 15 6"/></svg>',book:'<svg viewBox="0 0 24 24"><path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"/><path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"/></svg>',moon:'<svg viewBox="0 0 24 24"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/></svg>',sun:'<svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>',x:'<svg viewBox="0 0 24 24"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>',refresh:'<svg viewBox="0 0 24 24"><polyline points="23 4 23 10 17 10"/><path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"/></svg>'};
const MASTERY=0.8,SKEY='afcp_',LVL_N=['Morfolog√≠a','Funciones','Eventos privados','Est√≠mulo = funci√≥n','Casos cl√≠nicos'],LVL_E=['üì¶','‚ö°','üß†','üîë','üè•'],LVL_C=['var(--accent)','var(--gold)','var(--purple)','#059669','#db2777'];
let MOD=null,$a=null,S={view:'home',mod:'m3',level:0,exIdx:0,seqIdx:0,pool:[],answers:{},tpOpen:false},P={};
function sKey(){return SKEY+S.mod}function loadP(){try{const d=localStorage.getItem(sKey());if(d)P=JSON.parse(d)}catch(e){}if(!P.scores)P.scores={};if(!P.errors)P.errors={};if(!P.skills)P.skills={}}function saveP(){try{localStorage.setItem(sKey(),JSON.stringify(P))}catch(e){}}
function isDk(){return document.documentElement.getAttribute('data-theme')==='dark'}function togDk(){const h=document.documentElement,d=h.getAttribute('data-theme')==='dark'?'light':'dark';h.setAttribute('data-theme',d);localStorage.setItem(SKEY+'theme',d);render()}
(function(){const t=localStorage.getItem(SKEY+'theme');if(t)document.documentElement.setAttribute('data-theme',t)})();
const $=id=>document.getElementById(id);function shuffle(a){const r=[...a];for(let i=r.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[r[i],r[j]]=[r[j],r[i]]}return r}function fireConfetti(){const w=$('confWrap');const cols=['#059669','#0891b2','#d97706','#db2777','#7c3aed'];for(let i=0;i<20;i++){const c=document.createElement('div');c.style.cssText=`position:absolute;width:${4+Math.random()*6}px;height:${4+Math.random()*6}px;left:${Math.random()*100}%;background:${cols[i%5]};border-radius:2px;animation:confDrop 1.2s ease-out ${Math.random()*0.3}s forwards;opacity:0;`;w.appendChild(c);setTimeout(()=>c.remove(),1600)}}

// ========== MODULE 3 DATA ‚Äî CONDUCTISMO RADICAL ==========
const MODULE={
id:'m3',phase:'Fase 2 ¬∑ Componentes',title:'El Est√≠mulo',
description:'Tipos de est√≠mulo (externo, encubierto), funciones (EI, EC, Ed, EŒî), eventos privados con funci√≥n estimular y el est√≠mulo como funci√≥n, no como cosa.',
icon:'‚ö°',color:'#d97706',colorB:'#f59e0b',
levels:[
// ===== NIVEL 1: Tipos morfol√≥gicos =====
{title:'Tipos de est√≠mulo por morfolog√≠a',description:'Externos y encubiertos ‚Äî de d√≥nde viene la estimulaci√≥n.',showCount:12,
cheat:['Est√≠mulo: parcela del ambiente que interact√∫a funcionalmente con una R','Externo: fuera del organismo (objetos, personas, situaciones)','Interno/encubierto: dentro del cuerpo (interoceptivo, propioceptivo)','Un evento privado puede tener funci√≥n de est√≠mulo para otras conductas','No todo lo presente en el entorno es funcionalmente relevante'],
theory:[
{icon:'üì¶',title:'¬øQu√© es un est√≠mulo?',color:'accent',body:'<p>"Est√≠mulo" es aquella parcela del ambiente de un individuo que <strong>interact√∫a de forma significativa</strong> con una respuesta. De esa parcela, las caracter√≠sticas que la hacen significativa son las que la convierten en <strong>funcional</strong>.</p><div class="callout"><em>Skinner:</em> "Las variables independientes ‚Äîlas causas de la conducta‚Äî son las condiciones externas de las que la conducta es funci√≥n." Pero como veremos, parte del ambiente est√° <b>dentro</b> del propio organismo.</div><p>En una habitaci√≥n llena de objetos, solo aquellos que interact√∫an funcionalmente con la respuesta que analizamos son est√≠mulos <b>para esa interacci√≥n</b>.</p>'},
{icon:'üåç',title:'Est√≠mulo externo',color:'gold',body:'<p>Todo lo que est√° <strong>fuera del organismo</strong> y tiene funci√≥n estimular: objetos, personas, situaciones, sonidos, olores, etc.</p><div class="ex-box"><div class="ex-box-l">Ejemplos</div><p>‚Ä¢ Un sem√°foro en rojo (visual)<br>‚Ä¢ La voz del jefe diciendo tu nombre (auditivo)<br>‚Ä¢ Un cartel de "rebajas" en una tienda<br>‚Ä¢ La presencia de un perro en la calle</p></div><p>Lo importante no es su aspecto f√≠sico, sino la <b>funci√≥n</b> que cumple para una persona concreta. El mismo objeto puede tener funciones distintas.</p>'},
{icon:'üíì',title:'Est√≠mulo interno / encubierto',color:'green',body:'<p>Estimulaci√≥n que proviene del <strong>propio organismo</strong>. Como dice Skinner (1953): "Una parte del universo es privada para cada individuo. No necesitamos suponer que los hechos que acontecen dentro de un organismo poseen propiedades especiales."</p><div class="ex-box"><div class="ex-box-l">Interoceptiva</div><p>De √≥rganos internos: hambre, n√°useas, opresi√≥n en el pecho, taquicardia.</p></div><div class="ex-box"><div class="ex-box-l">Propioceptiva</div><p>De posici√≥n y movimiento: tensi√≥n muscular, mareo, equilibrio.</p></div><div class="callout"><em>Clave:</em> Una RC como la taquicardia puede funcionar como <b>est√≠mulo interno</b> para otra conducta. Ej: notar la taquicardia ‚Üí "me va a dar un ataque" ‚Üí escapar. Los eventos privados siguen las mismas leyes que los p√∫blicos.</div>'},
{icon:'üîó',title:'La respuesta como est√≠mulo',color:'purple',body:'<p>En las cadenas conductuales, <b>cada respuesta sirve de est√≠mulo discriminativo para la siguiente</b>. Los est√≠mulos discriminativos pueden ser del ambiente externo, del propio cuerpo, o de la propia conducta del individuo.</p><div class="ex-box"><div class="ex-box-l">Ejemplo: cadena</div><p>Suena el despertador (E externo) ‚Üí te levantas (R‚ÇÅ) ‚Üí ver el ba√±o (E generado por R‚ÇÅ) ‚Üí ducharte (R‚ÇÇ) ‚Üí sentir limpieza (E interno) ‚Üí vestirte (R‚ÇÉ)...</p></div><p>Tambi√©n en la interacci√≥n social: la conducta del otro funciona como est√≠mulo discriminativo para la nuestra.</p>'}
],
exercises:[
{type:'tf',skill:'tipos_e',s:'Un est√≠mulo es cualquier objeto que est√© en el entorno del sujeto.',c:false,ok:'Solo es est√≠mulo la parcela del ambiente que interact√∫a de forma significativa con una respuesta. No todo lo presente es funcionalmente relevante.',fail:'Est√≠mulo = solo aquello que interact√∫a funcionalmente con la respuesta, no todo lo presente.'},
{type:'tf',skill:'tipos_e',s:'La taquicardia puede funcionar como est√≠mulo interno para otra conducta.',c:true,ok:'Una RC (taquicardia) puede tener funci√≥n de est√≠mulo antecedente para una operante. Los eventos privados pueden tener funci√≥n estimular.',fail:'S√≠: una respuesta fisiol√≥gica puede funcionar como est√≠mulo para otras conductas.'},
{type:'tf',skill:'tipos_e',s:'Los eventos que ocurren dentro del organismo tienen propiedades especiales distintas a los externos.',c:false,ok:'Skinner: "No necesitamos suponer que poseen propiedades especiales; se distinguen por su accesibilidad limitada, no por su naturaleza." Mismas leyes.',fail:'Skinner: se distinguen por accesibilidad, no por naturaleza. Mismas leyes de aprendizaje.'},
{type:'tf',skill:'tipos_e',s:'En una cadena conductual, cada respuesta puede funcionar como Ed para la siguiente.',c:true,ok:'En las cadenas conductuales, cada R genera est√≠mulos que funcionan como Ed para la R siguiente. As√≠ se enlazan secuencias complejas.',fail:'S√≠: R‚ÇÅ genera E que funciona como Ed para R‚ÇÇ, formando cadenas.'},
{type:'classify',skill:'tipos_e',categories:['üåç Externo','üíì Interno'],items:[
{text:'El cartel de "salida de emergencia" en un cine',cat:'üåç Externo'},
{text:'Opresi√≥n en el pecho antes de una entrevista',cat:'üíì Interno'},
{text:'El sonido del despertador por la ma√±ana',cat:'üåç Externo'},
{text:'Tensi√≥n muscular en los hombros',cat:'üíì Interno'},
{text:'La sonrisa de tu pareja al verte',cat:'üåç Externo'},
{text:'Sensaci√≥n de hambre a mediod√≠a',cat:'üíì Interno'}
]},
{type:'single',skill:'tipos_e',text:'üèÉ Tras subir escaleras, a Pedro le late fuerte el coraz√≥n. ¬øEs necesariamente un est√≠mulo?',opts:['S√≠, siempre es est√≠mulo','Solo si tiene funci√≥n para otra respuesta (ej: pensar "me pasa algo" ‚Üí ir al m√©dico)','Es est√≠mulo externo','Nunca es est√≠mulo'],c:1,ok:'La taquicardia por ejercicio es un hecho fisiol√≥gico. Solo ser√≠a est√≠mulo si tuviera funci√≥n para otra conducta, dependiendo de la historia de la persona.',fail:'Solo es est√≠mulo si interact√∫a funcionalmente con otra respuesta.'},
{type:'single',skill:'tipos_e',text:'üí¨ En la interacci√≥n social, ¬øqu√© funciona como est√≠mulo discriminativo para nuestra conducta?',opts:['Nuestros pensamientos √∫nicamente','El comportamiento del otro u otros','Solo los objetos del entorno','La personalidad del otro'],c:1,ok:'El comportamiento de los dem√°s funciona como Ed: sus gestos, palabras y acciones se√±alan cu√°ndo nuestra respuesta ser√° reforzada.',fail:'La conducta del otro = Ed para nuestra conducta social.'},
{type:'single',skill:'tipos_e',text:'üß† Seg√∫n el conductismo radical de Skinner, ¬øqu√© diferencia a un evento privado de uno p√∫blico?',opts:['Su naturaleza es completamente diferente','Solo su accesibilidad: es limitada para otros, pero sigue las mismas leyes','Los eventos privados son mentales, no conductuales','No pueden ser estudiados cient√≠ficamente'],c:1,ok:'Solo difieren en accesibilidad. Siguen las mismas leyes de aprendizaje. Son conducta que puede tener funci√≥n estimular.',fail:'Accesibilidad limitada, no naturaleza distinta. Mismos principios.'},
{type:'match',skill:'tipos_e',text:'Empareja cada tipo de estimulaci√≥n privada:',
pairs:[{left:'Dolor de est√≥mago',right:'Interoceptiva'},{left:'Sensaci√≥n de equilibrio al caminar',right:'Propioceptiva'},{left:'La voz de tu profesor',right:'Exteroceptiva'},{left:'Tensi√≥n en el cuello',right:'Propioceptiva'}],
ok:'Interoceptiva = √≥rganos. Propioceptiva = posici√≥n/movimiento. Exteroceptiva = fuera del cuerpo.'},
{type:'tf',skill:'tipos_e',s:'La estimulaci√≥n propioceptiva se refiere a los √≥rganos internos como el coraz√≥n.',c:false,ok:'Propioceptiva = posici√≥n y movimiento del cuerpo. Los √≥rganos internos son INTEROceptivos.',fail:'Propioceptiva = posici√≥n/movimiento. Interoceptiva = √≥rganos internos.'},
{type:'tf',skill:'tipos_e',s:'El ambiente, para Skinner, incluye tanto lo externo como lo que est√° dentro del organismo.',c:true,ok:'El ambiente es cualquier hecho del universo capaz de afectar al organismo, incluyendo el propio cuerpo. El percibirnos a nosotros mismos es parte del ambiente.',fail:'S√≠: "ambiente" incluye el propio cuerpo. Los eventos internos son parte del ambiente.'}
]},
// ===== NIVEL 2: Funciones del est√≠mulo =====
{title:'Funciones del est√≠mulo',description:'EI, EC, Ed, EŒî ‚Äî el papel que juega cada est√≠mulo en la relaci√≥n funcional.',showCount:12,
cheat:['EI: elicita respuesta innata (reflejo)','EC: elicita RC tras condicionamiento cl√°sico','Ed: se√±ala disponibilidad de refuerzo (evoca operante)','EŒî: se√±ala NO disponibilidad de refuerzo','La funci√≥n depende de la historia de reforzamiento individual'],
theory:[
{icon:'‚ö°',title:'Cuatro funciones principales',color:'accent',body:'<p>Un est√≠mulo puede cumplir diferentes <b>funciones</b> seg√∫n su relaci√≥n con la respuesta:</p><div class="ex-box"><div class="ex-box-l">1. EI ‚Äî Est√≠mulo Incondicionado</div><p>Suscita una respuesta innata (RI) sin aprendizaje. Ej: comida en boca ‚Üí salivaci√≥n.</p></div><div class="ex-box"><div class="ex-box-l">2. EC ‚Äî Est√≠mulo Condicionado</div><p>Tras asociarse con un EI, elicita una RC. Ej: bata blanca ‚Üí ansiedad (asociada a inyecciones).</p></div><div class="ex-box"><div class="ex-box-l">3. Ed ‚Äî Est√≠mulo Discriminativo</div><p>Se√±ala que si se emite la conducta, el reforzador estar√° disponible. <b>Evoca</b> la operante. Ej: luz verde ‚Üí cruzar.</p></div><div class="ex-box"><div class="ex-box-l">4. EŒî ‚Äî Est√≠mulo Delta</div><p>Se√±ala que el reforzador <b>NO</b> estar√° disponible. Ej: cartel de "cerrado" ‚Üí no entrar.</p></div>'},
{icon:'üî¨',title:'Relaci√≥n funcional, no causal',color:'gold',body:'<p>La relaci√≥n E-R-consecuencia es <strong>funcional</strong>. No hay eventos que por principio tengan valor de est√≠mulo o respuesta.</p><div class="callout"><em>Skinner:</em> La conducta operante est√° bajo el control de las consecuencias y de los Ed, pero lo que ambos afectan es la <b>probabilidad de respuesta</b>. No es causa-efecto lineal sino probabilidad condicional.</div><div class="ex-box"><div class="ex-box-l">Un perro para tres personas</div><p>‚Ä¢ Ana (mordida de ni√±a): EC ‚Üí miedo (RC)<br>‚Ä¢ Pedro (due√±o de mascotas): Ed ‚Üí acariciar (R+)<br>‚Ä¢ Luis (cartero): Ed ‚Üí retroceder (R-)<br><br>Mismo objeto. Tres funciones distintas. Tres historias diferentes.</p></div>'},
{icon:'üîó',title:'Ed vs EC: clave para el AFC',color:'green',body:'<p>EC ‚Üí <b>elicita</b> RC (respondiente, autom√°tica). El est√≠mulo provoca un cambio fisiol√≥gico/emocional.</p><p>Ed ‚Üí <b>evoca</b> RO (operante, emitida). El est√≠mulo se√±ala contingencia disponible.</p><div class="callout callout-g"><em>Modelo bifactorial:</em> El mismo est√≠mulo puede cumplir ambas funciones a la vez. Ver al jefe ‚Üí (EC) taquicardia + (Ed) hablar con cuidado. Esto es fundamental para entender las secuencias compuestas.</div>'}
],
exercises:[
{type:'tf',skill:'funciones_e',s:'El est√≠mulo discriminativo (Ed) provoca la respuesta de forma autom√°tica.',c:false,ok:'El Ed EVOCA (se√±ala, aumenta probabilidad) pero no provoca. La persona puede emitir o no la operante. Quien elicita autom√°ticamente es el EC.',fail:'Ed evoca (se√±ala). EC elicita (provoca). Diferencia crucial.'},
{type:'tf',skill:'funciones_e',s:'Un mismo objeto puede ser EC para una persona y Ed para otra.',c:true,ok:'La funci√≥n depende de la historia de reforzamiento individual. Un perro puede ser EC (‚Üí miedo) para uno y Ed (‚Üí acariciar) para otro.',fail:'S√≠: historia diferente = funci√≥n diferente del mismo objeto.'},
{type:'classify',skill:'funciones_e',categories:['üî¥ EC (elicita RC)','üîµ Ed (evoca RO)','üü° EŒî (no-refuerzo)'],items:[
{text:'Bata blanca ‚Üí taquicardia (fobia a agujas)',cat:'üî¥ EC (elicita RC)'},
{text:'Sem√°foro verde ‚Üí cruzar la calle',cat:'üîµ Ed (evoca RO)'},
{text:'Cartel de CERRADO ‚Üí no intentar entrar',cat:'üü° EŒî (no-refuerzo)'},
{text:'Olor del dentista ‚Üí sudoraci√≥n',cat:'üî¥ EC (elicita RC)'},
{text:'Profesor mir√°ndote ‚Üí levantar la mano',cat:'üîµ Ed (evoca RO)'},
{text:'Jefe de mal humor ‚Üí no pedir vacaciones',cat:'üü° EŒî (no-refuerzo)'}
]},
{type:'single',skill:'funciones_e',text:'üêï Laura fue mordida por un perro. Ahora al verlos: (A) se acelera su coraz√≥n, (B) cruza de acera. ¬øFunciones del perro?',opts:['EC para ambas','Ed para ambas','EC para (A) taquicardia, Ed para (B) cruzar','EI para (A), Ed para (B)'],c:2,ok:'Taquicardia = RC (el perro es EC). Cruzar = RO mantenida por R- (el perro es Ed). Doble funci√≥n: modelo bifactorial.',fail:'EC ‚Üí RC (taquicardia). Ed ‚Üí RO (cruzar). Mismo est√≠mulo, dos funciones.'},
{type:'single',skill:'funciones_e',text:'üè† Muchas personas inh√°biles socialmente tienen repertorio suficiente pero no lo emiten. ¬øQu√© les falta?',opts:['M√°s respuestas','Discriminar los Ed que se√±alan cu√°ndo responder','Inteligencia emocional','Motivaci√≥n'],c:1,ok:'No les falta repertorio sino discriminaci√≥n: no reconocen los Ed que se√±alan cu√°ndo su respuesta social ser√° reforzada.',fail:'Falta de discriminaci√≥n: no detectan los Ed del contexto social.'},
{type:'single',skill:'funciones_e',text:'üö´ Elena levanta la mano 5 veces y la profesora la ignora. Deja de hacerlo con ESA profesora. ¬øFunci√≥n de "esa profesora"?',opts:['EC ‚Üí miedo','Ed ‚Üí levantar la mano','EŒî ‚Üí no se refuerza levantar la mano','EI ‚Üí frustraci√≥n'],c:2,ok:'La profesora se convierte en EŒî: se√±ala que la conducta no producir√° refuerzo.',fail:'EŒî: se√±ala que la R no ser√° seguida de consecuencia reforzante.'},
{type:'single',skill:'funciones_e',text:'üíä Ver la consulta del m√©dico ‚Üí (A) ansiedad + (B) pedir cita. ¬øFunciones?',opts:['Solo EC','Solo Ed','EC para la ansiedad + Ed para pedir cita','EI para la ansiedad'],c:2,ok:'EC ‚Üí ansiedad (respondiente). Ed ‚Üí pedir cita (operante). Doble funci√≥n simult√°nea.',fail:'EC ‚Üí RC (ansiedad). Ed ‚Üí RO (pedir cita). Doble funci√≥n.'},
{type:'match',skill:'funciones_e',text:'Empareja funci√≥n con definici√≥n:',
pairs:[{left:'Elicita respuesta innata',right:'EI'},{left:'Elicita RC tras asociaci√≥n',right:'EC'},{left:'Se√±ala disponibilidad de refuerzo',right:'Ed'},{left:'Se√±ala NO disponibilidad',right:'EŒî'}],
ok:'EI=innato, EC=condicionado, Ed=refuerzo disponible, EŒî=no disponible.'},
{type:'tf',skill:'funciones_e',s:'La relaci√≥n E-R es causal directa: el est√≠mulo causa la respuesta.',c:false,ok:'Es relaci√≥n funcional: mayor probabilidad condicional, no determinismo causal. Skinner habla de "probabilidad de respuesta", no de causa-efecto.',fail:'Relaci√≥n funcional = probabilidad, no causa-efecto lineal.'},
{type:'tf',skill:'funciones_e',s:'La conducta social se basa en discriminar se√±ales (Ed) del contexto que indican cu√°ndo responder.',c:true,ok:'La mayor parte de la conducta social implica reconocer Ed (gestos, palabras, contexto) que se√±alan contingencias disponibles.',fail:'S√≠: la conducta social = operantes discriminativas controladas por Ed del contexto.'}
]},
// ===== NIVEL 3: Eventos privados con funci√≥n estimular =====
{title:'Eventos privados con funci√≥n estimular',description:'C√≥mo los pensamientos e im√°genes adquieren funci√≥n de est√≠mulo ‚Äî sin salir del conductismo radical.',showCount:10,
cheat:['Pensar = conducta encubierta, no proceso mental causal','Un pensamiento puede funcionar como Ed o EC para otras conductas','4 tipos de estimulaci√≥n privada (Skinner): interoceptiva, propioceptiva, visi√≥n condicionada, visi√≥n operante','Del hablar social al pensar privado (Horne & Lowe)','Lo privado tambi√©n es conducta que necesita explicaci√≥n ‚Äî no explica lo p√∫blico'],
theory:[
{icon:'üß†',title:'Pensar es conducta',color:'accent',body:'<p>Skinner (1957): <strong>"El pensamiento no es un proceso misterioso responsable de la conducta, sino que es la conducta misma."</strong></p><p>La conducta de pensar se caracteriza por ser <b>encubierta</b>: funciona como estimulaci√≥n privada. Pero sigue las mismas leyes que la conducta abierta.</p><div class="callout"><em>Consecuencia cl√≠nica:</em> Un pensamiento puede funcionar como <b>Ed</b> para ciertas respuestas del individuo, pero no deja de ser conducta y, por tanto, necesita ser explicado por otras variables. No es la "causa primera".</div>'},
{icon:'üëÅÔ∏è',title:'Cuatro tipos de estimulaci√≥n privada (Skinner, 1953)',color:'gold',body:'<div class="ex-box"><div class="ex-box-l">1. Interoceptiva y propioceptiva</div><p>Eventos biol√≥gicos derivados de los sistemas sensoriales del cuerpo: posici√≥n de extremidades, temperatura, da√±o en tejidos, sensaciones viscerales.</p></div><div class="ex-box"><div class="ex-box-l">2. Visi√≥n condicionada (CC)</div><p>Ciertos est√≠mulos producen respuestas condicionadas privadas. Ej: oler un perfume ‚Üí nos evoca la imagen de una persona conocida. Es CC aplicado a la visi√≥n privada.</p></div><div class="ex-box"><div class="ex-box-l">3. Visi√≥n operante (CO)</div><p>La visi√≥n privada bajo control operante. Ej: en un examen, imaginar objetos en movimiento para resolver un problema de f√≠sica. La imagen se emite porque tiene consecuencias reforzantes.</p></div><div class="ex-box"><div class="ex-box-l">4. Conducta verbal encubierta</div><p>Hablar "para dentro". El sujeto es hablante y oyente a la vez. Es la forma m√°s desarrollada de estimulaci√≥n privada en humanos.</p></div>'},
{icon:'üí¨',title:'Del hablar al pensar',color:'green',body:'<p>¬øC√≥mo llega la conducta verbal a emitirse de forma privada? El desarrollo sigue esta secuencia:</p><div class="ex-box"><div class="ex-box-l">Secuencia del desarrollo</div><p>1Ô∏è‚É£ <b>Conducta de oyente:</b> el ni√±o aprende a responder a lo que otros dicen.<br><br>2Ô∏è‚É£ <b>Hablar en voz alta:</b> emite operantes verbales p√∫blicas (mandos, tactos).<br><br>3Ô∏è‚É£ <b>Hablarse a s√≠ mismo en voz alta:</b> autorregulaci√≥n verbal p√∫blica.<br><br>4Ô∏è‚É£ <b>Hablar encubiertamente (pensar):</b> la conducta verbal se reduce en escala hasta ser inaccesible.</p></div><div class="callout callout-g"><em>¬øPor qu√© se emite en privado?</em> Econom√≠a de esfuerzo, menor demora, evitaci√≥n de castigo social (decir algo impopular), autoestimulaci√≥n. No porque sea "de naturaleza distinta".</div>'},
{icon:'‚ö†Ô∏è',title:'Error R-R: lo privado no explica lo p√∫blico',color:'purple',body:'<p>Un error frecuente en cl√≠nica es poner un evento privado como "causa" de la conducta abierta sin ir m√°s all√°:</p><div class="ex-box"><div class="ex-box-l">Error t√≠pico</div><p>‚ùå "Se va de casa PORQUE piensa que algo malo va a pasar."<br><br>‚úÖ "¬øCu√°l es el Ed del pensamiento? ¬øAnte qu√© situaci√≥n ambiental aparece ese pensamiento? ¬øCu√°les son los determinantes de esa conducta encubierta?"</p></div><div class="callout"><em>Skinner:</em> "Cuando preguntamos \'qu√© papel juega el pensamiento en el control de la conducta\', estamos preguntando por la naturaleza de una relaci√≥n conducta-conducta." Un pensamiento que controla una operante tambi√©n es conducta que requiere explicaci√≥n.</div>'}
],
exercises:[
{type:'tf',skill:'privados',s:'El pensamiento es un proceso mental responsable de causar la conducta.',c:false,ok:'Skinner: "El pensamiento no es un proceso misterioso responsable de la conducta, sino que es la conducta misma." Es conducta encubierta, no causa.',fail:'Pensar = conducta encubierta. No es la causa de la conducta, ES conducta.'},
{type:'single',skill:'privados',text:'üëÉ Mar√≠a huele un perfume y le viene la imagen de su abuela. ¬øQu√© tipo de estimulaci√≥n privada?',opts:['Interoceptiva','Propioceptiva','Visi√≥n condicionada (CC): el perfume como EC elicita la imagen como RC privada','Visi√≥n operante'],c:2,ok:'El perfume (EC) elicita la imagen de la abuela (RC privada) por condicionamiento cl√°sico. Es visi√≥n condicionada.',fail:'Perfume (EC) ‚Üí imagen (RC privada) = visi√≥n condicionada por CC.'},
{type:'single',skill:'privados',text:'üìê En un examen de f√≠sica, Laura imagina objetos en movimiento para resolver un problema. ¬øTipo de estimulaci√≥n privada?',opts:['Visi√≥n condicionada','Visi√≥n operante: la imagen se emite porque facilita resolver el problema (R+)','Interoceptiva','Verbal encubierta'],c:1,ok:'La imagen se emite deliberadamente porque tiene consecuencias reforzantes (resolver el problema). Es visi√≥n operante, bajo control del CO.',fail:'Visi√≥n operante: la imagen se emite y mantiene por sus consecuencias reforzantes.'},
{type:'single',skill:'privados',text:'üí≠ Un terapeuta dice: "El paciente se va de casa PORQUE piensa que algo malo va a pasar." ¬øQu√© falta en este an√°lisis?',opts:['Nada, es correcto','Falta identificar el Ed del pensamiento: ¬øante qu√© situaci√≥n ambiental aparece ese pensamiento?','Falta un diagn√≥stico','Falta hablar de emociones'],c:1,ok:'El pensamiento tambi√©n es conducta. ¬øAnte qu√© Ed se emite? El an√°lisis debe buscar los determinantes ambientales del pensamiento, no detenerse en la relaci√≥n R-R.',fail:'Error R-R: el pensamiento necesita explicaci√≥n. ¬øCu√°les son sus determinantes ambientales?'},
{type:'tf',skill:'privados',s:'Un pensamiento puede funcionar como est√≠mulo discriminativo (Ed) para una operante abierta.',c:true,ok:'Un pensamiento puede funcionar como Ed para otras conductas. Pero el pensamiento mismo es conducta que requiere explicaci√≥n por variables ambientales.',fail:'S√≠: puede funcionar como Ed, pero √©l mismo es conducta que hay que explicar.'},
{type:'classify',skill:'privados',categories:['üëÅÔ∏è Visi√≥n condicionada','üéØ Visi√≥n operante','üí¨ Verbal encubierta','üíì Interoceptiva'],items:[
{text:'Oler caf√© ‚Üí imaginar la cafeter√≠a del barrio',cat:'üëÅÔ∏è Visi√≥n condicionada'},
{text:'Imaginar la ruta del viaje para planificar paradas',cat:'üéØ Visi√≥n operante'},
{text:'Pensar: "¬øLlevo las llaves?" antes de salir',cat:'üí¨ Verbal encubierta'},
{text:'Sentir el est√≥mago revuelto antes de una cita',cat:'üíì Interoceptiva'},
{text:'O√≠r una canci√≥n ‚Üí ver mentalmente a tu ex',cat:'üëÅÔ∏è Visi√≥n condicionada'},
{text:'Visualizar la jugada antes de lanzar en baloncesto',cat:'üéØ Visi√≥n operante'}
]},
{type:'single',skill:'privados',text:'üë∂ ¬øCu√°l es la secuencia del desarrollo de la conducta verbal seg√∫n el an√°lisis conductual?',opts:['Pensar primero, luego hablar','Oyente ‚Üí hablar p√∫blico ‚Üí hablarse en voz alta ‚Üí hablar encubierto (pensar)','Es innato, no se desarrolla','Leer ‚Üí hablar ‚Üí pensar'],c:1,ok:'Primero se aprende como oyente, luego se habla en p√∫blico, despu√©s a uno mismo en voz alta, y finalmente se reduce en escala hasta ser privado.',fail:'De lo social/p√∫blico a lo privado: oyente ‚Üí hablar ‚Üí hablarse ‚Üí pensar.'},
{type:'tf',skill:'privados',s:'La conducta se emite de forma encubierta porque es de naturaleza diferente a la p√∫blica.',c:false,ok:'Se emite encubiertamente por razones funcionales: econom√≠a, menor demora, evitar castigo social, autoestimulaci√≥n. No por naturaleza distinta.',fail:'Misma naturaleza. Se emite en privado por econom√≠a, evitar castigo, etc.'},
{type:'single',skill:'privados',text:'üîÑ Si un pensamiento controla una operante abierta, ¬øqu√© implica para el AFC?',opts:['Que el pensamiento es la causa y no hay que buscar m√°s','Que hay que explicar tambi√©n el pensamiento: ¬øqu√© Ed ambiental lo controla?','Que solo importan los pensamientos','Que es imposible analizarlo'],c:1,ok:'El pensamiento como conducta tambi√©n necesita explicaci√≥n. El AFC debe buscar los determinantes ambientales que controlan esa conducta encubierta.',fail:'El AFC no se detiene en R-R: busca los determinantes ambientales del pensamiento.'},
{type:'tf',skill:'privados',s:'Los eventos privados siguen las mismas leyes de aprendizaje (CC y CO) que la conducta p√∫blica.',c:true,ok:'Principio fundamental del conductismo radical: mismos principios para conducta p√∫blica y privada. La diferencia es de accesibilidad, no de leyes.',fail:'S√≠: mismas leyes. Diferencia = accesibilidad, no naturaleza ni principios.'}
]},
// ===== NIVEL 4: Est√≠mulo como funci√≥n =====
{title:'El est√≠mulo es funci√≥n, no cosa',description:'El concepto central: nada es est√≠mulo por s√≠ mismo.',showCount:10,
cheat:['Nada es est√≠mulo por principio ‚Äî lo es por la relaci√≥n funcional','Mismo objeto = diferente funci√≥n seg√∫n persona/momento','La funci√≥n la da la historia de reforzamiento','El psic√≥logo hipotetiza funciones, no describe objetos','Topograf√≠a ‚â† funci√≥n: misma forma, diferentes funciones'],
theory:[
{icon:'üîë',title:'El principio fundamental',color:'accent',body:'<p>La funcionalidad de un hecho, objeto o persona <strong>no es algo fijo</strong> que dependa de su aspecto o morfolog√≠a, sino que es <b>espec√≠fico de cada relaci√≥n E-R, en cada persona</b>.</p><div class="callout"><em>Principio:</em> No hay eventos que por principio tengan valor de est√≠mulo o de respuesta. La relaci√≥n que se establece es la que da un valor u otro, seg√∫n la <b>historia de reforzamiento</b> del individuo.</div><div class="ex-box"><div class="ex-box-l">Ejemplo radical</div><p>"Llorar", "leer", "sonre√≠r" y "cambiarse de ropa" pueden tener <b>la misma funci√≥n</b>: obtener atenci√≥n social (R+). Topograf√≠as distintas, misma operante funcional.<br><br>A la inversa: "prender fuego" puede funcionar para destruir, calentarse, o estudiar la llama. Misma topograf√≠a, tres funciones.</p></div>'},
{icon:'üî¨',title:'El nivel funcional es lo psicol√≥gico',color:'gold',body:'<p>Lo espec√≠fico de la psicolog√≠a es el <strong>an√°lisis funcional</strong>: estudiar las relaciones funcionales entre conducta y ambiente.</p><div class="ex-box"><div class="ex-box-l">Nivel estructural vs funcional</div><p><b>Estructural:</b> observas un interruptor, una mano que lo acciona, la luz que se enciende. Son hechos f√≠sicos.<br><br><b>Funcional:</b> hipotetizas que el interruptor tiene funci√≥n de Ed para ESA persona, en ESAS condiciones. Eso es lo psicol√≥gico.</p></div><div class="callout callout-g"><em>Implicaci√≥n cl√≠nica:</em> En el AFC no podemos asumir funciones bas√°ndonos en la morfolog√≠a. Debemos INVESTIGAR qu√© funci√≥n cumple cada est√≠mulo para esta persona concreta.</div>'}
],
exercises:[
{type:'tf',skill:'e_funcion',s:'Un cuchillo es siempre un est√≠mulo aversivo.',c:false,ok:'Un cuchillo es un objeto. Su funci√≥n depende de la persona y el contexto: Ed para cocinar, EC de miedo para v√≠ctima de agresi√≥n, o funcionalmente neutro.',fail:'La funci√≥n depende de la persona/contexto, no del objeto.'},
{type:'single',skill:'e_funcion',text:'üî• Prender fuego puede funcionar para destruir, calentarse, o estudiar la llama. ¬øQu√© demuestra?',opts:['Que el fuego es peligroso','Que la misma topograf√≠a puede tener funciones completamente diferentes','Que hay tres tipos de fuego','Que el contexto es irrelevante'],c:1,ok:'Misma forma = distintas funciones seg√∫n la relaci√≥n con consecuencias y contexto.',fail:'Topograf√≠a ‚â† funci√≥n. La funci√≥n la da la relaci√≥n, no la forma.'},
{type:'single',skill:'e_funcion',text:'üëî Tu jefe puede ser: (lunes) Ed para trabajar, (evaluaci√≥n) EC de ansiedad, (enfadado) EŒî para no pedir aumento. ¬øQu√© significa?',opts:['El jefe es impredecible','La funci√≥n estimular var√≠a seg√∫n contexto y contingencias activas','Hay tres jefes','El AFC es arbitrario'],c:1,ok:'Mismo est√≠mulo, funci√≥n variable. Depende de las contingencias activas en cada momento.',fail:'Funci√≥n variable seg√∫n contexto y contingencias del momento.'},
{type:'single',skill:'e_funcion',text:'üß© "Llorar", "sonre√≠r" y "cambiarse de ropa" pueden tener la misma funci√≥n. ¬øCu√°l?',opts:['Expresar emociones','Obtener atenci√≥n social (R+)','No pueden tener la misma','Comunicarse'],c:1,ok:'Topograf√≠as diferentes, misma funci√≥n: operantes mantenidas por R+ social.',fail:'Diferentes topograf√≠as, misma funci√≥n operante: R+ social (atenci√≥n).'},
{type:'tf',skill:'e_funcion',s:'En el AFC podemos asumir la funci√≥n de un est√≠mulo por su aspecto f√≠sico.',c:false,ok:'Nunca asumir: INVESTIGAR la funci√≥n para esta persona, este contexto, esta historia.',fail:'Nunca asumir: investigar la funci√≥n concreta.'},
{type:'single',skill:'e_funcion',text:'üè• Dos pacientes ven una bata blanca. A uno le da ansiedad, al otro le tranquiliza. ¬øC√≥mo?',opts:['Perciben mal','Historias diferentes: EC aversivo para uno, EC de seguridad para otro','Uno es m√°s sensible','Imposible'],c:1,ok:'Asociaciones distintas: dolor vs cuidado. Misma morfolog√≠a, historias de reforzamiento diferentes ‚Üí funciones opuestas.',fail:'Historia diferente = funci√≥n diferente para el mismo objeto.'},
{type:'single',skill:'e_funcion',text:'üî¨ ¬øQu√© es lo espec√≠ficamente psicol√≥gico del an√°lisis funcional?',opts:['Observar hechos f√≠sicos','Hipotetizar las funciones que los hechos tienen para esa persona','Medir respuestas fisiol√≥gicas','Diagnosticar trastornos'],c:1,ok:'Lo psicol√≥gico es hipotetizar funciones, no solo observar hechos ni diagnosticar. El nivel funcional es el propio de la psicolog√≠a.',fail:'El psic√≥logo hipotetiza funciones. Ese es el nivel propio de la psicolog√≠a.'},
{type:'tf',skill:'e_funcion',s:'Un est√≠mulo puede quedar condicionado a situaciones muy diferentes dependiendo de la historia individual.',c:true,ok:'La variabilidad es enorme y espec√≠fica de cada individuo y su historia de reforzamiento.',fail:'S√≠: variabilidad individual enorme.'},
{type:'match',skill:'e_funcion',text:'Empareja cada concepto:',
pairs:[{left:'Describe la forma del E',right:'An√°lisis morfol√≥gico'},{left:'Describe qu√© papel juega el E',right:'An√°lisis funcional'},{left:'Lo fijo del objeto',right:'Estructura'},{left:'Lo espec√≠fico de la relaci√≥n',right:'Funci√≥n'}],
ok:'Morfolog√≠a = forma. Funci√≥n = papel en la relaci√≥n. Lo psicol√≥gico es lo funcional.'},
{type:'tf',skill:'e_funcion',s:'Skinner consideraba que la identificaci√≥n de un est√≠mulo reforzante depende de probar emp√≠ricamente su efecto, no de su aspecto.',c:true,ok:'Skinner insisti√≥ en que para identificar un reforzante hay que probar emp√≠ricamente su efecto sobre la conducta, no asumir por su forma.',fail:'S√≠: definici√≥n emp√≠rica del reforzador, no por aspecto o "sentido com√∫n".'}
]},
// ===== NIVEL 5: Casos cl√≠nicos =====
{title:'An√°lisis estimular cl√≠nico',description:'Identifica tipos y funciones de est√≠mulos en casos reales.',showCount:3,
cheat:['Identificar E externo / encubierto / interno','Determinar funci√≥n: EC, Ed, EŒî','Si hay pensamiento: ¬øcu√°l es su Ed ambiental?','El mismo E puede tener doble funci√≥n (EC + Ed)','No detenerse en la relaci√≥n R-R'],
theory:[
{icon:'üè•',title:'Gu√≠a de an√°lisis estimular',color:'accent',body:'<p>Para cada caso, preg√∫ntate:</p><div class="ex-box"><div class="ex-box-l">Paso a paso</div><p>1Ô∏è‚É£ <b>¬øQu√© est√≠mulos est√°n presentes?</b> Externos e internos.<br><br>2Ô∏è‚É£ <b>¬øQu√© funci√≥n cumplen?</b> EI, EC, Ed, EŒî ‚Äî para cada R espec√≠fica.<br><br>3Ô∏è‚É£ <b>¬øHay doble funci√≥n?</b> ¬øEC para una R y Ed para otra?<br><br>4Ô∏è‚É£ <b>¬øLa RC funciona como E interno?</b> ¬øDispara otra cadena?<br><br>5Ô∏è‚É£ <b>¬øHay conducta encubierta?</b> Si s√≠: ¬øcu√°l es su Ed ambiental? No detenerse en R-R.<br><br>6Ô∏è‚É£ <b>¬øQu√© mantiene la operante?</b> ¬øR+? ¬øR-? ¬øConsecuencia encubierta?</p></div>'}
],
exercises:[
{type:'seq',skill:'caso_e',patient:{name:'Marta',age:'34 a√±os',gender:'f',initial:'M',badge:'Agorafobia'},quote:'"Cuando s√© que me voy a quedar sola en casa, me da un ataque. Organizo todo para no estar sola."',questions:[
{text:'Marta sabe que Luis saldr√° ma√±ana. Piensa en quedarse sola y siente opresi√≥n. ¬øCu√°l es el Ed del pensamiento?',opts:['No tiene Ed, aparece solo','Las se√±ales ambientales: comentarios de Luis sobre salir, ver la maleta, el calendario','Su personalidad ansiosa','La opresi√≥n en el pecho'],c:1,fb:'El pensamiento es conducta encubierta. Su Ed son se√±ales ambientales externas (Luis mencionando la salida, objetos que se√±alan su ausencia). No aparece "de la nada".'},
{text:'La opresi√≥n en el pecho (RC) funciona como est√≠mulo para organizar la salida. ¬øQu√© funci√≥n tiene?',opts:['EC para la organizaci√≥n','Ed interno para la operante de escape','EI','EŒî'],c:1,fb:'La opresi√≥n (RC) adquiere funci√≥n de Ed interno para la operante de organizar la salida. Es la "funci√≥n bisagra" de la secuencia compuesta.'},
{text:'Marta sale de casa y la opresi√≥n se reduce. ¬øQu√© mantiene la operante de salir?',opts:['R+ social','R-: reducci√≥n del est√≠mulo interno aversivo','Castigo','Extinci√≥n'],c:1,fb:'Salir reduce la opresi√≥n (E interno aversivo) = R- para la operante. Esto refuerza el patr√≥n de escape/evitaci√≥n.'},
{text:'¬øEste caso ilustra una secuencia simple o compuesta?',opts:['Simple respondiente','Simple operante','Compuesta: CC (se√±ales ‚Üí opresi√≥n) + CO (opresi√≥n como Ed ‚Üí salir ‚Üí R-)','Solo cognitiva'],c:2,fb:'Secuencia compuesta bifactorial: CC genera la RC, la RC funciona como Ed para la operante, y la operante se mantiene por R-.'}]},
{type:'seq',skill:'caso_e',patient:{name:'Jorge',age:'42 a√±os',gender:'m',initial:'J',badge:'Dificultades laborales'},quote:'"Cuando mi jefe me mira en reuniones me quedo en blanco. Si sonr√≠e le hablo, pero si frunce el ce√±o ni me acerco."',questions:[
{text:'"Mi jefe me mira" ‚Üí Jorge se queda en blanco. ¬øFunci√≥n de la mirada para esta respuesta?',opts:['Ed ‚Üí hablar','EC ‚Üí elicita bloqueo (RC autom√°tica) tras historia de experiencias aversivas','EŒî','EI'],c:1,fb:'El bloqueo es respondiente (RC autom√°tica). La mirada del jefe funciona como EC por historia de asociaci√≥n con consecuencias aversivas.'},
{text:'"Si est√° de buen humor le hablo." Jefe sonriente = ?',opts:['EC de alegr√≠a','Ed: se√±ala que hablar ser√° reforzado','EI','Neutro'],c:1,fb:'La sonrisa del jefe = Ed que se√±ala disponibilidad de refuerzo social para la operante de hablar.'},
{text:'"Si frunce el ce√±o ni me acerco." Jefe con ce√±o fruncido = ?',opts:['EC de tristeza','Ed para acercarse','EŒî: se√±ala que hablar no ser√° reforzado / ser√° castigado','EI'],c:2,fb:'Ce√±o fruncido = EŒî: se√±ala que la operante de hablar no producir√° refuerzo. Jorge no emite la conducta.'},
{text:'El jefe es el mismo en los tres casos. ¬øQu√© demuestra?',opts:['Es impredecible','La funci√≥n estimular depende del contexto y las contingencias, no del objeto','Jorge es inseguro','Hay tres est√≠mulos diferentes'],c:1,fb:'Mismo objeto ‚Üí tres funciones (EC, Ed, EŒî) seg√∫n contexto. La funci√≥n es relacional, no intr√≠nseca.'}]},
{type:'seq',skill:'caso_e',patient:{name:'Elena',age:'27 a√±os',gender:'f',initial:'E',badge:'Evitaci√≥n acad√©mica'},quote:'"Solo ver el edificio de la facultad me pone mal. Pienso que voy a suspender y que mis padres se decepcionan."',questions:[
{text:'Elena piensa "voy a suspender" al ver el edificio. ¬øEs este pensamiento la causa de su ansiedad?',opts:['S√≠, el pensamiento causa la ansiedad','No: el pensamiento es conducta encubierta que tambi√©n necesita explicaci√≥n. ¬øCu√°l es su Ed?','Es irrelevante','S√≠, es su esquema cognitivo'],c:1,fb:'Error R-R si nos detenemos ah√≠. El pensamiento es conducta encubierta: ¬øante qu√© Ed aparece? (el edificio, se√±ales del examen). El AFC busca los determinantes ambientales.'},
{text:'Elena siente n√°useas al acercarse ‚Üí da media vuelta ‚Üí las n√°useas se reducen. ¬øQu√© mantiene dar media vuelta?',opts:['R+ social','R-: reducci√≥n del est√≠mulo interno aversivo (n√°useas)','Castigo','Extinci√≥n'],c:1,fb:'Dar media vuelta elimina las n√°useas (E interno aversivo) = R- que mantiene la evitaci√≥n.'},
{text:'Amiga le dice: "El examen es f√°cil." Elena piensa: "Lo dice para que no me preocupe, ser√° horrible." ¬øQu√© ocurre?',opts:['La amiga es EC','La conducta verbal encubierta de Elena tiene funci√≥n de Ed para mantener la evitaci√≥n','Ansiedad generalizada','La amiga miente'],c:1,fb:'La verbalizaci√≥n encubierta de Elena funciona como Ed para mantener la operante de evitaci√≥n. Pero esa verbalizaci√≥n tambi√©n es conducta: ¬øqu√© historia la mantiene?'},
{text:'¬øPodemos decir "Elena tiene ansiedad ante ex√°menes porque es ansiosa"?',opts:['S√≠, es su rasgo','No: es circular. El AFC debe identificar est√≠mulos, funciones y contingencias concretas','S√≠ con tests','Es parcial'],c:1,fb:'Circularidad. El AFC identifica: qu√© Ed concretos, qu√© RC, qu√© operantes, qu√© consecuencias. No etiquetas que "explican" la conducta que las define.'}]}
]}
]};

// ========== ENGINE ==========
$a=document.getElementById('app');MOD=MODULE;S.mod='m3';loadP();
function go(v,o){Object.assign(S,o||{},{view:v});if(v==='exercise'){S.answers={};S.seqIdx=0;const l=MOD.levels[S.level];S.pool=shuffle([...Array(l.exercises.length).keys()]).slice(0,l.showCount||l.exercises.length);S.exIdx=0}S.tpOpen=false;saveP();render()}
function render(){const v=S.view;if(v==='home')rHome();else if(v==='theory')rTheory();else if(v==='exercise')rEx();else if(v==='gate')rGate();else if(v==='level-sum')rLSum();else if(v==='mod-sum')rMSum();requestAnimationFrame(()=>{const c=$a.querySelector('.cnt');if(c)c.scrollTop=0})}
function getBase(){const p=window.location.pathname;const idx=p.indexOf('/modulo-');return idx!==-1?p.substring(0,idx+1):p.substring(0,p.lastIndexOf('/')+1)}
function topH(t,s,back,prog){let p='';if(prog!==undefined)p=`<div class="top-prog"><div class="top-prog-bar"><div class="top-prog-fill" style="width:${prog}%"></div></div><div class="top-prog-pct">${Math.round(prog)}%</div></div>`;const tb=S.view==='exercise'?`<div class="top-btn" onclick="togTP()" title="Teor√≠a">${IC.book}</div>`:'';return `<div class="top"><div class="top-back" onclick="${back}" tabindex="0">${IC.back}</div><div style="flex:1;min-width:0"><div class="top-t">${t}</div><div class="top-s">${s}</div></div>${p}<div class="top-acts">${tb}<div class="top-btn" onclick="togDk()">${isDk()?IC.sun:IC.moon}</div></div></div>`}
function tpHTML(){if(!MOD||!MOD.levels[S.level])return '';const l=MOD.levels[S.level];let items='';(l.theory||[]).forEach(t=>{items+=`<div class="acc open"><div class="acc-h" onclick="this.parentElement.classList.toggle('open')"><div class="acc-i" style="background:var(--accent-g)">${t.icon||'üìñ'}</div><div class="acc-l">${t.title}</div><div class="acc-a">‚ñº</div></div><div class="acc-b"><div class="acc-in prose">${t.body}</div></div></div>`});return `<div class="tp-overlay${S.tpOpen?' open':''}" onclick="togTP()"></div><div class="tp${S.tpOpen?' open':''}"><button class="tp-close" onclick="togTP()">${IC.x}</button><div class="tag tag-b" style="margin-bottom:12px">üìñ Referencia te√≥rica</div>${items}</div>`}
function togTP(){S.tpOpen=!S.tpOpen;const p=$a.querySelector('.tp'),o=$a.querySelector('.tp-overlay');if(p)p.classList.toggle('open',S.tpOpen);if(o)o.classList.toggle('open',S.tpOpen)}
function rHome(){const m=MOD;let levels='';m.levels.forEach((l,i)=>{const done=isLD(i),unl=i===0||isLD(i-1),cls=done?'done':(!unl?'locked':'');const sc=P.scores[`l${i}`];let mbar='';if(sc){const p=Math.round((sc.correct/sc.total)*100);mbar=`<div class="lbar"><div class="lbar-f" style="width:${p}%;background:${p>=80?'var(--green)':(p>=50?'var(--gold)':'var(--red)')}"></div></div>`}levels+=`<div class="lcard ${cls}" onclick="${unl?`go('theory',{level:${i}})`:'void(0)'}"><div class="lcard-icon" style="background:${done?'var(--green-g)':`linear-gradient(135deg,${LVL_C[i]},${LVL_C[i]}22)`}">${done?'‚úÖ':LVL_E[i]}</div><div style="flex:1"><div class="lcard-name">${LVL_N[i]}</div><div class="lcard-sub">${l.title} ¬∑ ${l.exercises.length} ejercicios</div>${mbar}</div><div class="lcard-arrow">‚Ä∫</div></div>`});const tl=m.levels.length;let dl=0;for(let i=0;i<tl;i++)if(isLD(i))dl++;const pct=Math.round((dl/tl)*100);
$a.innerHTML=`${topH(m.phase,m.title,"window.location.href=getBase()+'index.html'")}
<div class="cnt"><div class="anim" style="text-align:center;margin-bottom:16px"><div style="font-size:52px;margin-bottom:8px">${m.icon}</div><div class="card-t" style="font-size:26px">${m.title}</div><div class="card-d" style="max-width:360px;margin:6px auto 0">${m.description}</div></div><div style="display:flex;align-items:center;justify-content:center;gap:20px;margin-bottom:16px" class="anim d1"><div class="ring"><svg width="80" height="80"><circle cx="40" cy="40" r="33" fill="none" stroke="var(--border)" stroke-width="5"/><circle cx="40" cy="40" r="33" fill="none" stroke="var(--gold)" stroke-width="5" stroke-dasharray="${2*Math.PI*33}" stroke-dashoffset="${2*Math.PI*33*(1-pct/100)}" stroke-linecap="round"/></svg><div class="ring-v">${pct}%</div></div><div><div class="stat" style="border:none;padding:4px 0"><b style="font-family:'Space Mono',monospace;font-size:24px;color:var(--bright);display:block">${dl}/${tl}</b><span style="font-size:11px;color:var(--dim);text-transform:uppercase;letter-spacing:.5px">Niveles</span></div></div></div><div style="font-family:'Space Mono',monospace;font-size:11px;text-transform:uppercase;letter-spacing:1.5px;color:var(--muted);margin:16px 0 8px" class="anim d2">Niveles del m√≥dulo</div><div class="anim d3">${levels}</div></div>`}
function isLD(i){const sc=P.scores[`l${i}`];return sc&&(sc.correct/sc.total)>=MASTERY}
function rTheory(){const l=MOD.levels[S.level];let acc='';(l.theory||[]).forEach((t,i)=>{acc+=`<div class="acc ${i===0?'open':''}" onclick="this.classList.toggle('open')"><div class="acc-h"><div class="acc-i" style="background:var(--${t.color||'accent'}-g)">${t.icon||'üìñ'}</div><div class="acc-l">${t.title}</div><div class="acc-a">‚ñº</div></div><div class="acc-b"><div class="acc-in prose">${t.body}</div></div></div>`});$a.innerHTML=`${topH(`Nivel ${S.level+1}`,l.title,"go('home')")}<div class="cnt"><div class="anim"><div class="card"><div class="tag tag-b">üìñ Nivel ${S.level+1} ‚Äî ${LVL_N[S.level]}</div><div class="card-t">${l.title}</div><div class="card-d">${l.description||''}</div></div>${acc}</div></div><div class="bot"><button class="btn btn-p" onclick="go('exercise')">Comenzar ejercicios ‚Ä∫</button></div>`}
function rEx(){const l=MOD.levels[S.level],pi=S.pool[S.exIdx],ex=l.exercises[pi],total=S.pool.length;let ft=0,fc=0;S.pool.forEach((p,i)=>{const e=l.exercises[p];const c=e.type==='seq'?e.questions.length:(e.type==='classify'?e.items.length:1);if(i<S.exIdx)fc+=c;else if(i===S.exIdx)fc+=S.seqIdx;ft+=c});let pips='<div class="pips">';S.pool.forEach((p,i)=>{const e=l.exercises[p];const c=e.type==='seq'?e.questions.length:(e.type==='classify'?e.items.length:1);for(let s=0;s<c;s++){const k=`${i}-${s}`,a=S.answers[k];let cl=i===S.exIdx&&s===S.seqIdx?'cur':(a===true?'ok':(a===false?'fail':''));pips+=`<div class="pip ${cl}"></div>`}});pips+='</div>';const prog=ft?Math.round(fc/ft*100):0;let body='';if(ex.type==='tf')body=mkTF(ex);else if(ex.type==='single')body=mkSingle(ex);else if(ex.type==='classify')body=mkCl(ex);else if(ex.type==='seq')body=mkSeq(ex);else if(ex.type==='match')body=mkMat(ex);$a.innerHTML=`${topH(`Nivel ${S.level+1}`,l.title,"go('home')",prog)}<div class="cnt">${pips}<div id="exW" class="anim">${body}</div></div><div class="bot" id="botB"></div>${tpHTML()}`}
function curK(){return `${S.exIdx}-${S.seqIdx}`}function curE(){return MOD.levels[S.level].exercises[S.pool[S.exIdx]]}
function rec(ok,ex){S.answers[curK()]=ok;if(ex&&ex.skill){if(!P.skills[ex.skill])P.skills[ex.skill]={c:0,t:0};P.skills[ex.skill].t++;if(ok)P.skills[ex.skill].c++}if(!ok&&ex){if(!P.errors[S.level])P.errors[S.level]=[];const q=ex.text||ex.s||(ex.questions?ex.questions[S.seqIdx]?.text:'')||'';const c=typeof ex.c==='number'&&ex.opts?ex.opts[ex.c]:'';P.errors[S.level].push({q:q.substring(0,100),a:(typeof c==='string'?c:'').substring(0,100)})}saveP()}
function showNext(){const b=$('botB');if(b)b.innerHTML=`<button class="btn btn-p" onclick="nextEx()">Siguiente ‚Ä∫</button>`}
function showFB(ok,t,h){const f=$('fb');if(!f)return;f.className=`fb show ${ok?'fbok':'fbfail'}`;let hh='';if(!ok&&h)hh=`<div style="margin-top:6px;padding:6px 10px;background:var(--purple-g);border-radius:4px;font-size:13px;color:var(--purple)">üí° ${h}</div>`;f.innerHTML=`<strong>${ok?'‚úÖ ¬°Correcto!':'‚ùå Incorrecto'}</strong>${t}${hh}`;if(!ok){const w=$('exW');if(w){w.classList.add('shake');setTimeout(()=>w.classList.remove('shake'),400)}}}
function mkTF(ex){return `<div class="card"><div class="q-h"><span class="q-type">‚ö°</span><span class="q-tag">V / F</span><span class="q-n">${S.exIdx+1}/${S.pool.length}</span></div><div class="q-text">${ex.s}</div><div class="tf"><div class="tf-b" id="tfV" onclick="chkTF(true)">‚úì Verdadero</div><div class="tf-b" id="tfF" onclick="chkTF(false)">‚úó Falso</div></div><div class="fb" id="fb"></div></div>`}
function chkTF(v){const ex=curE(),ok=v===ex.c;$('tf'+(v?'V':'F')).classList.add(ok?'ok':'bad','dis');$('tf'+(v?'F':'V')).classList.add('dis');if(!ok)$(ex.c?'tfV':'tfF').classList.add('ok');showFB(ok,ok?ex.ok:ex.fail);rec(ok,ex);showNext()}
function mkSingle(ex){let o='';ex.opts.forEach((t,i)=>{o+=`<div class="opt" id="so${i}" onclick="chkS(${i})"><div class="opt-m">${String.fromCharCode(65+i)}</div><div class="opt-t">${t}</div></div>`});return `<div class="card"><div class="q-h"><span class="q-type">üéØ</span><span class="q-tag">Selecci√≥n</span><span class="q-n">${S.exIdx+1}/${S.pool.length}</span></div>${ex.context?`<div class="q-ctx">${ex.context}</div>`:''}<div class="q-text">${ex.text}</div>${o}<div class="fb" id="fb"></div></div>`}
function chkS(i){const ex=curE(),ok=i===ex.c;document.querySelectorAll('.opt').forEach((o,j)=>{o.classList.add('dis');if(j===i)o.classList.add(ok?'ok':'bad');if(j===ex.c&&!ok)o.classList.add('rev')});showFB(ok,ok?ex.ok:ex.fail);rec(ok,ex);showNext()}
function mkCl(ex){const it=ex.items[S.seqIdx];let c='<div class="cl-cats">';ex.categories.forEach(cat=>{c+=`<div class="cl-c" onclick="chkCl(this.dataset.cat)" data-cat="${cat}">${cat}</div>`});c+='</div>';return `<div class="card"><div class="q-h"><span class="q-type">üìÇ</span><span class="q-tag">Clasifica</span><span class="q-n">${S.seqIdx+1}/${ex.items.length}</span></div><div class="q-text">"${it.text}"</div>${c}<div class="fb" id="fb"></div></div>`}
function chkCl(cat){const ex=curE(),it=ex.items[S.seqIdx],ok=cat===it.cat;document.querySelectorAll('.cl-c').forEach(c=>{c.classList.add('dis');if(c.dataset.cat===it.cat)c.classList.add('ok');else if(c.dataset.cat===cat&&!ok)c.classList.add('bad')});showFB(ok,ok?`"${it.text}" ‚Üí ${it.cat}.`:`Correcto: "${it.text}" ‚Üí ${it.cat}`);S.answers[curK()]=ok;if(!ok){if(!P.errors[S.level])P.errors[S.level]=[];P.errors[S.level].push({q:it.text.substring(0,80),a:it.cat})}saveP();setTimeout(()=>{if(S.seqIdx<ex.items.length-1){S.seqIdx++;render()}else{S.seqIdx=0;advEx()}},1500)}
function mkSeq(ex){const q=ex.questions[S.seqIdx];let o='';q.opts.forEach((t,i)=>{o+=`<div class="opt" id="sq${i}" onclick="chkSq(${i})"><div class="opt-m">${String.fromCharCode(65+i)}</div><div class="opt-t">${t}</div></div>`});let ph='';if(ex.patient){const p=ex.patient;ph=`<div class="pat"><div class="pat-h"><div class="pat-av ${p.gender}">${p.initial}</div><div><div class="pat-name">${p.name}</div><div class="pat-age">${p.age}</div></div><div class="pat-badge">${p.badge}</div></div><div class="pat-q">${ex.quote}</div></div>`}return `${ph}<div class="card"><div class="q-h"><span class="q-type">üè•</span><span class="q-tag">Caso cl√≠nico</span><span class="q-n">${S.seqIdx+1}/${ex.questions.length}</span></div><div class="q-text">${q.text}</div>${o}<div class="fb" id="fb"></div></div>`}
function chkSq(i){const ex=curE(),q=ex.questions[S.seqIdx],ok=i===q.c;document.querySelectorAll('.opt').forEach((o,j)=>{o.classList.add('dis');if(j===i)o.classList.add(ok?'ok':'bad');if(j===q.c&&!ok)o.classList.add('rev')});showFB(ok,q.fb);S.answers[curK()]=ok;if(!ok){if(!P.errors[S.level])P.errors[S.level]=[];P.errors[S.level].push({q:q.text.substring(0,80),a:q.opts[q.c].substring(0,80)})}saveP();const b=$('botB');if(b){const last=S.seqIdx>=ex.questions.length-1;b.innerHTML=`<button class="btn btn-p" onclick="seqN(${last})">${last?'Siguiente ‚Ä∫':'Siguiente pregunta ‚Ä∫'}</button>`}}
function seqN(last){if(last){S.seqIdx=0;advEx()}else{S.seqIdx++;render()}}
let _mL=null,_mP={},_mC=0;function mkMat(ex){_mL=null;_mP={};_mC=0;const ls=shuffle(ex.pairs.map((p,i)=>({...p,idx:i}))),rs=shuffle(ex.pairs.map((p,i)=>({...p,idx:i})));let l='<div class="mat-c">';ls.forEach(p=>{l+=`<div class="mat-i" id="ml${p.idx}" onclick="matL(${p.idx})">${p.left}</div>`});l+='</div>';let r='<div class="mat-c">';rs.forEach(p=>{r+=`<div class="mat-i" id="mr${p.idx}" onclick="matR(${p.idx})">${p.right}</div>`});r+='</div>';return `<div class="card"><div class="q-h"><span class="q-type">üîó</span><span class="q-tag">Empareja</span><span class="q-n">${S.exIdx+1}/${S.pool.length}</span></div><div class="q-text">${ex.text}</div><div class="mat-w">${l}${r}</div><div class="fb" id="fb"></div></div>`}
function matL(i){document.querySelectorAll('.mat-c:first-child .mat-i').forEach(m=>m.classList.remove('sel'));$('ml'+i).classList.add('sel');_mL=i}
function matR(i){if(_mL===null)return;const ok=_mL===i,ml=$('ml'+_mL),mr=$('mr'+i);if(ml)ml.classList.add(ok?'ok':'bad','dis');if(mr)mr.classList.add(ok?'ok':'bad','dis');if(!ok){setTimeout(()=>{if(ml){ml.classList.remove('bad','dis')}if(mr){mr.classList.remove('bad','dis')}},800)}else{_mC++;const ex=curE();if(_mC===ex.pairs.length){showFB(true,ex.ok||'Todos correctos.');rec(true,ex);showNext()}}_mL=null;document.querySelectorAll('.mat-i').forEach(m=>m.classList.remove('sel'))}
function advEx(){if(S.exIdx<S.pool.length-1){S.exIdx++;S.seqIdx=0;render()}else{let c=0,t=0;for(const[k,v]of Object.entries(S.answers)){if(typeof v==='boolean'){t++;if(v)c++}}P.scores[`l${S.level}`]={correct:c,total:t};saveP();const p=t?c/t:0;if(p>=MASTERY){fireConfetti();go('level-sum')}else{go('gate')}}}
function nextEx(){const ex=curE();if(ex.type==='classify'||ex.type==='seq')return;advEx()}
function rGate(){const sc=P.scores[`l${S.level}`],pct=sc?Math.round((sc.correct/sc.total)*100):0,need=Math.ceil(sc.total*MASTERY);let errs='';const el=P.errors[S.level]||[];const seen=new Set;el.forEach(e=>{if(!seen.has(e.q)&&seen.size<5){seen.add(e.q);errs+=`<div class="rev"><div class="rev-q">${e.q}</div><div class="rev-a">‚úì ${e.a}</div></div>`}});$a.innerHTML=`${topH(`Nivel ${S.level+1}`,MOD.levels[S.level].title,"go('home')")}<div class="cnt"><div class="gate anim"><div class="gate-ic">üîí</div><div class="gate-t">Criterio no alcanzado</div><div class="gate-d">Necesitas <strong>‚â•80%</strong> (${need}/${sc.total}) para avanzar. Obtuviste ${sc.correct}/${sc.total}.</div><div class="gate-bar"><div class="gate-bar-f" style="width:${pct}%;background:${pct>=80?'var(--green)':(pct>=50?'var(--gold)':'var(--red)')}"></div></div><div class="gate-sc" style="color:${pct>=50?'var(--gold)':'var(--red)'}">${pct}%</div>${errs?'<div style="font-family:\'Space Mono\',monospace;font-size:11px;text-transform:uppercase;letter-spacing:1px;color:var(--muted);margin:12px 0 6px">Revisar</div>'+errs:''}</div></div><div class="bot"><button class="btn btn-o" onclick="go('home')">‚Üê M√≥dulo</button><button class="btn btn-w" onclick="retryLvl()">üîÑ Reintentar</button></div>`}
function retryLvl(){delete P.scores[`l${S.level}`];P.errors[S.level]=[];saveP();go('exercise')}
function rLSum(){const sc=P.scores[`l${S.level}`],pct=sc?Math.round((sc.correct/sc.total)*100):0,cls=pct>=80?'great':(pct>=50?'mid':'low');const l=MOD.levels[S.level],hasN=S.level<MOD.levels.length-1;let sk=renderSk(),er=renderEr(),ch='';if(l.cheat){ch=`<div class="cheat"><div class="cheat-t">üìã Conceptos clave</div>`;l.cheat.forEach(c=>{ch+=`<div class="cheat-i">‚Ä¢ ${c}</div>`});ch+='</div>'}$a.innerHTML=`${topH(`Nivel ${S.level+1}`,'Resultados',"go('home')")}<div class="cnt" style="text-align:center"><div class="anim"><div class="sum-c ${cls}"><div class="sum-n">${sc.correct}</div><div class="sum-t">de ${sc.total}</div></div><div class="sum-msg">${pct>=90?'üåü ¬°Excelente!':(pct>=80?'‚úÖ ¬°Nivel superado!':'üí™ Buen progreso')}</div><div class="sum-sub">${LVL_N[S.level]}: ${l.title} ‚Äî ${pct}%</div></div><div style="text-align:left" class="anim d1">${sk}</div><div style="text-align:left" class="anim d2">${er}</div><div style="text-align:left" class="anim d3">${ch}</div></div><div class="bot"><button class="btn btn-icon btn-o" onclick="retryLvl()">${IC.refresh}</button>${hasN?`<button class="btn btn-p" onclick="go('theory',{level:${S.level+1}})">Nivel ${S.level+2} ‚Ä∫</button>`:`<button class="btn btn-g" onclick="go('mod-sum')">Resumen ‚Ä∫</button>`}</div>`}
function rMSum(){let tc=0,tt=0,rows='';MOD.levels.forEach((l,i)=>{const sc=P.scores[`l${i}`];if(sc){tc+=sc.correct;tt+=sc.total;const p=Math.round((sc.correct/sc.total)*100);rows+=`<div style="display:flex;align-items:center;gap:8px;padding:8px 0;border-bottom:1px solid var(--border2)"><span style="font-size:16px">${p>=80?'‚úÖ':(p>=50?'üü°':'üî¥')}</span><span style="flex:1;font-size:14px">${LVL_N[i]}: ${l.title}</span><span style="font-family:'Space Mono',monospace;font-size:13px;font-weight:700;color:${p>=80?'var(--green)':(p>=50?'var(--gold)':'var(--red)')}">${p}%</span></div>`}});const pct=tt?Math.round((tc/tt)*100):0;$a.innerHTML=`${topH(MOD.phase,MOD.title,"go('home')")}<div class="cnt" style="text-align:center"><div class="anim"><div style="font-size:48px;margin-bottom:6px">${pct>=80?'üéâ':'üí™'}</div><div class="sum-c ${pct>=80?'great':(pct>=50?'mid':'low')}"><div class="sum-n">${tc}</div><div class="sum-t">de ${tt}</div></div><div class="sum-msg">${pct>=80?'¬°M√≥dulo completado!':'Sigue practicando'}</div><div class="sum-sub">${MOD.title} ‚Äî ${pct}%</div></div><div class="card anim d1" style="text-align:left">${rows}</div><div style="text-align:left" class="anim d2">${renderSk()}</div></div><div class="bot"><button class="btn btn-o" onclick="window.location.href=getBase()+'index.html'">‚Üê Plataforma</button></div>`}
function renderSk(){const sk=P.skills,ks=Object.keys(sk);if(!ks.length)return '';let h='<div style="font-family:\'Space Mono\',monospace;font-size:11px;text-transform:uppercase;letter-spacing:1px;color:var(--muted);margin:12px 0 6px">üìä Habilidades</div><div class="sk-grid">';ks.forEach(k=>{const s=sk[k],p=s.t?Math.round((s.c/s.t)*100):0,c=p>=80?'var(--green)':(p>=50?'var(--gold)':'var(--red)');h+=`<div class="sk-r"><span class="sk-name">${k.replace(/_/g,' ').replace(/\b\w/g,l=>l.toUpperCase())}</span><div class="sk-bar"><div class="sk-bar-f" style="width:${p}%;background:${c}"></div></div><span class="sk-pct" style="color:${c}">${p}%</span></div>`});return h+'</div>'}
function renderEr(){const e=P.errors[S.level];if(!e||!e.length)return '';let h='<div style="font-family:\'Space Mono\',monospace;font-size:11px;text-transform:uppercase;letter-spacing:1px;color:var(--muted);margin:12px 0 6px">‚ùå Revisar</div>';const seen=new Set;e.forEach(x=>{if(!seen.has(x.q)&&seen.size<6){seen.add(x.q);h+=`<div class="rev"><div class="rev-q">${x.q}</div><div class="rev-a">‚úì ${x.a}</div></div>`}});return h}
render();
</script>
</body>
</html>
