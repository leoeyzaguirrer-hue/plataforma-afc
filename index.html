<!DOCTYPE html>
<html lang="es" data-theme="light">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>AFC Praxis â€” Entrenamiento en AnÃ¡lisis Funcional</title>
<link href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,wght@0,300;0,400;0,500;0,600;0,700;1,400&family=Space+Mono:wght@400;700&family=Fraunces:ital,opsz,wght@0,9..144,300;0,9..144,600;0,9..144,700;1,9..144,400&display=swap" rel="stylesheet">
<link rel="stylesheet" href="css/platform.css">
<style>
  /* Confetti animation */
  @keyframes confDrop{0%{transform:translateY(-20px) rotate(0);opacity:1}100%{transform:translateY(50vh) rotate(720deg);opacity:0}}
</style>
</head>
<body>
<div class="app" id="app"></div>
<div id="confWrap" style="position:fixed;top:0;left:0;right:0;height:50vh;pointer-events:none;z-index:999;overflow:hidden"></div>

<script src="js/engine.js"></script>
<script>
// ===== MODULE REGISTRY =====
const MODULES = [
  // PHASE 1 â€” Fundamentos Conductuales
  { id:'m1', phase:1, title:'OperacionalizaciÃ³n de la Conducta', desc:'Conducta vs etiqueta, triple sistema, parÃ¡metros, Eâ†’Râ†’E', icon:'ðŸŽ¯', color:'#2563eb', colorB:'#3b82f6', path:'modulo-1/', exercises:40 },
  { id:'m2', phase:1, title:'Tipos de Conducta', desc:'Respondiente vs operante, pÃºblica vs privada, conducta como interacciÃ³n', icon:'ðŸ”¬', color:'#0891b2', colorB:'#22d3ee', path:'modulo-2/', exercises:40 },
  // PHASE 2 â€” Componentes de la InteracciÃ³n
  { id:'m3', phase:2, title:'El EstÃ­mulo', desc:'Externo, interno, sustituto. Funciones: EI, EC, Eá´…, EÎ”', icon:'âš¡', color:'#d97706', colorB:'#f59e0b', path:'modulo-3/', exercises:40 },
  { id:'m4', phase:2, title:'Condicionamiento ClÃ¡sico', desc:'E-R respondiente, adquisiciÃ³n, extinciÃ³n, emociones como RC', icon:'ðŸ”—', color:'#b45309', colorB:'#d97706', path:'modulo-4/', exercises:38 },
  { id:'m5', phase:2, title:'Condicionamiento Operante', desc:'Contingencia 3 tÃ©rminos, R+, R-, C+, C-, extinciÃ³n operante', icon:'âš™ï¸', color:'#ea580c', colorB:'#f97316', path:'modulo-5/', exercises:42 },
  // PHASE 3 â€” Relaciones Funcionales
  { id:'m6', phase:3, title:'Control de EstÃ­mulos', desc:'DiscriminaciÃ³n, generalizaciÃ³n, equivalencia funcional', icon:'ðŸŽ›ï¸', color:'#7c3aed', colorB:'#a78bfa', path:'modulo-6/', exercises:38 },
  { id:'m7', phase:3, title:'Secuencias Funcionales', desc:'Simple, operante, compuesta bifactorial, encadenamiento', icon:'ðŸ”„', color:'#9333ea', colorB:'#a855f7', path:'modulo-7/', exercises:40 },
  { id:'m8', phase:3, title:'Variables Disposicionales', desc:'Historia, estado del organismo, contexto, refuerzo prioritario', icon:'ðŸ“Š', color:'#6d28d9', colorB:'#8b5cf6', path:'modulo-8/', exercises:36 },
  // PHASE 4 â€” AnÃ¡lisis Funcional Aplicado
  { id:'m9', phase:4, title:'EvaluaciÃ³n Funcional', desc:'ObservaciÃ³n, entrevista, identificaciÃ³n de secuencias', icon:'ðŸ”', color:'#059669', colorB:'#10b981', path:'modulo-9/', exercises:38 },
  { id:'m10', phase:4, title:'FormulaciÃ³n de HipÃ³tesis', desc:'De los datos a la hipÃ³tesis, coherencia funcional', icon:'ðŸ’¡', color:'#047857', colorB:'#059669', path:'modulo-10/', exercises:36 },
  { id:'m11', phase:4, title:'ConstrucciÃ³n del AF e IntervenciÃ³n', desc:'ExplicaciÃ³n al cliente, objetivos, plan de tratamiento', icon:'ðŸ—ï¸', color:'#065f46', colorB:'#047857', path:'modulo-11/', exercises:40 },
  // PHASE 5 â€” Temas Avanzados
  { id:'m12', phase:5, title:'Conducta Verbal y Gobernada por Reglas', desc:'Reglas como estÃ­mulos, insensibilidad a contingencias', icon:'ðŸ“', color:'#db2777', colorB:'#ec4899', path:'modulo-12/', exercises:36 },
  { id:'m13', phase:5, title:'Conducta Relacional', desc:'Marcos relacionales, transformaciÃ³n de funciones', icon:'ðŸ§¬', color:'#be185d', colorB:'#db2777', path:'modulo-13/', exercises:34 },
];

const PHASES = [
  { num:1, title:'Fundamentos Conductuales', sub:'Â¿QuÃ© es conducta y cÃ³mo se describe?', cls:'p1' },
  { num:2, title:'Componentes de la InteracciÃ³n', sub:'EstÃ­mulos, respuestas y sus relaciones', cls:'p2' },
  { num:3, title:'Relaciones Funcionales', sub:'CÃ³mo se organizan las secuencias complejas', cls:'p3' },
  { num:4, title:'AnÃ¡lisis Funcional Aplicado', sub:'De los datos al caso clÃ­nico', cls:'p4' },
  { num:5, title:'Temas Avanzados', sub:'Conceptos que complejizan el anÃ¡lisis', cls:'p5' },
];

// ===== RENDER LANDING =====
function renderLanding(){
  const app = document.getElementById('app');
  const global = AFC.loadGlobal();
  const isDark = document.documentElement.getAttribute('data-theme') === 'dark';

  // Stats
  let totalDone = 0, totalMods = MODULES.length;
  MODULES.forEach(m => {
    const mData = global[m.id];
    if(mData){
      // Check if all 5 levels done at 80%+
      let allDone = true;
      for(let i=0;i<5;i++){
        const sc = mData[`lvl${i}`];
        if(!sc || (sc.correct/sc.total) < AFC.MASTERY_THRESHOLD) allDone = false;
      }
      if(allDone) totalDone++;
    }
  });
  const globalPct = Math.round((totalDone/totalMods)*100);

  // Build phases
  let phasesHtml = '';
  PHASES.forEach(ph => {
    const mods = MODULES.filter(m => m.phase === ph.num);
    let modsHtml = '';
    mods.forEach((m, idx) => {
      const mData = global[m.id] || {};
      let lvlsDone = 0;
      for(let i=0;i<5;i++){
        const sc = mData[`lvl${i}`];
        if(sc && (sc.correct/sc.total) >= AFC.MASTERY_THRESHOLD) lvlsDone++;
      }
      const isDone = lvlsDone >= 5;
      const isStarted = lvlsDone > 0;
      // Module is unlocked if it's first OR previous module is done
      const globalIdx = MODULES.indexOf(m);
      const unlocked = globalIdx === 0 || isModDone(MODULES[globalIdx-1].id, global);
      const cls = isDone ? 'done' : (!unlocked ? 'locked' : '');

      let masteryHtml = '';
      if(isStarted && !isDone){
        const mPct = Math.round((lvlsDone/5)*100);
        masteryHtml = `<span class="mod-mastery ${mPct>=60?'mid':'low'}">${lvlsDone}/5</span>`;
      } else if(isDone){
        masteryHtml = `<span class="mod-mastery high">âœ“</span>`;
      }

      modsHtml += `<a class="mod-card ${cls}" href="${unlocked?m.path:'#'}" onclick="${!unlocked?'event.preventDefault()':''}">
        <div class="mod-num" style="background:linear-gradient(135deg,${m.color},${m.colorB})">${isDone?'âœ“':m.icon}</div>
        <div style="flex:1"><div class="mod-name">${m.title}</div><div class="mod-desc">${m.desc}</div></div>
        ${masteryHtml}
        <div class="mod-arrow">â€º</div></a>`;
    });

    phasesHtml += `<div class="phase"><div class="phase-head"><div class="phase-num ${ph.cls}">${ph.num}</div><div style="flex:1"><div class="phase-title">${ph.title}</div><div class="phase-sub">${ph.sub}</div></div></div>${modsHtml}</div>`;
  });

  app.innerHTML = `
  <div class="topbar">
    <div class="topbar-info" style="flex:1"><div class="topbar-title">AFC Praxis</div><div class="topbar-sub">Entrenamiento en AnÃ¡lisis Funcional</div></div>
    <div class="topbar-actions">
      <div class="topbar-btn" onclick="toggleThemeLanding()" title="Tema">${isDark?AFC.ICO.sun:AFC.ICO.moon}</div>
    </div>
  </div>
  <div class="content">
    <div class="landing-hero anim">
      <div class="landing-logo">${AFC.ICO.brain}</div>
      <div class="landing-title">AFC Praxis</div>
      <div class="landing-sub">Plataforma de entrenamiento progresivo en habilidades clÃ­nicas de AnÃ¡lisis Funcional de la Conducta</div>
    </div>

    <div class="dash-grid anim d1">
      <div class="dash-stat"><b>${totalDone}</b><span>MÃ³dulos</span></div>
      <div class="dash-stat"><b>${totalMods}</b><span>Total</span></div>
      <div class="dash-stat"><b>${globalPct}%</b><span>Progreso</span></div>
      <div class="dash-stat"><b>520</b><span>Ejercicios</span></div>
    </div>

    <div class="callout anim d2" style="margin:14px 0">
      <em>Criterio de dominio:</em> Cada nivel requiere â‰¥80% de aciertos para desbloquearse. Los ejercicios se aleatorizan en cada intento.
    </div>

    <div class="anim d3">${phasesHtml}</div>

    <div style="text-align:center;padding:20px 0;font-size:12px;color:var(--muted)">
      AFC Praxis Â· Basado en el Manual de ITEMA Â· AnÃ¡lisis Funcional de la Conducta
    </div>
  </div>`;
}

function isModDone(modId, global){
  const mData = global[modId];
  if(!mData) return false;
  for(let i=0;i<5;i++){
    const sc = mData[`lvl${i}`];
    if(!sc || (sc.correct/sc.total) < AFC.MASTERY_THRESHOLD) return false;
  }
  return true;
}

function toggleThemeLanding(){
  AFC.toggleTheme();
  renderLanding(); // Re-render to update icon
}

// Init
renderLanding();
</script>
</body>
</html>
