/* ============================================
   AFC PRAXIS — Plataforma de Entrenamiento
   en Análisis Funcional de la Conducta
   ============================================ */

/* ===== THEME SYSTEM ===== */
:root, [data-theme="light"] {
  /* Core */
  --bg: #f0f4f7; --bg2: #f7f9fb; --bg3: #edf1f5;
  --card: #ffffff; --card2: #f8fafb;
  --text: #2c3e50; --dim: #5a7184; --bright: #1a2836; --muted: #8a9eb0;
  /* Brand */
  --accent: #2563eb; --accent-b: #3b82f6; --accent-g: rgba(37,99,235,0.06);
  --gold: #d97706; --gold-b: #f59e0b; --gold-g: rgba(217,119,6,0.06);
  --green: #059669; --green-b: #10b981; --green-g: rgba(5,150,105,0.06);
  --red: #dc2626; --red-b: #ef4444; --red-g: rgba(220,38,38,0.05);
  --teal: #0891b2; --teal-g: rgba(8,145,178,0.05);
  --purple: #7c3aed; --purple-g: rgba(124,58,237,0.05);
  --pink: #db2777;
  /* UI */
  --border: rgba(44,62,80,0.1); --border2: rgba(44,62,80,0.05);
  --shadow-sm: 0 1px 3px rgba(0,0,0,0.04);
  --shadow: 0 2px 8px rgba(0,0,0,0.06);
  --shadow-lg: 0 8px 30px rgba(0,0,0,0.08);
  --overlay: rgba(255,255,255,0.92); --overlay2: rgba(247,249,251,0.95);
  --r: 12px; --rs: 8px;
  /* Stage intensity */
  --stA: #eff6ff; --stA-a: #2563eb; --stA-t: #1e40af;
  --stB: #fffbeb; --stB-a: #d97706; --stB-t: #92400e;
  --stC: #fdf2f8; --stC-a: #db2777; --stC-t: #9d174d;
  --stD: #f5f3ff; --stD-a: #7c3aed; --stD-t: #5b21b6;
  --stE: #ecfdf5; --stE-a: #059669; --stE-t: #065f46;
  /* Mastery */
  --mastery-low: #dc2626; --mastery-mid: #d97706; --mastery-high: #059669;
}

[data-theme="dark"] {
  --bg: #0f1419; --bg2: #1a2332; --bg3: #151d28;
  --card: #1e293b; --card2: #253344;
  --text: #cbd5e1; --dim: #7a8fa3; --bright: #f1f5f9; --muted: #4a5f73;
  --accent: #60a5fa; --accent-b: #93c5fd; --accent-g: rgba(96,165,250,0.1);
  --gold: #fbbf24; --gold-b: #fcd34d; --gold-g: rgba(251,191,36,0.08);
  --green: #34d399; --green-b: #6ee7b7; --green-g: rgba(52,211,153,0.08);
  --red: #f87171; --red-b: #fca5a5; --red-g: rgba(248,113,113,0.08);
  --teal: #22d3ee; --teal-g: rgba(34,211,238,0.06);
  --purple: #a78bfa; --purple-g: rgba(167,139,250,0.08);
  --pink: #f472b6;
  --border: rgba(148,163,184,0.12); --border2: rgba(148,163,184,0.06);
  --shadow-sm: 0 1px 3px rgba(0,0,0,0.15);
  --shadow: 0 2px 8px rgba(0,0,0,0.2);
  --shadow-lg: 0 8px 30px rgba(0,0,0,0.3);
  --overlay: rgba(15,20,25,0.95); --overlay2: rgba(26,35,50,0.95);
  --stA: #1e293b; --stA-a: #60a5fa; --stA-t: #93c5fd;
  --stB: #292118; --stB-a: #fbbf24; --stB-t: #fcd34d;
  --stC: #2d1525; --stC-a: #f472b6; --stC-t: #fbcfe8;
  --stD: #1e1536; --stD-a: #a78bfa; --stD-t: #c4b5fd;
  --stE: #132a1f; --stE-a: #34d399; --stE-t: #6ee7b7;
}

/* ===== RESET ===== */
*, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
:focus-visible { outline: 2px solid var(--accent); outline-offset: 2px; border-radius: 4px; }
html { height: 100%; scroll-behavior: smooth; }
body {
  height: 100%; overflow: hidden;
  background: var(--bg); color: var(--text);
  font-family: 'DM Sans', system-ui, -apple-system, sans-serif;
  font-size: 16px; line-height: 1.6;
  transition: background .3s, color .3s;
}

/* ===== LAYOUT ===== */
.app { position: fixed; inset: 0; display: flex; flex-direction: column; z-index: 1; }
.topbar {
  display: flex; align-items: center; gap: 10px;
  padding: 10px 16px; height: 56px;
  background: var(--overlay); backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px);
  border-bottom: 1px solid var(--border); flex-shrink: 0; z-index: 20;
  transition: background .3s;
}
.topbar-back {
  width: 36px; height: 36px; border-radius: 8px;
  background: var(--bg); border: 1px solid var(--border);
  color: var(--accent); display: flex; align-items: center; justify-content: center;
  cursor: pointer; transition: all .15s; flex-shrink: 0;
}
.topbar-back:hover { background: var(--accent-g); border-color: var(--accent); }
.topbar-back svg { width: 18px; height: 18px; stroke: currentColor; fill: none; stroke-width: 2.5; stroke-linecap: round; stroke-linejoin: round; }
.topbar-info { flex: 1; min-width: 0; }
.topbar-title { font-family: 'Fraunces', serif; font-size: 14px; font-weight: 600; color: var(--bright); line-height: 1.2; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
.topbar-sub { font-size: 11px; color: var(--dim); }
.topbar-prog { display: flex; align-items: center; gap: 6px; flex-shrink: 0; }
.topbar-prog-bar { width: 52px; height: 4px; border-radius: 2px; background: var(--border); overflow: hidden; }
.topbar-prog-fill { height: 100%; background: var(--accent); border-radius: 2px; transition: width .4s ease; }
.topbar-prog-txt { font-family: 'Space Mono', monospace; font-size: 10px; color: var(--dim); }
.topbar-actions { display: flex; gap: 4px; flex-shrink: 0; }
.topbar-btn {
  width: 34px; height: 34px; border-radius: 8px;
  background: transparent; border: 1px solid var(--border);
  color: var(--dim); display: flex; align-items: center; justify-content: center;
  cursor: pointer; transition: all .15s; font-size: 14px;
}
.topbar-btn:hover { color: var(--accent); border-color: var(--accent); background: var(--accent-g); }
.topbar-btn svg { width: 16px; height: 16px; stroke: currentColor; fill: none; stroke-width: 2; }

.content {
  flex: 1; overflow-y: auto; overflow-x: hidden;
  padding: 20px 16px 100px;
  -webkit-overflow-scrolling: touch; scroll-behavior: smooth;
}
.content::-webkit-scrollbar { width: 3px; }
.content::-webkit-scrollbar-thumb { background: var(--border); border-radius: 3px; }

.bottombar {
  position: fixed; bottom: 0; left: 0; right: 0;
  padding: 10px 16px; padding-bottom: max(10px, env(safe-area-inset-bottom));
  background: var(--overlay2); backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px);
  border-top: 1px solid var(--border2); z-index: 20;
  display: flex; gap: 8px; transition: background .3s;
}

/* ===== BUTTONS ===== */
.btn {
  flex: 1; padding: 13px 20px; border-radius: var(--rs);
  font-family: 'DM Sans', sans-serif; font-size: 15px; font-weight: 600;
  border: none; cursor: pointer; transition: all .15s; text-align: center;
  display: inline-flex; align-items: center; justify-content: center; gap: 6px;
}
.btn:active { transform: scale(0.97); }
.btn-primary { background: var(--accent); color: #fff; box-shadow: 0 2px 8px rgba(37,99,235,0.2); }
.btn-primary:hover { filter: brightness(1.08); }
.btn-primary:disabled { opacity: 0.35; pointer-events: none; }
.btn-success { background: var(--green); color: #fff; box-shadow: 0 2px 8px rgba(5,150,105,0.2); }
.btn-ghost { background: var(--card); color: var(--text); border: 1px solid var(--border); flex: none; }
.btn-ghost:hover { border-color: var(--accent); color: var(--accent); }
.btn-sm { flex: none; padding: 8px 14px; font-size: 13px; }
.btn-icon { flex: none; width: 42px; padding: 0; }
.btn-warn { background: var(--gold); color: #fff; }

/* ===== CARDS ===== */
.card {
  background: var(--card); border: 1px solid var(--border);
  border-radius: var(--r); padding: 20px;
  margin-bottom: 14px; box-shadow: var(--shadow-sm);
  transition: background .3s, border .3s;
}
.card-header { margin-bottom: 14px; }
.tag {
  font-family: 'Space Mono', monospace; font-size: 10px; text-transform: uppercase;
  letter-spacing: 1.2px; display: inline-flex; align-items: center; gap: 5px;
  padding: 3px 8px; border-radius: 4px; margin-bottom: 8px;
}
.tag-blue { color: var(--accent); background: var(--accent-g); }
.tag-gold { color: var(--gold); background: var(--gold-g); }
.tag-green { color: var(--green); background: var(--green-g); }
.tag-purple { color: var(--purple); background: var(--purple-g); }
.card-title { font-family: 'Fraunces', serif; font-size: 20px; font-weight: 700; color: var(--bright); line-height: 1.3; margin-bottom: 6px; }
.card-desc { font-size: 14px; color: var(--dim); line-height: 1.6; }

/* Theory text */
.prose { font-size: 15px; color: var(--text); line-height: 1.75; }
.prose p { margin-bottom: 10px; }
.prose strong, .prose b { color: var(--bright); font-weight: 600; }
.callout {
  background: var(--accent-g); border-left: 3px solid var(--accent);
  padding: 12px 16px; border-radius: 0 var(--rs) var(--rs) 0;
  margin: 12px 0; font-size: 14px; color: var(--bright); line-height: 1.65;
}
.callout em { color: var(--accent); font-style: normal; font-weight: 600; }
.callout-gold { background: var(--gold-g); border-color: var(--gold); }
.callout-gold em { color: var(--gold); }
.example-box {
  background: var(--bg2); border: 1px solid var(--border);
  border-radius: var(--rs); padding: 12px 16px; margin: 12px 0;
}
.example-label { font-size: 10px; font-weight: 700; color: var(--accent); text-transform: uppercase; letter-spacing: .8px; margin-bottom: 4px; }
.example-box p { font-size: 13.5px; color: var(--text); margin: 0; line-height: 1.6; }

/* ===== ACCORDION THEORY ===== */
.accord { border: 1px solid var(--border); border-radius: var(--rs); margin-bottom: 8px; overflow: hidden; background: var(--card); transition: all .3s; }
.accord-head { display: flex; align-items: center; gap: 10px; padding: 12px 14px; cursor: pointer; user-select: none; }
.accord-icon { width: 28px; height: 28px; border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 15px; flex-shrink: 0; }
.accord-label { font-weight: 600; font-size: 14px; color: var(--bright); flex: 1; }
.accord-arrow { font-size: 10px; color: var(--muted); transition: transform .3s; }
.accord.open .accord-arrow { transform: rotate(180deg); }
.accord-body { max-height: 0; overflow: hidden; transition: max-height .4s ease; }
.accord.open .accord-body { max-height: 2000px; }
.accord-inner { padding: 0 14px 14px; }

/* ===== THEORY PANEL (overlay during exercises) ===== */
.theory-panel {
  position: fixed; top: 56px; right: -100%; bottom: 0; width: 85%; max-width: 400px;
  background: var(--card); border-left: 1px solid var(--border);
  z-index: 30; overflow-y: auto; padding: 20px;
  transition: right .3s ease; box-shadow: -4px 0 20px rgba(0,0,0,0.1);
}
.theory-panel.open { right: 0; }
.theory-panel-close { position: absolute; top: 12px; right: 12px; cursor: pointer; font-size: 20px; color: var(--dim); background: none; border: none; }
.theory-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.3); z-index: 25; display: none; }
.theory-overlay.open { display: block; }

/* ===== SVG DIAGRAMS ===== */
.diagram { background: var(--card); border: 1px solid var(--border); border-radius: var(--r); padding: 14px; margin: 14px 0; text-align: center; overflow-x: auto; }
.diagram svg { max-width: 100%; height: auto; }
.diagram-cap { font-size: 11px; color: var(--dim); margin-top: 6px; font-style: italic; }

/* ===== LANDING PAGE ===== */
.landing-hero { text-align: center; padding: 24px 0 16px; }
.landing-logo {
  width: 64px; height: 64px; border-radius: 16px;
  background: linear-gradient(135deg, var(--accent), var(--accent-b));
  display: flex; align-items: center; justify-content: center; margin: 0 auto 12px;
  box-shadow: 0 4px 20px rgba(37,99,235,0.2);
}
.landing-logo svg { width: 36px; height: 36px; stroke: #fff; fill: none; stroke-width: 1.8; }
.landing-title { font-family: 'Fraunces', serif; font-size: 26px; font-weight: 700; color: var(--bright); margin-bottom: 4px; }
.landing-sub { font-size: 14px; color: var(--dim); max-width: 340px; margin: 0 auto; }

/* Progress ring */
.prog-ring { position: relative; display: inline-flex; align-items: center; justify-content: center; }
.prog-ring svg { transform: rotate(-90deg); }
.prog-ring-val { position: absolute; font-family: 'Space Mono', monospace; font-size: 18px; font-weight: 700; color: var(--bright); }

/* Phase sections */
.phase { margin: 20px 0 8px; }
.phase-head {
  display: flex; align-items: center; gap: 10px; padding: 10px 14px;
  background: var(--card); border: 1px solid var(--border);
  border-radius: var(--rs); margin-bottom: 8px; box-shadow: var(--shadow-sm);
}
.phase-num {
  width: 28px; height: 28px; border-radius: 8px; font-family: 'Space Mono', monospace;
  font-size: 12px; font-weight: 700; color: #fff; display: flex; align-items: center; justify-content: center; flex-shrink: 0;
}
.phase-num.p1 { background: var(--accent); } .phase-num.p2 { background: var(--gold); }
.phase-num.p3 { background: var(--purple); } .phase-num.p4 { background: var(--green); }
.phase-num.p5 { background: var(--pink); }
.phase-title { font-weight: 600; font-size: 14px; color: var(--bright); }
.phase-sub { font-size: 11px; color: var(--dim); }

/* Module cards on landing */
.mod-card {
  display: flex; align-items: center; gap: 12px;
  background: var(--card); border: 1px solid var(--border);
  border-radius: var(--r); padding: 14px 16px;
  margin-bottom: 8px; cursor: pointer;
  transition: all .2s; box-shadow: var(--shadow-sm);
  position: relative; overflow: hidden; text-decoration: none; color: inherit;
}
.mod-card::after { content: ''; position: absolute; bottom: 0; left: 0; height: 3px; width: 0; background: var(--green); transition: width .4s; }
.mod-card.done::after { width: 100%; }
.mod-card:hover { border-color: rgba(37,99,235,0.2); box-shadow: var(--shadow); }
.mod-card:active { transform: scale(0.98); }
.mod-card.locked { opacity: 0.4; pointer-events: none; }
.mod-num {
  width: 40px; height: 40px; border-radius: 10px; font-family: 'Space Mono', monospace;
  font-size: 15px; font-weight: 700; color: #fff;
  display: flex; align-items: center; justify-content: center; flex-shrink: 0;
}
.mod-card.done .mod-num { background: var(--green) !important; }
.mod-name { font-weight: 600; font-size: 14.5px; color: var(--bright); margin-bottom: 1px; }
.mod-desc { font-size: 11.5px; color: var(--dim); }
.mod-arrow { color: var(--muted); font-size: 16px; margin-left: auto; flex-shrink: 0; }
.mod-mastery {
  margin-left: auto; flex-shrink: 0;
  font-family: 'Space Mono', monospace; font-size: 11px; font-weight: 700;
  padding: 3px 8px; border-radius: 4px;
}
.mod-mastery.high { color: var(--green); background: var(--green-g); }
.mod-mastery.mid { color: var(--gold); background: var(--gold-g); }
.mod-mastery.low { color: var(--red); background: var(--red-g); }

/* ===== MODULE INTERNAL: Level cards ===== */
.lvl-card {
  display: flex; align-items: center; gap: 12px;
  background: var(--card); border: 1.5px solid var(--border);
  border-radius: var(--r); padding: 14px 16px; margin-bottom: 8px;
  cursor: pointer; transition: all .2s; box-shadow: var(--shadow-sm);
}
.lvl-card:hover:not(.locked) { border-color: rgba(37,99,235,0.2); }
.lvl-card:active:not(.locked) { transform: scale(0.98); }
.lvl-card.locked { opacity: 0.35; pointer-events: none; }
.lvl-card.done { border-color: rgba(5,150,105,0.2); }
.lvl-num {
  width: 42px; height: 42px; border-radius: 12px; font-family: 'Space Mono', monospace;
  font-size: 16px; font-weight: 700; color: #fff;
  display: flex; align-items: center; justify-content: center; flex-shrink: 0;
}
.lvl-card:nth-child(1) .lvl-num { background: var(--stA-a); }
.lvl-card:nth-child(2) .lvl-num { background: var(--stB-a); }
.lvl-card:nth-child(3) .lvl-num { background: var(--stC-a); }
.lvl-card:nth-child(4) .lvl-num { background: var(--stD-a); }
.lvl-card:nth-child(5) .lvl-num { background: var(--stE-a); }
.lvl-card.done .lvl-num { background: var(--green) !important; }
.lvl-name { font-weight: 600; font-size: 15px; color: var(--bright); margin-bottom: 1px; }
.lvl-sub { font-size: 11.5px; color: var(--dim); display: flex; align-items: center; gap: 6px; }
.lvl-arrow { color: var(--muted); margin-left: auto; font-size: 16px; }
/* Mastery bar on level card */
.lvl-mastery { width: 100%; height: 4px; border-radius: 2px; background: var(--border); margin-top: 6px; overflow: hidden; }
.lvl-mastery-fill { height: 100%; border-radius: 2px; transition: width .4s; }
.lvl-mastery-fill.high { background: var(--green); }
.lvl-mastery-fill.mid { background: var(--gold); }
.lvl-mastery-fill.low { background: var(--red); }

/* ===== EXERCISE PROGRESS PIPS ===== */
.ex-pips { display: flex; align-items: center; gap: 3px; justify-content: center; margin-bottom: 14px; flex-wrap: wrap; }
.ex-pip { width: 16px; height: 4px; border-radius: 2px; background: var(--border); transition: all .3s; }
.ex-pip.ok { background: var(--green); }
.ex-pip.fail { background: var(--red); }
.ex-pip.cur { background: var(--accent); width: 24px; }

/* ===== QUESTION ELEMENTS ===== */
.q-header { display: flex; align-items: center; gap: 8px; margin-bottom: 6px; }
.q-type {
  font-family: 'Space Mono', monospace; font-size: 9.5px; text-transform: uppercase;
  letter-spacing: 1px; color: var(--accent); padding: 2px 7px;
  background: var(--accent-g); border-radius: 4px;
}
.q-count { font-family: 'Space Mono', monospace; font-size: 10px; color: var(--muted); margin-left: auto; }
.q-text { font-size: 16px; font-weight: 500; color: var(--bright); margin-bottom: 14px; line-height: 1.55; }
.q-context {
  font-size: 13.5px; color: var(--dim); font-style: italic;
  margin-bottom: 12px; padding: 10px 12px;
  background: var(--bg2); border-radius: var(--rs);
  border-left: 2px solid var(--border);
}
/* Instruction */
.q-instr {
  font-size: 12.5px; color: var(--dim); margin-bottom: 12px;
  padding: 8px 12px; background: var(--bg2); border-radius: var(--rs);
  display: flex; align-items: flex-start; gap: 6px;
}
.q-instr svg { width: 14px; height: 14px; stroke: var(--accent); flex-shrink: 0; margin-top: 1px; }

/* ===== OPTIONS (single/multi) ===== */
.opt {
  display: flex; align-items: flex-start; gap: 12px;
  padding: 13px 14px; border: 1.5px solid var(--border);
  border-radius: var(--rs); margin-bottom: 6px;
  cursor: pointer; transition: all .2s; user-select: none;
}
.opt:active { transform: scale(0.98); }
.opt:hover:not(.disabled) { background: var(--bg2); }
.opt.picked { border-color: var(--accent); background: var(--accent-g); }
.opt.correct { border-color: var(--green); background: var(--green-g); }
.opt.wrong { border-color: var(--red); background: var(--red-g); }
.opt.reveal { border-color: var(--green); background: var(--green-g); opacity: .55; }
.opt.disabled { pointer-events: none; }
.opt-mark {
  width: 22px; height: 22px; border-radius: 50%; border: 2px solid var(--border);
  display: flex; align-items: center; justify-content: center; flex-shrink: 0;
  font-size: 11px; font-weight: 700; color: var(--muted); transition: all .2s;
}
.opt.picked .opt-mark { border-color: var(--accent); color: var(--accent); background: var(--accent-g); }
.opt.correct .opt-mark { border-color: var(--green); color: #fff; background: var(--green); }
.opt.wrong .opt-mark { border-color: var(--red); color: #fff; background: var(--red); }
.opt-mark.chk { border-radius: 5px; }
.opt-txt { font-size: 14.5px; color: var(--text); line-height: 1.5; flex: 1; }

/* ===== TRUE/FALSE ===== */
.tf-wrap { display: flex; gap: 8px; margin-bottom: 6px; }
.tf-btn {
  flex: 1; padding: 16px; border: 2px solid var(--border);
  border-radius: var(--rs); font-size: 16px; font-weight: 600;
  text-align: center; cursor: pointer; transition: all .15s;
  background: var(--card); color: var(--text);
}
.tf-btn:active { transform: scale(0.97); }
.tf-btn:hover:not(.disabled) { border-color: var(--accent); background: var(--accent-g); }
.tf-btn.correct { border-color: var(--green); background: var(--green-g); color: var(--green); }
.tf-btn.wrong { border-color: var(--red); background: var(--red-g); color: var(--red); }
.tf-btn.disabled { pointer-events: none; }

/* ===== CLASSIFY ===== */
.cl-cats { display: flex; gap: 6px; flex-wrap: wrap; }
.cl-cat {
  padding: 8px 14px; border-radius: 6px; font-size: 13px; font-weight: 500;
  border: 1.5px solid var(--border); background: var(--card); color: var(--text);
  cursor: pointer; transition: all .15s;
}
.cl-cat:active { transform: scale(0.96); }
.cl-cat:hover:not(.disabled) { border-color: var(--accent); }
.cl-cat.correct { border-color: var(--green); background: var(--green-g); color: var(--green); }
.cl-cat.wrong { border-color: var(--red); background: var(--red-g); color: var(--red); }
.cl-cat.disabled { pointer-events: none; }

/* ===== ORDER ===== */
.ord-pool { display: flex; flex-wrap: wrap; gap: 6px; margin-bottom: 8px; }
.ord-item {
  padding: 9px 14px; border-radius: 6px; font-size: 13px;
  border: 1.5px solid var(--border); background: var(--card); color: var(--text);
  cursor: pointer; transition: all .15s;
}
.ord-item:active { transform: scale(0.96); }
.ord-item.placed { opacity: 0.15; pointer-events: none; }
.ord-seq {
  min-height: 44px; border: 2px dashed var(--border); border-radius: var(--rs);
  padding: 8px; display: flex; flex-wrap: wrap; gap: 5px; margin-bottom: 6px;
}
.ord-placed {
  padding: 7px 12px; border-radius: 6px; font-size: 12px;
  background: var(--accent-g); border: 1px solid rgba(37,99,235,0.12); color: var(--accent);
  display: flex; align-items: center; gap: 5px; cursor: pointer;
}
.ord-placed .ord-n { font-family: 'Space Mono', monospace; font-size: 10px; font-weight: 700; }
.ord-placed.correct { background: var(--green-g); border-color: rgba(5,150,105,0.15); color: var(--green); }
.ord-placed.wrong { background: var(--red-g); border-color: rgba(220,38,38,0.15); color: var(--red); }
.ord-undo {
  font-size: 11px; color: var(--dim); cursor: pointer;
  padding: 4px 10px; border: 1px solid var(--border); border-radius: 5px;
  background: var(--card); display: none; align-items: center; gap: 4px;
}
.ord-undo.show { display: inline-flex; }

/* ===== FILL-IN-BLANK ===== */
.fib-text { font-size: 14.5px; color: var(--text); line-height: 2.2; margin-bottom: 10px; }
.fib-blank {
  display: inline-block; min-width: 100px; padding: 3px 10px;
  border-bottom: 2px dashed var(--accent); color: var(--accent);
  font-weight: 600; cursor: pointer; transition: all .15s;
  background: var(--accent-g); border-radius: 4px 4px 0 0; font-size: 13px;
}
.fib-blank.filled { border-bottom-style: solid; background: var(--bg2); color: var(--bright); }
.fib-blank.correct { border-color: var(--green); color: var(--green); background: var(--green-g); }
.fib-blank.wrong { border-color: var(--red); color: var(--red); background: var(--red-g); }
.fib-bank {
  display: flex; flex-wrap: wrap; gap: 5px; padding: 10px;
  background: var(--bg2); border-radius: var(--rs); margin-bottom: 10px;
}
.fib-opt {
  padding: 7px 12px; border-radius: 6px; font-size: 12.5px;
  border: 1.5px solid var(--border); background: var(--card); color: var(--text);
  cursor: pointer; transition: all .15s;
}
.fib-opt:active { transform: scale(0.95); }
.fib-opt.used { opacity: 0.2; pointer-events: none; }

/* ===== BUILD (drag to slots) ===== */
.build-slots { display: flex; flex-direction: column; gap: 8px; margin-bottom: 12px; }
.build-slot {
  display: flex; align-items: center; gap: 10px; padding: 12px;
  border: 2px dashed var(--border); border-radius: var(--rs);
  background: var(--bg2); min-height: 48px; transition: all .2s;
}
.build-slot-label {
  font-family: 'Space Mono', monospace; font-size: 10px; text-transform: uppercase;
  letter-spacing: 1px; color: var(--muted); flex-shrink: 0; width: 90px;
}
.build-slot-val {
  flex: 1; font-size: 13.5px; color: var(--bright); font-weight: 500;
  padding: 6px 10px; background: var(--accent-g); border-radius: 6px; border: 1px solid rgba(37,99,235,0.12);
  display: none;
}
.build-slot.filled .build-slot-val { display: block; }
.build-slot.filled { border-style: solid; border-color: rgba(37,99,235,0.15); }
.build-slot.correct { border-color: var(--green); background: var(--green-g); }
.build-slot.wrong { border-color: var(--red); background: var(--red-g); }
.build-pool { display: flex; flex-wrap: wrap; gap: 5px; }
.build-piece {
  padding: 8px 14px; border-radius: 6px; font-size: 13px;
  border: 1.5px solid var(--border); background: var(--card); color: var(--text);
  cursor: pointer; transition: all .15s;
}
.build-piece:active { transform: scale(0.95); }
.build-piece.used { opacity: 0.15; pointer-events: none; }

/* ===== MATCH (connect) ===== */
.match-wrap { display: flex; gap: 16px; align-items: flex-start; margin-bottom: 12px; }
.match-col { flex: 1; display: flex; flex-direction: column; gap: 6px; }
.match-item {
  padding: 10px 12px; border-radius: var(--rs); font-size: 13px;
  border: 1.5px solid var(--border); background: var(--card); color: var(--text);
  cursor: pointer; transition: all .15s; text-align: center;
}
.match-item:hover:not(.disabled) { border-color: var(--accent); }
.match-item.selected { border-color: var(--accent); background: var(--accent-g); color: var(--accent); }
.match-item.correct { border-color: var(--green); background: var(--green-g); color: var(--green); }
.match-item.wrong { border-color: var(--red); background: var(--red-g); color: var(--red); }
.match-item.disabled { pointer-events: none; }

/* ===== SPEED MODE ===== */
.speed-bar { height: 5px; background: var(--border); border-radius: 3px; margin-bottom: 12px; overflow: hidden; }
.speed-fill { height: 100%; border-radius: 3px; transition: width linear; }
.speed-fill.ok { background: var(--green); }
.speed-fill.warn { background: var(--gold); }
.speed-fill.crit { background: var(--red); }
.speed-stat { text-align: center; margin-bottom: 10px; }
.speed-stat b { font-family: 'Space Mono', monospace; font-size: 26px; color: var(--bright); }
.speed-stat span { font-size: 11px; color: var(--dim); display: block; }

/* ===== PATIENT FILE ===== */
.patient {
  background: var(--card); border: 1.5px solid rgba(217,119,6,0.15);
  border-radius: var(--r); padding: 16px; margin-bottom: 14px;
  box-shadow: 0 2px 10px rgba(217,119,6,0.04);
}
.patient-head { display: flex; align-items: center; gap: 10px; margin-bottom: 10px; }
.patient-avatar {
  width: 44px; height: 44px; border-radius: 12px;
  display: flex; align-items: center; justify-content: center;
  font-size: 18px; font-weight: 700; color: #fff; flex-shrink: 0;
}
.patient-avatar.f { background: linear-gradient(135deg, #db2777, #f472b6); }
.patient-avatar.m { background: linear-gradient(135deg, #2563eb, #60a5fa); }
.patient-avatar.c { background: linear-gradient(135deg, #d97706, #fbbf24); }
.patient-name { font-family: 'Fraunces', serif; font-size: 16px; font-weight: 700; color: var(--bright); }
.patient-age { font-size: 11.5px; color: var(--dim); }
.patient-badge {
  font-family: 'Space Mono', monospace; font-size: 9px; text-transform: uppercase;
  letter-spacing: .8px; padding: 3px 8px; border-radius: 4px;
  background: var(--gold-g); color: var(--gold); border: 1px solid rgba(217,119,6,0.12);
  margin-left: auto;
}
.patient-quote {
  font-size: 14px; font-style: italic; color: var(--text); line-height: 1.65;
  padding: 10px 12px; background: var(--bg2); border-radius: var(--rs);
  border-left: 3px solid var(--gold);
}

/* ===== FEEDBACK ===== */
.fb {
  padding: 12px 14px; border-radius: var(--rs); margin-top: 10px;
  font-size: 13.5px; line-height: 1.6; display: none;
}
.fb.show { display: block; animation: fbIn .3s ease; }
@keyframes fbIn { from { opacity: 0; transform: translateY(8px); } to { opacity: 1; transform: translateY(0); } }
.fb.ok { background: var(--green-g); border: 1px solid rgba(5,150,105,0.15); color: var(--green); }
.fb.fail { background: var(--red-g); border: 1px solid rgba(220,38,38,0.1); color: var(--red); }
[data-theme="dark"] .fb.ok { color: var(--green-b); }
[data-theme="dark"] .fb.fail { color: var(--red-b); }
.fb strong { display: block; margin-bottom: 3px; font-size: 13px; }
.fb-hint {
  margin-top: 6px; padding: 6px 10px; background: var(--purple-g);
  border-radius: 4px; font-size: 12px; color: var(--purple); display: none;
}
.fb-hint.show { display: block; }

/* ===== MASTERY GATE ===== */
.gate { text-align: center; padding: 20px; }
.gate-icon { font-size: 48px; margin-bottom: 10px; }
.gate-title { font-family: 'Fraunces', serif; font-size: 22px; font-weight: 700; color: var(--bright); margin-bottom: 6px; }
.gate-sub { font-size: 14px; color: var(--dim); margin-bottom: 16px; max-width: 320px; margin-left: auto; margin-right: auto; }
.gate-bar { width: 200px; height: 8px; border-radius: 4px; background: var(--border); margin: 0 auto 8px; overflow: hidden; }
.gate-bar-fill { height: 100%; border-radius: 4px; }
.gate-score { font-family: 'Space Mono', monospace; font-size: 14px; font-weight: 700; margin-bottom: 16px; }

/* ===== SUMMARY ===== */
.sum-circle {
  width: 120px; height: 120px; border-radius: 50%; border: 5px solid var(--border);
  display: flex; flex-direction: column; align-items: center; justify-content: center;
  margin: 16px auto; transition: border-color .4s;
}
.sum-circle.great { border-color: var(--green); }
.sum-circle.ok { border-color: var(--gold); }
.sum-circle.low { border-color: var(--red); }
.sum-score { font-family: 'Space Mono', monospace; font-size: 36px; font-weight: 700; color: var(--bright); }
.sum-total { font-size: 12px; color: var(--dim); }
.sum-msg { text-align: center; font-family: 'Fraunces', serif; font-size: 20px; font-weight: 600; color: var(--bright); margin: 10px 0 4px; }
.sum-sub { text-align: center; font-size: 13px; color: var(--dim); margin-bottom: 14px; }

/* Skills breakdown */
.skills-grid { display: flex; flex-direction: column; gap: 6px; margin: 12px 0; }
.skill-row { display: flex; align-items: center; gap: 8px; font-size: 13px; }
.skill-name { flex: 1; color: var(--text); }
.skill-bar { width: 80px; height: 5px; border-radius: 3px; background: var(--border); overflow: hidden; }
.skill-bar-fill { height: 100%; border-radius: 3px; }
.skill-pct { font-family: 'Space Mono', monospace; font-size: 11px; font-weight: 700; width: 32px; text-align: right; }

/* Review cards */
.review-card { background: var(--red-g); border: 1px solid rgba(220,38,38,0.08); border-radius: var(--rs); padding: 10px 12px; margin-bottom: 6px; }
.review-q { font-size: 13px; color: var(--bright); margin-bottom: 3px; }
.review-a { font-size: 12px; color: var(--green); }

/* Cheatsheet */
.cheat { background: var(--card); border: 1.5px solid var(--accent); border-radius: var(--r); padding: 16px; margin-top: 14px; }
.cheat-title { font-family: 'Fraunces', serif; font-size: 15px; font-weight: 700; color: var(--accent); margin-bottom: 8px; }
.cheat-item { font-size: 12.5px; color: var(--text); padding: 5px 0; border-bottom: 1px solid var(--border2); }

/* ===== DASHBOARD ===== */
.dash-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin: 12px 0; }
.dash-stat {
  background: var(--card); border: 1px solid var(--border);
  border-radius: var(--rs); padding: 12px; text-align: center;
}
.dash-stat b { font-family: 'Space Mono', monospace; font-size: 22px; color: var(--bright); display: block; }
.dash-stat span { font-size: 10px; color: var(--dim); text-transform: uppercase; letter-spacing: .5px; }

/* ===== ANIMATIONS ===== */
@keyframes fadeUp { from { opacity: 0; transform: translateY(12px); } to { opacity: 1; transform: translateY(0); } }
.anim { animation: fadeUp .35s ease forwards; }
.d1 { animation-delay: .06s; opacity: 0; }
.d2 { animation-delay: .12s; opacity: 0; }
.d3 { animation-delay: .18s; opacity: 0; }
@keyframes shake { 0%,100% { transform: translateX(0); } 25% { transform: translateX(-5px); } 75% { transform: translateX(5px); } }
.shake { animation: shake .35s ease; }

/* ===== RESPONSIVE ===== */
@media (min-width: 640px) {
  body { font-size: 16.5px; }
  .content { padding: 24px 24px 100px; }
  .bottombar { padding: 12px 24px; }
  .card { padding: 22px 24px; }
  .opt-txt { font-size: 15px; }
  .dash-grid { grid-template-columns: repeat(4, 1fr); }
}
@media (min-width: 768px) {
  .app { max-width: 680px; margin: 0 auto; left: 50%; transform: translateX(-50%); right: auto; width: 100%; border-left: 1px solid var(--border2); border-right: 1px solid var(--border2); }
  .topbar, .bottombar { max-width: 680px; left: 50%; transform: translateX(-50%); right: auto; width: 100%; }
  .content { padding: 28px 32px 110px; }
  .bottombar { padding: 14px 32px; border-radius: 12px 12px 0 0; }
  .opt:hover:not(.disabled) { background: var(--accent-g); border-color: rgba(37,99,235,0.15); }
  .theory-panel { width: 400px; }
}
@media (min-width: 1024px) {
  .app { max-width: 760px; box-shadow: 0 0 60px rgba(0,0,0,0.04); }
  .topbar, .bottombar { max-width: 760px; }
  body { font-size: 17px; }
  .content { padding: 32px 40px 120px; }
  .card { padding: 24px 32px; }
}
