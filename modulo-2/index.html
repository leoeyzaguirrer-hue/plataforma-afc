<!DOCTYPE html>
<html lang="es" data-theme="light">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>M√≥dulo 2 ‚Äî Tipos de Conducta ¬∑ AFC Praxis</title>
<link href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,wght@0,300;0,400;0,500;0,600;0,700;1,400&family=Space+Mono:wght@400;700&family=Fraunces:ital,opsz,wght@0,9..144,300;0,9..144,600;0,9..144,700;1,9..144,400&display=swap" rel="stylesheet">
<!-- ENGINE: Identical CSS+JS from Module 1 afc_praxis.html ‚Äî only MODULE DATA differs -->
<style>
:root,[data-theme="light"]{--bg:#f0f4f8;--bg2:#f7f9fc;--card:#fff;--card2:#f4f7fa;--text:#334155;--dim:#64748b;--bright:#0f172a;--muted:#94a3b8;--accent:#0891b2;--accent-b:#22d3ee;--accent-g:rgba(8,145,178,0.06);--accent-l:#cffafe;--gold:#d97706;--gold-b:#f59e0b;--gold-g:rgba(217,119,6,0.06);--green:#059669;--green-b:#10b981;--green-g:rgba(5,150,105,0.06);--red:#dc2626;--red-b:#ef4444;--red-g:rgba(220,38,38,0.05);--purple:#7c3aed;--purple-g:rgba(124,58,237,0.05);--border:rgba(15,23,42,0.08);--border2:rgba(15,23,42,0.04);--shadow:0 2px 8px rgba(0,0,0,0.06);--shadow-lg:0 8px 30px rgba(0,0,0,0.08);--overlay:rgba(255,255,255,0.92);--r:14px;--rs:10px}
[data-theme="dark"]{--bg:#0f172a;--bg2:#1e293b;--card:#1e293b;--card2:#334155;--text:#cbd5e1;--dim:#94a3b8;--bright:#f1f5f9;--muted:#64748b;--accent:#22d3ee;--accent-b:#67e8f9;--accent-g:rgba(34,211,238,0.1);--accent-l:#164e63;--gold:#fbbf24;--gold-b:#fcd34d;--gold-g:rgba(251,191,36,0.08);--green:#34d399;--green-b:#6ee7b7;--green-g:rgba(52,211,153,0.08);--red:#f87171;--red-b:#fca5a5;--red-g:rgba(248,113,113,0.08);--purple:#a78bfa;--purple-g:rgba(167,139,250,0.08);--border:rgba(148,163,184,0.12);--border2:rgba(148,163,184,0.06);--shadow:0 2px 8px rgba(0,0,0,0.2);--shadow-lg:0 8px 30px rgba(0,0,0,0.3);--overlay:rgba(15,23,42,0.95);--r:14px;--rs:10px}
*{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent}:focus-visible{outline:2px solid var(--accent);outline-offset:2px;border-radius:4px}html,body{height:100%;overflow:hidden;background:var(--bg);color:var(--text);font-family:'DM Sans',system-ui,sans-serif;font-size:18px;line-height:1.65;transition:background .3s,color .3s}.app{position:fixed;inset:0;display:flex;flex-direction:column;z-index:1}
.top{display:flex;align-items:center;gap:10px;padding:10px 16px;height:56px;background:var(--overlay);backdrop-filter:blur(12px);-webkit-backdrop-filter:blur(12px);border-bottom:1px solid var(--border);flex-shrink:0;z-index:20}.top-back{width:38px;height:38px;border-radius:10px;background:var(--bg);border:1px solid var(--border);color:var(--accent);display:flex;align-items:center;justify-content:center;cursor:pointer;transition:all .15s;flex-shrink:0}.top-back:hover{background:var(--accent-g);border-color:var(--accent)}.top-back svg{width:18px;height:18px;stroke:currentColor;fill:none;stroke-width:2.5;stroke-linecap:round;stroke-linejoin:round}.top-t{font-family:'Fraunces',serif;font-size:16px;font-weight:600;color:var(--bright);line-height:1.2}.top-s{font-size:12px;color:var(--dim)}.top-prog{margin-left:auto;display:flex;align-items:center;gap:6px;flex-shrink:0}.top-prog-bar{width:52px;height:5px;border-radius:3px;background:var(--border);overflow:hidden}.top-prog-fill{height:100%;background:var(--accent);border-radius:3px;transition:width .4s}.top-prog-pct{font-family:'Space Mono',monospace;font-size:11px;color:var(--dim)}.top-acts{display:flex;gap:4px;flex-shrink:0}.top-btn{width:36px;height:36px;border-radius:8px;background:transparent;border:1px solid var(--border);color:var(--dim);display:flex;align-items:center;justify-content:center;cursor:pointer;transition:all .15s}.top-btn:hover{color:var(--accent);border-color:var(--accent);background:var(--accent-g)}.top-btn svg{width:16px;height:16px;stroke:currentColor;fill:none;stroke-width:2}
.cnt{flex:1;overflow-y:auto;overflow-x:hidden;padding:20px 16px 110px;-webkit-overflow-scrolling:touch}.cnt::-webkit-scrollbar{width:3px}.cnt::-webkit-scrollbar-thumb{background:var(--border);border-radius:3px}.bot{position:fixed;bottom:0;left:0;right:0;padding:10px 16px;padding-bottom:max(10px,env(safe-area-inset-bottom));background:var(--overlay);backdrop-filter:blur(12px);border-top:1px solid var(--border2);z-index:20;display:flex;gap:8px}
.btn{flex:1;padding:14px 20px;border-radius:var(--rs);font-family:'DM Sans',sans-serif;font-size:16px;font-weight:600;border:none;cursor:pointer;transition:all .15s;text-align:center;display:inline-flex;align-items:center;justify-content:center;gap:6px}.btn:active{transform:scale(0.97)}.btn-p{background:var(--accent);color:#fff;box-shadow:0 2px 10px rgba(8,145,178,0.2)}.btn-p:disabled{opacity:.35;pointer-events:none}.btn-g{background:var(--green);color:#fff}.btn-o{background:var(--card);color:var(--text);border:1px solid var(--border);flex:none}.btn-w{background:var(--gold);color:#fff}.btn-sm{flex:none;padding:10px 16px;font-size:14px}.btn-icon{flex:none;width:44px;padding:0}
.card{background:var(--card);border:1px solid var(--border);border-radius:var(--r);padding:22px;margin-bottom:14px;box-shadow:var(--shadow)}.tag{font-family:'Space Mono',monospace;font-size:11px;text-transform:uppercase;letter-spacing:1px;display:inline-flex;align-items:center;gap:5px;padding:4px 10px;border-radius:6px;margin-bottom:10px}.tag-b{color:var(--accent);background:var(--accent-g)}.tag-g{color:var(--gold);background:var(--gold-g)}.tag-gr{color:var(--green);background:var(--green-g)}.tag-p{color:var(--purple);background:var(--purple-g)}.card-t{font-family:'Fraunces',serif;font-size:22px;font-weight:700;color:var(--bright);line-height:1.3;margin-bottom:6px}.card-d{font-size:16px;color:var(--dim);line-height:1.6}
.prose{font-size:16px;color:var(--text);line-height:1.75}.prose p{margin-bottom:10px}.prose b,.prose strong{color:var(--bright)}.callout{background:var(--accent-g);border-left:3px solid var(--accent);padding:14px 16px;border-radius:0 var(--rs) var(--rs) 0;margin:12px 0;font-size:15px;color:var(--bright);line-height:1.65}.callout em{color:var(--accent);font-style:normal;font-weight:600}.callout-g{background:var(--gold-g);border-color:var(--gold)}.callout-g em{color:var(--gold)}.ex-box{background:var(--bg2);border:1px solid var(--border);border-radius:var(--rs);padding:14px 16px;margin:12px 0}.ex-box-l{font-size:11px;font-weight:700;color:var(--accent);text-transform:uppercase;letter-spacing:.8px;margin-bottom:4px}.ex-box p{font-size:15px;color:var(--text);margin:0;line-height:1.6}
.acc{border:1px solid var(--border);border-radius:var(--rs);margin-bottom:8px;overflow:hidden;background:var(--card)}.acc-h{display:flex;align-items:center;gap:10px;padding:14px 16px;cursor:pointer;user-select:none}.acc-i{width:30px;height:30px;border-radius:8px;display:flex;align-items:center;justify-content:center;font-size:16px;flex-shrink:0}.acc-l{font-weight:600;font-size:16px;color:var(--bright);flex:1}.acc-a{font-size:10px;color:var(--muted);transition:transform .3s}.acc.open .acc-a{transform:rotate(180deg)}.acc-b{max-height:0;overflow:hidden;transition:max-height .4s ease}.acc.open .acc-b{max-height:2000px}.acc-in{padding:0 16px 16px}
.tp-overlay{position:fixed;inset:0;background:rgba(0,0,0,0.3);z-index:25;display:none}.tp-overlay.open{display:block}.tp{position:fixed;top:56px;right:0;bottom:0;width:88%;max-width:420px;background:var(--card);border-left:1px solid var(--border);z-index:30;overflow-y:auto;padding:20px;box-shadow:-4px 0 20px rgba(0,0,0,0.1);display:none}.tp.open{display:block}.tp-close{position:absolute;top:12px;right:12px;cursor:pointer;font-size:22px;color:var(--dim);background:none;border:none}
.tip{position:relative;border-bottom:1.5px dashed var(--accent);cursor:help;color:var(--accent);font-weight:500}.tip::after{content:attr(data-tip);position:absolute;bottom:calc(100% + 6px);left:50%;transform:translateX(-50%);background:var(--bright);color:var(--bg);padding:8px 12px;border-radius:8px;font-size:13px;font-weight:400;line-height:1.5;white-space:normal;width:240px;z-index:50;box-shadow:var(--shadow-lg);pointer-events:none;opacity:0;transition:opacity .2s}.tip:hover::after,.tip:focus::after{opacity:1}@media(max-width:640px){.tip::after{left:0;transform:none;width:200px}}
.lcard{display:flex;align-items:center;gap:14px;background:var(--card);border:1.5px solid var(--border);border-radius:var(--r);padding:16px 18px;margin-bottom:10px;cursor:pointer;transition:all .2s;box-shadow:var(--shadow)}.lcard:hover:not(.locked){border-color:rgba(8,145,178,0.2);box-shadow:var(--shadow-lg)}.lcard:active:not(.locked){transform:scale(0.98)}.lcard.locked{opacity:.35;pointer-events:none}.lcard.done{border-color:rgba(5,150,105,0.2)}.lcard-icon{width:50px;height:50px;border-radius:14px;display:flex;align-items:center;justify-content:center;font-size:24px;flex-shrink:0}.lcard.done .lcard-icon{background:var(--green-g)!important}.lcard-name{font-weight:600;font-size:16px;color:var(--bright);margin-bottom:2px}.lcard-sub{font-size:13px;color:var(--dim)}.lcard-arrow{color:var(--muted);margin-left:auto;font-size:20px}.lbar{width:100%;height:4px;border-radius:2px;background:var(--border);margin-top:6px;overflow:hidden}.lbar-f{height:100%;border-radius:2px;transition:width .4s}
.pips{display:flex;align-items:center;gap:3px;justify-content:center;margin-bottom:16px;flex-wrap:wrap}.pip{width:18px;height:5px;border-radius:3px;background:var(--border);transition:all .3s}.pip.ok{background:var(--green)}.pip.fail{background:var(--red)}.pip.cur{background:var(--accent);width:26px}
.q-h{display:flex;align-items:center;gap:8px;margin-bottom:8px}.q-type{font-size:22px}.q-tag{font-family:'Space Mono',monospace;font-size:10px;text-transform:uppercase;letter-spacing:1px;color:var(--accent);padding:3px 8px;background:var(--accent-g);border-radius:4px}.q-n{font-family:'Space Mono',monospace;font-size:11px;color:var(--muted);margin-left:auto}.q-text{font-size:18px;font-weight:500;color:var(--bright);margin-bottom:16px;line-height:1.55}.q-ctx{font-size:15px;color:var(--dim);font-style:italic;margin-bottom:14px;padding:12px 14px;background:var(--bg2);border-radius:var(--rs);border-left:3px solid var(--border)}
.opt{display:flex;align-items:flex-start;gap:12px;padding:14px 16px;border:1.5px solid var(--border);border-radius:var(--rs);margin-bottom:7px;cursor:pointer;transition:all .2s;user-select:none}.opt:active{transform:scale(0.98)}.opt:hover:not(.dis){background:var(--bg2)}.opt.pick{border-color:var(--accent);background:var(--accent-g)}.opt.ok{border-color:var(--green);background:var(--green-g)}.opt.bad{border-color:var(--red);background:var(--red-g)}.opt.rev{border-color:var(--green);background:var(--green-g);opacity:.5}.opt.dis{pointer-events:none}.opt-m{width:24px;height:24px;border-radius:50%;border:2px solid var(--border);display:flex;align-items:center;justify-content:center;flex-shrink:0;font-size:12px;font-weight:700;color:var(--muted);transition:all .2s}.opt.pick .opt-m{border-color:var(--accent);color:var(--accent);background:var(--accent-g)}.opt.ok .opt-m{border-color:var(--green);color:#fff;background:var(--green)}.opt.bad .opt-m{border-color:var(--red);color:#fff;background:var(--red)}.opt-m.chk{border-radius:6px}.opt-t{font-size:16px;color:var(--text);line-height:1.5;flex:1}
.tf{display:flex;gap:10px;margin-bottom:8px}.tf-b{flex:1;padding:18px;border:2px solid var(--border);border-radius:var(--rs);font-size:18px;font-weight:600;text-align:center;cursor:pointer;transition:all .15s;background:var(--card);color:var(--text)}.tf-b:active{transform:scale(0.97)}.tf-b:hover:not(.dis){border-color:var(--accent);background:var(--accent-g)}.tf-b.ok{border-color:var(--green);background:var(--green-g);color:var(--green)}.tf-b.bad{border-color:var(--red);background:var(--red-g);color:var(--red)}.tf-b.dis{pointer-events:none}
.cl-cats{display:flex;gap:8px;flex-wrap:wrap}.cl-c{padding:10px 18px;border-radius:8px;font-size:15px;font-weight:500;border:1.5px solid var(--border);background:var(--card);color:var(--text);cursor:pointer;transition:all .15s}.cl-c:active{transform:scale(0.96)}.cl-c.ok{border-color:var(--green);background:var(--green-g);color:var(--green)}.cl-c.bad{border-color:var(--red);background:var(--red-g);color:var(--red)}.cl-c.dis{pointer-events:none}
.mat-w{display:flex;gap:12px;align-items:flex-start;margin-bottom:12px}.mat-c{flex:1;display:flex;flex-direction:column;gap:6px}.mat-i{padding:12px;border-radius:var(--rs);font-size:14px;border:1.5px solid var(--border);background:var(--card);color:var(--text);cursor:pointer;transition:all .15s;text-align:center}.mat-i:hover:not(.dis){border-color:var(--accent)}.mat-i.sel{border-color:var(--accent);background:var(--accent-g);color:var(--accent)}.mat-i.ok{border-color:var(--green);background:var(--green-g);color:var(--green)}.mat-i.bad{border-color:var(--red);background:var(--red-g);color:var(--red)}.mat-i.dis{pointer-events:none}
.pat{background:var(--card);border:1.5px solid rgba(217,119,6,0.15);border-radius:var(--r);padding:18px;margin-bottom:14px;box-shadow:0 2px 10px rgba(217,119,6,0.04)}.pat-h{display:flex;align-items:center;gap:12px;margin-bottom:12px}.pat-av{width:48px;height:48px;border-radius:14px;display:flex;align-items:center;justify-content:center;font-size:20px;font-weight:700;color:#fff;flex-shrink:0}.pat-av.f{background:linear-gradient(135deg,#db2777,#f472b6)}.pat-av.m{background:linear-gradient(135deg,#2563eb,#60a5fa)}.pat-av.c{background:linear-gradient(135deg,#d97706,#fbbf24)}.pat-name{font-family:'Fraunces',serif;font-size:18px;font-weight:700;color:var(--bright)}.pat-age{font-size:12px;color:var(--dim)}.pat-badge{font-family:'Space Mono',monospace;font-size:9px;text-transform:uppercase;letter-spacing:.8px;padding:3px 8px;border-radius:4px;background:var(--gold-g);color:var(--gold);border:1px solid rgba(217,119,6,0.12);margin-left:auto}.pat-q{font-size:16px;font-style:italic;color:var(--text);line-height:1.65;padding:12px 14px;background:var(--bg2);border-radius:var(--rs);border-left:3px solid var(--gold)}
.fb{padding:14px 16px;border-radius:var(--rs);margin-top:12px;font-size:15px;line-height:1.6;display:none}.fb.show{display:block;animation:fbIn .3s ease}@keyframes fbIn{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}.fb.fbok{background:var(--green-g);border:1px solid rgba(5,150,105,0.15);color:var(--green)}.fb.fbfail{background:var(--red-g);border:1px solid rgba(220,38,38,0.1);color:var(--red)}[data-theme="dark"] .fb.fbok{color:var(--green-b)}[data-theme="dark"] .fb.fbfail{color:var(--red-b)}.fb strong{display:block;margin-bottom:3px;font-size:14px}
.gate{text-align:center;padding:20px}.gate-ic{font-size:52px;margin-bottom:10px}.gate-t{font-family:'Fraunces',serif;font-size:24px;font-weight:700;color:var(--bright);margin-bottom:6px}.gate-d{font-size:15px;color:var(--dim);margin-bottom:16px;max-width:320px;margin-left:auto;margin-right:auto}.gate-bar{width:200px;height:8px;border-radius:4px;background:var(--border);margin:0 auto 8px;overflow:hidden}.gate-bar-f{height:100%;border-radius:4px}.gate-sc{font-family:'Space Mono',monospace;font-size:15px;font-weight:700;margin-bottom:16px}
.sum-c{width:130px;height:130px;border-radius:50%;border:5px solid var(--border);display:flex;flex-direction:column;align-items:center;justify-content:center;margin:16px auto}.sum-c.great{border-color:var(--green)}.sum-c.mid{border-color:var(--gold)}.sum-c.low{border-color:var(--red)}.sum-n{font-family:'Space Mono',monospace;font-size:40px;font-weight:700;color:var(--bright)}.sum-t{font-size:13px;color:var(--dim)}.sum-msg{text-align:center;font-family:'Fraunces',serif;font-size:22px;font-weight:600;color:var(--bright);margin:10px 0 4px}.sum-sub{text-align:center;font-size:14px;color:var(--dim);margin-bottom:14px}
.sk-grid{display:flex;flex-direction:column;gap:6px;margin:12px 0}.sk-r{display:flex;align-items:center;gap:8px;font-size:14px}.sk-name{flex:1;color:var(--text)}.sk-bar{width:80px;height:5px;border-radius:3px;background:var(--border);overflow:hidden}.sk-bar-f{height:100%;border-radius:3px}.sk-pct{font-family:'Space Mono',monospace;font-size:12px;font-weight:700;width:36px;text-align:right}
.rev{background:var(--red-g);border:1px solid rgba(220,38,38,0.08);border-radius:var(--rs);padding:10px 12px;margin-bottom:6px}.rev-q{font-size:14px;color:var(--bright);margin-bottom:3px}.rev-a{font-size:13px;color:var(--green)}
.cheat{background:var(--card);border:1.5px solid var(--accent);border-radius:var(--r);padding:18px;margin-top:14px}.cheat-t{font-family:'Fraunces',serif;font-size:16px;font-weight:700;color:var(--accent);margin-bottom:8px}.cheat-i{font-size:14px;color:var(--text);padding:5px 0;border-bottom:1px solid var(--border2)}
.ring{position:relative;display:inline-flex;align-items:center;justify-content:center}.ring svg{transform:rotate(-90deg)}.ring-v{position:absolute;font-family:'Space Mono',monospace;font-size:20px;font-weight:700;color:var(--bright)}
@keyframes up{from{opacity:0;transform:translateY(14px)}to{opacity:1;transform:translateY(0)}}.anim{animation:up .35s ease forwards}.d1{animation-delay:.06s;opacity:0}.d2{animation-delay:.12s;opacity:0}.d3{animation-delay:.18s;opacity:0}@keyframes shake{0%,100%{transform:translateX(0)}25%{transform:translateX(-5px)}75%{transform:translateX(5px)}}.shake{animation:shake .35s ease}@keyframes confDrop{0%{transform:translateY(-20px) rotate(0);opacity:1}100%{transform:translateY(50vh) rotate(720deg);opacity:0}}
@media(min-width:640px){body{font-size:18px}.cnt{padding:24px 24px 100px}.card{padding:24px 28px}}@media(min-width:768px){.app{max-width:700px;margin:0 auto;left:50%;transform:translateX(-50%);right:auto;width:100%;border-left:1px solid var(--border2);border-right:1px solid var(--border2)}.top,.bot{max-width:700px;left:50%;transform:translateX(-50%);right:auto;width:100%}.cnt{padding:28px 32px 110px}}@media(min-width:1024px){.app{max-width:780px}.top,.bot{max-width:780px}body{font-size:19px}}
</style>
</head>
<body>
<div class="app" id="app"></div>
<div id="confWrap" style="position:fixed;top:0;left:0;right:0;height:50vh;pointer-events:none;z-index:999;overflow:hidden"></div>
<script>
const IC={back:'<svg viewBox="0 0 24 24"><polyline points="15 18 9 12 15 6"/></svg>',book:'<svg viewBox="0 0 24 24"><path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"/><path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"/></svg>',moon:'<svg viewBox="0 0 24 24"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/></svg>',sun:'<svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>',x:'<svg viewBox="0 0 24 24"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>',refresh:'<svg viewBox="0 0 24 24"><polyline points="23 4 23 10 17 10"/><path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"/></svg>'};
const MASTERY=0.8,SKEY='afcp_',LVL_N=['Discriminaci√≥n','Profundizaci√≥n','P√∫blico vs Privado','La interacci√≥n','Simulaci√≥n'],LVL_E=['üî¨','‚öôÔ∏è','üîí','üåê','üè•'],LVL_C=['var(--accent)','var(--gold)','var(--purple)','#059669','#db2777'];
let MOD=null,$a=null,S={view:'home',mod:'m2',level:0,exIdx:0,seqIdx:0,pool:[],answers:{},tpOpen:false},P={};
function sKey(){return SKEY+S.mod}function loadP(){try{const d=localStorage.getItem(sKey());if(d)P=JSON.parse(d)}catch(e){}if(!P.scores)P.scores={};if(!P.errors)P.errors={};if(!P.skills)P.skills={}}function saveP(){try{localStorage.setItem(sKey(),JSON.stringify(P))}catch(e){}}
function isDk(){return document.documentElement.getAttribute('data-theme')==='dark'}function togDk(){const h=document.documentElement,d=h.getAttribute('data-theme')==='dark'?'light':'dark';h.setAttribute('data-theme',d);localStorage.setItem(SKEY+'theme',d);render()}
(function(){const t=localStorage.getItem(SKEY+'theme');if(t)document.documentElement.setAttribute('data-theme',t)})();
const $=id=>document.getElementById(id);function shuffle(a){const r=[...a];for(let i=r.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[r[i],r[j]]=[r[j],r[i]]}return r}function fireConfetti(){const w=$('confWrap');const cols=['#059669','#0891b2','#d97706','#db2777','#7c3aed'];for(let i=0;i<20;i++){const c=document.createElement('div');c.style.cssText=`position:absolute;width:${4+Math.random()*6}px;height:${4+Math.random()*6}px;left:${Math.random()*100}%;background:${cols[i%5]};border-radius:2px;animation:confDrop 1.2s ease-out ${Math.random()*0.3}s forwards;opacity:0;`;w.appendChild(c);setTimeout(()=>c.remove(),1600)}}

// ========== MODULE 2 DATA ==========
const MODULE={
id:'m2',phase:'Fase 1 ¬∑ Fundamentos',title:'Tipos de Conducta',
description:'Respondiente vs operante, p√∫blica vs privada, y la conducta como interacci√≥n organismo-entorno.',
icon:'üî¨',color:'#0891b2',colorB:'#22d3ee',
levels:[
// ===== NIVEL 1: Respondiente vs Operante (Discriminaci√≥n) =====
{title:'Respondiente vs Operante',description:'Aprende a distinguir los dos tipos fundamentales de conducta.',showCount:12,
cheat:['Respondiente = elicitada por un est√≠mulo (E‚ÜíR)','Operante = emitida, seleccionada por consecuencias (R‚ÜíEr)','CC no crea respuestas nuevas, solo nuevas relaciones E-R','CO favorece aparici√≥n de conductas nuevas','La mayor parte del repertorio adulto es operante'],
theory:[
{icon:'üî¨',title:'Dos tipos de conducta',color:'accent',body:'<p>Desde el an√°lisis del comportamiento, existen dos tipos b√°sicos de conducta:</p><div class="ex-box"><div class="ex-box-l">Conducta Respondiente (Cond. Cl√°sico)</div><p>Es <strong>elicitada</strong> (provocada) por un est√≠mulo antecedente. Sigue un esquema <b>E ‚Üí R</b>. La aparici√≥n del est√≠mulo incondicionado (EI) es <strong>independiente</strong> de lo que haga el sujeto. Los reflejos innatos y las respuestas condicionadas cl√°sicamente pertenecen a este tipo.</p></div><div class="ex-box"><div class="ex-box-l">Conducta Operante (Cond. Operante)</div><p>Es <strong>emitida</strong> por el organismo. Su probabilidad futura depende de sus <strong>consecuencias</strong>. Sigue un esquema <b>R ‚Üí Er</b>. La aparici√≥n de la consecuencia <strong>depende</strong> de la conducta del sujeto. La mayor parte del repertorio conductual adulto es operante.</p></div><div class="callout"><em>Diferencia clave:</em> En la respondiente, el est√≠mulo "provoca" la respuesta. En la operante, el organismo "emite" la respuesta y las consecuencias la seleccionan. Como dice Skinner, la conducta operante es "emitida m√°s que elicitada".</div>'},
{icon:'‚ö°',title:'Condicionamiento Cl√°sico (CC)',color:'gold',body:'<p>En el CC, un est√≠mulo inicialmente neutro (EN) se asocia repetidamente con un est√≠mulo incondicionado (EI) que ya provoca una respuesta refleja (RI). Tras la asociaci√≥n, el EN se convierte en est√≠mulo condicionado (EC) que elicita una respuesta condicionada (RC) similar a la RI.</p><div class="ex-box"><div class="ex-box-l">Ejemplo cl√≠nico: Fobia</div><p>Una persona queda <b>atrapada en un ascensor</b> (EI) ‚Üí miedo intenso (RI).<br>Despu√©s, solo <b>ver un ascensor</b> (EC) ‚Üí ansiedad (RC).<br><br>El CC no crea respuestas nuevas: la ansiedad ya exist√≠a como respuesta al EI. Lo nuevo es que ahora el ascensor solo (EC) tambi√©n la provoca.</p></div>'},
{icon:'‚öôÔ∏è',title:'Condicionamiento Operante (CO)',color:'green',body:'<p>En el CO, la conducta se selecciona por sus consecuencias. Lo que ocurre DESPU√âS de la conducta determina si se repetir√° o no.</p><div class="ex-box"><div class="ex-box-l">Elementos del CO</div><p>üìå <b>Est√≠mulo Discriminativo (Ed):</b> Se√±ala que si se emite la conducta, habr√° una consecuencia. "Evoca" la conducta.<br><br>üéØ <b>Respuesta Operante:</b> Conducta emitida que puede ser reforzada o castigada.<br><br>‚û°Ô∏è <b>Consecuencia:</b> Modifica la probabilidad futura de la conducta (refuerzo o castigo).</p></div><p>La operante <strong>no se define por su forma</strong> (topograf√≠a) sino por su <strong>funci√≥n</strong> ‚Äî los efectos que produce. Puede ser tan simple como presionar una palanca o tan compleja como estudiar una carrera.</p>'},
{icon:'üîó',title:'CC y CO interact√∫an',color:'purple',body:'<p>En la vida real, ambos procesos suelen ocurrir simult√°neamente. El modelo de Mowrer (Teor√≠a Bifactorial) estableci√≥ que existe continuidad entre ambos:</p><div class="callout"><em>Aprendemos a reaccionar emocionalmente</em> ante est√≠mulos por CC, y <em>a dar respuestas instrumentales</em> ante esos est√≠mulos por CO.</div><div class="ex-box"><div class="ex-box-l">Ejemplo: Fobia a los perros</div><p>1Ô∏è‚É£ <b>CC:</b> Mordedura (EI) ‚Üí miedo (RI). Despu√©s, ver perro (EC) ‚Üí miedo (RC).<br>2Ô∏è‚É£ <b>CO:</b> Evitar el parque (R) ‚Üí miedo baja (R-) ‚Üí evita m√°s parques.<br><br>El CC explica c√≥mo se adquiere el miedo. El CO explica c√≥mo se mantiene la evitaci√≥n.</p></div>'}
],
exercises:[
{type:'tf',skill:'tipos_conducta',s:'"Salivar al oler comida" es conducta respondiente.',c:true,ok:'El olor (EI) provoca autom√°ticamente la salivaci√≥n (RI). Es un reflejo.',fail:'Salivar ante el olor es una respuesta refleja elicitada por el est√≠mulo.'},
{type:'tf',skill:'tipos_conducta',s:'"Llamar por tel√©fono para pedir pizza" es conducta respondiente.',c:false,ok:'Es operante: emitida por el sujeto, mantenida por la consecuencia (obtener pizza = R+).',fail:'Es operante: la persona emite la conducta para producir una consecuencia.'},
{type:'tf',skill:'tipos_conducta',s:'En el condicionamiento cl√°sico, la respuesta depende de las consecuencias.',c:false,ok:'En el CC, el sujeto es expuesto a los est√≠mulos con independencia de lo que haga. Las consecuencias son irrelevantes.',fail:'En CC la respuesta es elicitada por el est√≠mulo, no por las consecuencias. Eso es operante.'},
{type:'tf',skill:'tipos_conducta',s:'"Taquicardia al ver a tu ex en la calle" es conducta respondiente.',c:true,ok:'La taquicardia es una RC elicitada por el EC (ver al ex), asociado a experiencias emocionales previas (EI).',fail:'La taquicardia es una respuesta condicionada cl√°sicamente (fisiol√≥gica, autom√°tica).'},
{type:'tf',skill:'tipos_conducta',s:'La mayor parte del repertorio conductual adulto es respondiente.',c:false,ok:'Solo una peque√±a fracci√≥n se explica por CC. La mayor parte es operante (Skinner).',fail:'Skinner argument√≥ que la mayor parte del repertorio adulto es operante.'},
{type:'tf',skill:'tipos_conducta',s:'El condicionamiento cl√°sico puede crear respuestas completamente nuevas.',c:false,ok:'El CC no crea respuestas nuevas ‚Äî crea nuevas relaciones entre est√≠mulos y respuestas que ya exist√≠an.',fail:'El CC solo genera nuevas relaciones E-R, no nuevas respuestas.'},
{type:'tf',skill:'tipos_conducta',s:'"Estudiar para un examen" es conducta operante.',c:true,ok:'Es emitida por el sujeto y mantenida por sus consecuencias (aprobar = R+, evitar suspenso = R-).',fail:'Estudiar es operante: emitida y seleccionada por consecuencias.'},
{type:'tf',skill:'tipos_conducta',s:'Un mismo est√≠mulo puede funcionar como EC y como Ed simult√°neamente.',c:true,ok:'En la vida real, CC y CO interact√∫an. Un est√≠mulo puede elicitar una RC (CC) y al mismo tiempo se√±alar disponibilidad de refuerzo (CO).',fail:'S√≠: un est√≠mulo puede ser EC (elicita ansiedad) y Ed (se√±ala que evitar ser√° reforzado) a la vez.'},
{type:'classify',skill:'tipos_conducta',categories:['üîµ Respondiente','üü† Operante'],items:[
{text:'Sudoraci√≥n al entrar en un ascensor (fobia)',cat:'üîµ Respondiente'},
{text:'Evitar coger el ascensor',cat:'üü† Operante'},
{text:'Parpadear ante un soplo de aire',cat:'üîµ Respondiente'},
{text:'Mentir para evitar un castigo',cat:'üü† Operante'},
{text:'N√°useas al oler un alimento que te sent√≥ mal',cat:'üîµ Respondiente'},
{text:'Estudiar la noche antes del examen',cat:'üü† Operante'},
{text:'Taquicardia al o√≠r un portazo (tras maltrato)',cat:'üîµ Respondiente'},
{text:'Llamar a tu madre cuando te sientes mal',cat:'üü† Operante'}
]},
{type:'match',skill:'tipos_conducta',text:'Empareja cada concepto con su tipo de conducta:',
pairs:[{left:'Elicitada por est√≠mulo',right:'Respondiente'},{left:'Emitida por el sujeto',right:'Operante'},{left:'Esquema E ‚Üí R',right:'Cond. Cl√°sico'},{left:'Esquema R ‚Üí Er',right:'Cond. Operante'}],
ok:'Respondiente = elicitada (E‚ÜíR). Operante = emitida (R‚ÜíEr).'},
{type:'single',skill:'tipos_conducta',text:'üêï Ana fue mordida por un perro. Ahora, al ver un perro, siente taquicardia. ¬øQu√© tipo de aprendizaje explica la taquicardia?',opts:['Condicionamiento Operante','Condicionamiento Cl√°sico','Aprendizaje vicario','Ninguno, es innato'],c:1,ok:'La taquicardia es una RC elicitada por el EC (perro), tras asociarse con el EI (mordedura).',fail:'Mordedura (EI) ‚Üí miedo (RI). Ahora perro (EC) ‚Üí taquicardia (RC). Es condicionamiento cl√°sico.'},
{type:'single',skill:'tipos_conducta',text:'üêï Adem√°s, Ana cruza la calle cuando ve un perro. ¬øQu√© tipo de aprendizaje explica CRUZAR?',opts:['Condicionamiento Cl√°sico','Condicionamiento Operante','Es un reflejo','Aprendizaje latente'],c:1,ok:'Cruzar es una operante mantenida por R- (reduce la ansiedad al alejarse del EC).',fail:'Cruzar la calle es operante: emitida y mantenida porque reduce la ansiedad (R-).'},
{type:'single',skill:'tipos_conducta',text:'üß™ ¬øCu√°l es la diferencia PRINCIPAL entre CC y CO?',opts:['En CC la conducta depende de antecedentes, en CO de consecuencias','CC es para animales, CO para humanos','CC crea conductas nuevas, CO no','CC es m√°s importante que CO'],c:0,ok:'En CC la respuesta es provocada por est√≠mulos antecedentes. En CO la conducta es seleccionada por sus consecuencias.',fail:'CC = antecedentes provocan la respuesta. CO = consecuencias seleccionan la conducta.'}
]},
// ===== NIVEL 2: Profundizaci√≥n CC y CO =====
{title:'Elementos del CC y CO',description:'Identifica los componentes espec√≠ficos de cada proceso.',showCount:10,
cheat:['CC: EI‚ÜíRI, EN+EI‚ÜíEC‚ÜíRC','CO: Ed‚ÜíR‚ÜíConsecuencia','Reforzador lo es por su funci√≥n, no por su forma','Extinci√≥n CC: presentar EC sin EI','Extinci√≥n CO: emitir R sin consecuencia'],
theory:[
{icon:'üß™',title:'Elementos del Cond. Cl√°sico',color:'accent',body:'<div class="ex-box"><div class="ex-box-l">Los 5 elementos</div><p>üî¥ <b>EI (Est√≠mulo Incondicionado):</b> Desencadena respuesta refleja innata. Ej: comida en la boca.<br><br>üü° <b>RI (Respuesta Incondicionada):</b> Respuesta refleja, no aprendida. Ej: salivaci√≥n ante comida.<br><br>‚ö™ <b>EN (Est√≠mulo Neutro):</b> No provoca respuesta significativa. Ej: sonido de campana.<br><br>üîµ <b>EC (Est√≠mulo Condicionado):</b> El EN, tras asociarse al EI, pasa a elicitar la respuesta. Ej: campana sola ‚Üí salivaci√≥n.<br><br>üü¢ <b>RC (Respuesta Condicionada):</b> Similar a la RI, pero elicitada por el EC. Ej: salivar ante la campana.</p></div><div class="callout"><em>Clave cl√≠nica:</em> Un est√≠mulo puede provocar una RC en una persona y no en otra. Todo depende de si se ha establecido la asociaci√≥n. Por eso el ascensor es EC para alguien que qued√≥ atrapado, pero sigue siendo EN para quien nunca tuvo esa experiencia.</div>'},
{icon:'‚öôÔ∏è',title:'Elementos del Cond. Operante',color:'gold',body:'<div class="ex-box"><div class="ex-box-l">La triple contingencia</div><p>üìç <b>Ed (Est√≠mulo Discriminativo):</b> Se√±ala que la consecuencia est√° disponible SI se emite la conducta. "Evoca" pero no "provoca".<br><br>üéØ <b>Respuesta Operante:</b> Conducta emitida. Puede modificarse en frecuencia, intensidad y duraci√≥n seg√∫n consecuencias.<br><br>‚û°Ô∏è <b>Consecuencia:</b> Modifica probabilidad futura. Se clasifica por:<br>‚Ä¢ Qu√© pasa: se <em>a√±ade</em> (+) o se <em>retira</em> (-) algo<br>‚Ä¢ Efecto: conducta <em>sube</em> (refuerzo) o <em>baja</em> (castigo)</p></div>'},
{icon:'üîÑ',title:'Extinci√≥n en ambos procesos',color:'green',body:'<div class="ex-box"><div class="ex-box-l">Extinci√≥n en CC</div><p>Presentar el EC repetidamente <b>sin el EI</b> ‚Üí la RC se debilita gradualmente.<br>Ej: Exponer al ascensor sin que ocurra nada malo ‚Üí el miedo disminuye.</p></div><div class="ex-box"><div class="ex-box-l">Extinci√≥n en CO</div><p>Emitir la R <b>sin que llegue la consecuencia</b> ‚Üí la conducta disminuye.<br>Ej: Ni√±o llora y NO obtiene atenci√≥n ‚Üí llora menos.</p></div><div class="callout callout-g"><em>Ojo con la incubaci√≥n:</em> A veces, si la exposici√≥n al EC es breve pero intensa, y la persona escapa a√∫n con mucha ansiedad, en vez de extinguirse la RC se intensifica. La intensidad de la RC funciona como reforzador de la asociaci√≥n.</div>'}
],
exercises:[
{type:'single',skill:'elementos_cc',text:'üîî En el experimento de Pavlov, ¬øqu√© papel cumple la campana ANTES del condicionamiento?',opts:['EI','EC','EN','RI'],c:2,ok:'La campana inicialmente no provoca salivaci√≥n: es un est√≠mulo neutro (EN).',fail:'Antes del condicionamiento, la campana es EN (no provoca la respuesta).'},
{type:'single',skill:'elementos_cc',text:'üîî Y DESPU√âS del condicionamiento, ¬øen qu√© se convierte la campana?',opts:['EI','EC','EN','Ed'],c:1,ok:'Tras asociarse al EI (comida), la campana pasa a ser EC ‚Äî ahora elicita salivaci√≥n (RC).',fail:'Tras la asociaci√≥n con el EI, el EN se convierte en EC.'},
{type:'single',skill:'elementos_co',text:'üö¶ Un sem√°foro en verde se√±ala que si cruzas, llegar√°s al otro lado. ¬øQu√© funci√≥n tiene el verde?',opts:['EI','EC','Ed (Est√≠mulo discriminativo)','Reforzador'],c:2,ok:'El verde se√±ala disponibilidad de la consecuencia (cruzar seguro) si se emite la conducta (caminar). Es un Ed.',fail:'El sem√°foro verde es un Ed: se√±ala que la respuesta (cruzar) ser√° reforzada.'},
{type:'single',skill:'elementos_co',text:'üíä Tomar ibuprofeno (R) ‚Üí desaparece dolor de cabeza (consecuencia). ¬øTipo de contingencia?',opts:['R+ (a√±ade algo bueno)','R- (elimina algo aversivo)','C+ (a√±ade algo aversivo)','C- (retira algo bueno)'],c:1,ok:'Se elimina un est√≠mulo aversivo (dolor) ‚Üí conducta sube = Reforzamiento Negativo.',fail:'Desaparece el dolor (aversivo) ‚Üí la conducta de tomar ibuprofeno se refuerza = R-.'},
{type:'single',skill:'elementos_cc',text:'üè• Mar√≠a fue operada (EI) con dolor postoperatorio (RI). Ahora el olor a hospital (EC) le produce n√°useas (RC). ¬øC√≥mo extinguir la RC?',opts:['Castigar las n√°useas','Exponer al olor del hospital repetidamente sin que ocurra el dolor','Evitar hospitales','Tomar ansiol√≠ticos'],c:1,ok:'Extinci√≥n en CC: presentar el EC (olor) repetidamente sin el EI (dolor/operaci√≥n) hasta que la RC se debilite.',fail:'Extinci√≥n CC = EC sin EI repetidamente.'},
{type:'classify',skill:'elementos_cc',categories:['üîµ Cond. Cl√°sico','üü† Cond. Operante'],items:[
{text:'Ni√±o teme al dentista tras una extracci√≥n dolorosa',cat:'üîµ Cond. Cl√°sico'},
{text:'Ni√±o llora para que le lleven del dentista',cat:'üü† Cond. Operante'},
{text:'Perro saliva al o√≠r el abrelatas',cat:'üîµ Cond. Cl√°sico'},
{text:'Perro se sienta cuando le muestran comida',cat:'üü† Cond. Operante'},
{text:'Taquicardia al o√≠r una sirena de ambulancia',cat:'üîµ Cond. Cl√°sico'},
{text:'Conducir m√°s lento al ver un radar',cat:'üü† Cond. Operante'}
]},
{type:'single',skill:'elementos_co',text:'üë¶ Ni√±o grita en supermercado ‚Üí padre le compra chuche ‚Üí ni√±o grita m√°s en el futuro. ¬øFunci√≥n del grito?',opts:['RC elicitada por el supermercado','Operante mantenida por R+ (obtiene chuche)','C+ porque el padre se enfada','Conducta innata'],c:1,ok:'El grito produce algo deseable (chuche) ‚Üí la conducta sube = R+.',fail:'Grito ‚Üí chuche (a√±ade deseable) ‚Üí grita m√°s = R+.'},
{type:'tf',skill:'elementos_co',s:'Un reforzador se define por su morfolog√≠a (aspecto f√≠sico), no por su efecto sobre la conducta.',c:false,ok:'Un reforzador lo es por su FUNCI√ìN: si aumenta la probabilidad de la conducta. No importa qu√© aspecto tenga.',fail:'Reforzador = funci√≥n sobre la conducta. Un rega√±o puede ser R+ si la conducta aumenta.'},
{type:'single',skill:'elementos_cc',text:'üï∑Ô∏è Persona con fobia ve ara√±a (EC), escapa r√°pido (2 seg). La ansiedad era alt√≠sima. ¬øQu√© puede ocurrir?',opts:['La fobia se extingue','Incubaci√≥n: la RC se intensifica en vez de extinguirse','Nada, es igual','Se generaliza a todos los insectos'],c:1,ok:'Exposici√≥n breve + alta intensidad de RC + escape ‚Üí la intensidad de la RC puede reforzar la asociaci√≥n EC-RC (incubaci√≥n).',fail:'Incubaci√≥n: la exposici√≥n breve pero intensa puede fortalecer la RC en vez de extinguirla.'},
{type:'match',skill:'elementos_cc',text:'Empareja cada proceso de extinci√≥n con su tipo:',
pairs:[{left:'EC sin EI repetidamente',right:'Extinci√≥n en CC'},{left:'R sin consecuencia',right:'Extinci√≥n en CO'},{left:'Elicitar sin provoca dolor',right:'Exposici√≥n (CC)'},{left:'No dar atenci√≥n al llanto',right:'Extinci√≥n operante'}],
ok:'CC: EC sin EI. CO: R sin consecuencia.'}
]},
// ===== NIVEL 3: P√∫blica vs Privada =====
{title:'Conducta p√∫blica y privada',description:'Lo privado tambi√©n es conducta ‚Äî con los mismos principios.',showCount:10,
cheat:['Privada ‚â† mental. Privada = accesibilidad limitada','Mismos principios de aprendizaje para ambas','Tipos: interoceptiva, propioceptiva, visi√≥n condicionada, visi√≥n operante, verbal encubierta','Pensar = conducta verbal encubierta','Las emociones no causan conducta: tambi√©n son conducta que debe ser explicada'],
theory:[
{icon:'üîí',title:'P√∫blica vs Privada: solo accesibilidad',color:'accent',body:'<p>La distinci√≥n entre conducta <strong>p√∫blica</strong> y <strong>privada</strong> no es de naturaleza, sino de <strong>accesibilidad</strong>. Un evento privado se distingue porque su accesibilidad es limitada (solo lo observa quien lo emite), pero no por una estructura o naturaleza especial.</p><div class="callout"><em>Regla fundamental:</em> Los eventos privados siguen <strong>las mismas leyes</strong> que la conducta p√∫blica. Un pensamiento se adquiere, se mantiene y se modifica por los mismos principios de aprendizaje que cualquier conducta observable.</div><p>Esto implica que las conductas privadas <b>no pueden ser una explicaci√≥n de la conducta</b> ‚Äî son algo que tambi√©n requiere ser explicado. Decir "evita el ascensor porque tiene ansiedad" no explica nada: ¬øpor qu√© tiene ansiedad? Esa ansiedad es conducta que necesita su propio an√°lisis funcional.</p>'},
{icon:'üß†',title:'Tipos de estimulaci√≥n privada',color:'gold',body:'<p>Podemos distinguir varios tipos de conducta/estimulaci√≥n privada:</p><div class="ex-box"><div class="ex-box-l">1. Interoceptiva / Propioceptiva</div><p>Eventos biol√≥gicos: posici√≥n del cuerpo, temperatura, dolor, estado de los √≥rganos internos. Son informaci√≥n del cuerpo sobre el cuerpo.</p></div><div class="ex-box"><div class="ex-box-l">2. Visi√≥n condicionada (CC)</div><p>Ciertos est√≠mulos producen respuestas privadas condicionadas. Ej: oler un perfume ‚Üí imagen de una persona que lo usaba. Es una RC privada.</p></div><div class="ex-box"><div class="ex-box-l">3. Visi√≥n operante (CO)</div><p>Imaginar algo sin est√≠mulo presente, controlado por consecuencias. Ej: imaginar objetos en un examen de f√≠sica para resolver un problema.</p></div><div class="ex-box"><div class="ex-box-l">4. Conducta verbal encubierta (pensar)</div><p>"Me va a salir mal", "no valgo para nada" ‚Äî son verbalizaciones encubiertas que funcionan como est√≠mulos para otras conductas.</p></div>'},
{icon:'üí¨',title:'Pensar = conducta verbal encubierta',color:'green',body:'<p>¬øDe d√≥nde viene el pensamiento? La secuencia de desarrollo es:</p><div class="callout"><em>1¬∫</em> El ni√±o habla con otros (conducta verbal p√∫blica) ‚Üí <em>2¬∫</em> Se habla a s√≠ mismo en voz alta ‚Üí <em>3¬∫</em> Habla consigo mismo de forma privada (pensar).</div><p>¬øPor qu√© una conducta se vuelve encubierta?</p><div class="ex-box"><div class="ex-box-l">Razones para la emisi√≥n encubierta</div><p>üîã <b>Econom√≠a de esfuerzo:</b> Las operantes tienden a emitirse de la forma m√°s sencilla posible.<br><br>‚è±Ô∏è <b>Menor demora:</b> Pensando, el hablante-oyente (misma persona) omite aclaraciones, reforzamiento m√°s r√°pido.<br><br>üõ°Ô∏è <b>Evitaci√≥n del castigo:</b> Verbalizaciones castigadas tienden a emitirse de forma encubierta (R-).<br><br>üîä <b>Auto-estimulaci√≥n:</b> El hablante se comporta consigo mismo como oyente, produciendo est√≠mulos que controlan su propia conducta.</p></div>'}
],
exercises:[
{type:'tf',skill:'pub_priv',s:'La conducta privada tiene una naturaleza diferente a la p√∫blica y requiere principios distintos para ser explicada.',c:false,ok:'La diferencia es solo de accesibilidad, no de naturaleza. Los mismos principios de aprendizaje aplican a ambas.',fail:'La diferencia es de accesibilidad, no de naturaleza. Mismos principios.'},
{type:'tf',skill:'pub_priv',s:'"Imaginar la cara de un ser querido al oler su perfume" es conducta privada.',c:true,ok:'Es una respuesta condicionada privada (visi√≥n condicionada). El perfume (EC) evoca una imagen (RC privada).',fail:'Es visi√≥n condicionada: el perfume (EC) elicita la imagen (RC privada).'},
{type:'tf',skill:'pub_priv',s:'"Evita el ascensor porque tiene ansiedad" es una explicaci√≥n funcional adecuada.',c:false,ok:'La ansiedad no EXPLICA la evitaci√≥n ‚Äî es conducta que tambi√©n necesita ser explicada. ¬øPor qu√© tiene ansiedad? ¬øQu√© mantiene la evitaci√≥n?',fail:'La ansiedad no es causa: es conducta (privada) que tambi√©n requiere explicaci√≥n.'},
{type:'tf',skill:'pub_priv',s:'Los pensamientos pueden funcionar como est√≠mulos discriminativos para otras conductas.',c:true,ok:'Una verbalizaci√≥n encubierta ("voy a suspender") puede funcionar como Ed para conductas de evitaci√≥n, estudio, etc.',fail:'S√≠: pensar "voy a suspender" puede evocar conductas de estudio o de evitaci√≥n.'},
{type:'single',skill:'pub_priv',text:'üí≠ "Imaginar comida cuando est√°s a dieta" es un ejemplo de:',opts:['Visi√≥n condicionada (CC)','Visi√≥n operante (CO)','Reflejo incondicionado','Conducta p√∫blica'],c:1,ok:'No hay est√≠mulo presente que la provoque. Est√° controlada por nivel de privaci√≥n (hambre) y es reforzada por la estimulaci√≥n que produce = visi√≥n operante.',fail:'Imaginar comida sin est√≠mulo presente, controlado por privaci√≥n = visi√≥n operante (CO).'},
{type:'single',skill:'pub_priv',text:'üßí Un ni√±o de 3 a√±os habla solo mientras juega: "ahora el coche va por aqu√≠...". ¬øQu√© representa?',opts:['Un trastorno de conducta','Paso intermedio: de hablar con otros a hablar consigo mismo (pensar)','Conducta respondiente','Imaginaci√≥n pura'],c:1,ok:'Es el paso 2 del desarrollo: hablar con otros ‚Üí hablar solo en voz alta ‚Üí pensamiento (habla encubierta).',fail:'Es la etapa intermedia: conducta verbal p√∫blica dirigida a uno mismo, que luego se har√° encubierta.'},
{type:'classify',skill:'pub_priv',categories:['üü¢ P√∫blica','üî¥ Privada'],items:[
{text:'Gritar a un compa√±ero',cat:'üü¢ P√∫blica'},
{text:'Pensar "no deb√≠ decir eso"',cat:'üî¥ Privada'},
{text:'Taquicardia antes de una entrevista',cat:'üî¥ Privada'},
{text:'Llamar por tel√©fono al jefe',cat:'üü¢ P√∫blica'},
{text:'Imaginar las vacaciones del verano',cat:'üî¥ Privada'},
{text:'Morderse las u√±as en clase',cat:'üü¢ P√∫blica'}
]},
{type:'single',skill:'pub_priv',text:'üõ°Ô∏è Ana piensa "mi jefe es idiota" pero NUNCA lo dice en voz alta. ¬øPor qu√© la conducta verbal se emite solo de forma encubierta?',opts:['Porque es un pensamiento irracional','Porque decirlo en voz alta ser√≠a castigado (evitaci√≥n del castigo)','Porque los pensamientos son involuntarios','Porque no tiene importancia'],c:1,ok:'Las verbalizaciones castigadas tienden a emitirse de forma encubierta por R- (evitaci√≥n del castigo social).',fail:'Decirlo ser√≠a castigado ‚Üí se emite encubiertamente por evitaci√≥n del castigo (R-).'},
{type:'single',skill:'pub_priv',text:'üìù "Decirse a uno mismo: ¬°bien hecho! tras completar una tarea". ¬øQu√© funci√≥n cumple?',opts:['Ninguna, es solo pensamiento','Funciona como autorreforzador que aumenta la probabilidad de repetir la tarea','Es un reflejo condicionado','Es conducta respondiente'],c:1,ok:'El autorreforzamiento verbal encubierto funciona como R+ que mantiene la conducta. Aunque su eficacia puede extinguirse sin refuerzo social ocasional.',fail:'Es autoestimulaci√≥n verbal que funciona como reforzador generalizando del tipo "¬°Bien!".'},
{type:'single',skill:'pub_priv',text:'‚ùì ¬øCu√°l es la posici√≥n del an√°lisis del comportamiento sobre los eventos privados?',opts:['No existen','Existen pero no son cient√≠ficos','Son conducta real con las mismas leyes que la p√∫blica','Son la causa principal de la conducta'],c:2,ok:'Los eventos privados son conducta real, con accesibilidad limitada, pero misma naturaleza y mismos principios de aprendizaje.',fail:'Son conducta real. Misma naturaleza, mismos principios, diferente accesibilidad.'}
]},
// ===== NIVEL 4: La conducta como interacci√≥n =====
{title:'Conducta = interacci√≥n',description:'La conducta no es solo la respuesta ‚Äî es el campo completo organismo-entorno.',showCount:8,
cheat:['Conducta = interacci√≥n organismo (con historia) ‚Üî entorno','No es solo R, es todo el campo E‚ÜîR','Causas en el ambiente (externo e interno)','Tres niveles: filogen√©tico, ontogen√©tico, contexto actual','Sin contexto, la conducta no se entiende'],
theory:[
{icon:'üåê',title:'La conducta como campo interactivo',color:'accent',body:'<p>La psicolog√≠a, desde el an√°lisis del comportamiento, estudia la <strong>interacci√≥n de los organismos con su entorno</strong> desde un nivel funcional. La conducta NO es solo la respuesta del sujeto ‚Äî es <strong>todo el campo</strong> que incluye organismo, entorno y la relaci√≥n entre ambos.</p><div class="callout"><em>Analog√≠a:</em> Si un coche va a 100 km/h por una carretera, la "conducta" no es solo el coche. Es todo el evento: coche + carretera + velocidad + direcci√≥n. Sin la carretera no hay "ir a 100 km/h".</div><p>De la misma forma, "gritar" no es conducta sin contexto. "Gritar" ante un gol en el estadio y "gritar" a tu pareja en una discusi√≥n son conductas completamente distintas aunque la topograf√≠a (acci√≥n de gritar) sea id√©ntica.</p>'},
{icon:'üî¨',title:'Tres niveles de influencia ambiental',color:'gold',body:'<p>El ambiente afecta a la conducta en tres niveles:</p><div class="ex-box"><div class="ex-box-l">1. Filogen√©tico (especie)</div><p>Circunstancias en las que una especie evolucion√≥. Los reflejos innatos, las predisposiciones biol√≥gicas.</p></div><div class="ex-box"><div class="ex-box-l">2. Ontogen√©tico (historia de aprendizaje)</div><p>La historia individual de cada organismo: todas sus experiencias previas de condicionamiento (CC y CO). √önica para cada individuo.</p></div><div class="ex-box"><div class="ex-box-l">3. Contexto actual</div><p>Las contingencias estimulares presentes en el momento de la interacci√≥n. El mismo individuo con la misma historia se comporta diferente seg√∫n el contexto presente.</p></div><div class="callout callout-g"><em>Implicaci√≥n cl√≠nica:</em> Dos personas con "depresi√≥n" tienen historias y contextos diferentes ‚Üí an√°lisis funcional diferente ‚Üí intervenci√≥n diferente. La etiqueta no determina el tratamiento.</div>'},
{icon:'‚ö°',title:'Causas de la conducta: siempre en el ambiente',color:'green',body:'<p>Las causas de la conducta se sit√∫an en el <strong>ambiente</strong> ‚Äî tanto externo como interno. Se descartan causas metaf√≠sicas (alma, voluntad, mente como entidad separada).</p><div class="callout"><em>Esto no significa ignorar lo interno.</em> Lo privado (pensamientos, emociones, sensaciones) es parte del ambiente interno del organismo. Pero lo privado no EXPLICA la conducta ‚Äî tambi√©n es conducta que necesita ser explicada.</div><div class="ex-box"><div class="ex-box-l">Error circular</div><p>‚ùå "¬øPor qu√© no sale de casa?" ‚Üí "Porque tiene depresi√≥n"<br>‚ùå "¬øC√≥mo sabemos que tiene depresi√≥n?" ‚Üí "Porque no sale de casa"<br><br>‚úÖ "No sale de casa (R) porque cuando intenta salir siente n√°useas (RC-CC) y al quedarse en casa las n√°useas bajan (R-CO)"</p></div>'}
],
exercises:[
{type:'tf',skill:'interaccion',s:'La conducta se puede entender completamente analizando solo la respuesta del sujeto, sin considerar el contexto.',c:false,ok:'La conducta es interacci√≥n organismo-entorno. Sin contexto, la respuesta no tiene significado funcional.',fail:'Sin contexto no hay an√°lisis funcional. "Gritar" puede ser R+, R-, o incluso conducta social adecuada.'},
{type:'tf',skill:'interaccion',s:'"Tiene depresi√≥n y por eso no sale de casa" es una explicaci√≥n funcional.',c:false,ok:'Es circular: no sale ‚Üí depresi√≥n ‚Üí no sale. Una explicaci√≥n funcional identifica antecedentes y consecuencias espec√≠ficas.',fail:'Es circular. Funcional ser√≠a: ¬øqu√© pasa cuando intenta salir? ¬øqu√© obtiene al quedarse?'},
{type:'single',skill:'interaccion',text:'üèüÔ∏è Pedro grita: (A) ante un gol en el estadio, (B) a su hijo cuando tira comida. ¬øMisma conducta?',opts:['S√≠, ambos gritan','No: misma topograf√≠a, diferente funci√≥n y contexto','S√≠, ambos expresan emociones','No: uno es operante y el otro respondiente'],c:1,ok:'La topograf√≠a (gritar) es similar, pero la funci√≥n, el contexto y las consecuencias son completamente diferentes.',fail:'Misma forma ‚â† misma conducta. El contexto y la funci√≥n las hacen conductas distintas.'},
{type:'single',skill:'interaccion',text:'üß¨ ¬øCu√°l de estos NO es un nivel de influencia ambiental sobre la conducta?',opts:['Filogen√©tico (especie)','Ontogen√©tico (historia individual)','Contexto actual','Voluntad libre del individuo'],c:3,ok:'Las causas de la conducta est√°n en el ambiente a tres niveles: filogen√©tico, ontogen√©tico y contextual. No en una "voluntad" metaf√≠sica.',fail:'Los tres niveles son: filogen√©tico, ontogen√©tico y contextual. No hay un nivel de "voluntad libre".'},
{type:'single',skill:'interaccion',text:'ü§î "Mi paciente es agresivo porque tiene un trastorno explosivo intermitente." ¬øQu√© problema tiene esta afirmaci√≥n?',opts:['Es correcta, el diagn√≥stico explica la conducta','Es circular: el diagn√≥stico se basa en la conducta que pretende explicar','Falta especificar el subtipo','Necesita m√°s tests'],c:1,ok:'Es explicaci√≥n circular. El trastorno se diagnostica por la agresividad ‚Üí no puede ser causa de la agresividad.',fail:'Circular: ¬øc√≥mo sabemos que lo tiene? Porque es agresivo. ¬øPor qu√© es agresivo? Porque tiene el trastorno.'},
{type:'single',skill:'interaccion',text:'üë©‚Äç‚öïÔ∏è Dos pacientes "con depresi√≥n": Ana no sale de casa, Pedro trabaja 14h/d√≠a. ¬øQu√© implica esto para la intervenci√≥n?',opts:['Misma etiqueta = mismo tratamiento','Cada uno necesita su propio an√°lisis funcional','Uno tiene depresi√≥n real y el otro no','Hay que medicar a ambos igual'],c:1,ok:'Misma etiqueta, contingencias completamente diferentes. El AF individual es lo que gu√≠a la intervenci√≥n, no el diagn√≥stico.',fail:'Misma etiqueta ‚â† mismo tratamiento. Cada caso tiene su propio AF.'},
{type:'tf',skill:'interaccion',s:'Los pensamientos y emociones son la causa √∫ltima de la conducta.',c:false,ok:'Son conducta privada que tambi√©n necesita ser explicada por variables ambientales. No son "la causa", son parte del fen√≥meno a analizar.',fail:'Los pensamientos y emociones son conducta que tambi√©n requiere explicaci√≥n, no son causas √∫ltimas.'},
{type:'tf',skill:'interaccion',s:'Un mismo individuo puede comportarse de forma muy diferente en contextos distintos, aunque su historia de aprendizaje sea la misma.',c:true,ok:'El contexto actual (contingencias presentes) afecta a la conducta. Una persona puede ser "t√≠mida" en el trabajo y "extrovertida" con amigos ‚Äî el contexto var√≠a.',fail:'El contexto actual modifica qu√© conductas se emiten, independientemente de la historia.'},
{type:'single',skill:'interaccion',text:'üìã ¬øQu√© significa que la conducta es "interacci√≥n"?',opts:['Que siempre involucra a dos personas','Que es la relaci√≥n bidireccional entre organismo y entorno, no solo la respuesta aislada','Que los genes determinan la conducta','Que toda conducta es social'],c:1,ok:'Conducta = interacci√≥n organismo ‚Üî entorno. Incluye ambos polos y la relaci√≥n funcional entre ellos.',fail:'Es la relaci√≥n funcional entre organismo (con historia) y entorno. No solo la respuesta.'}
]},
// ===== NIVEL 5: Casos cl√≠nicos =====
{title:'Casos cl√≠nicos integradores',description:'Aplica respondiente/operante, p√∫blico/privado y an√°lisis interactivo.',showCount:3,
cheat:['Identificar qu√© es CC y qu√© es CO en cada caso','Lo privado es conducta, no causa','El contexto define la funci√≥n','Misma topograf√≠a puede tener diferentes funciones'],
theory:[
{icon:'üèÜ',title:'Integrando todo',color:'accent',body:'<p>En cada caso cl√≠nico debes ser capaz de:</p><div class="ex-box"><div class="ex-box-l">Lista de verificaci√≥n</div><p>1Ô∏è‚É£ Identificar qu√© conductas son <b>respondientes</b> (CC) y cu√°les <b>operantes</b> (CO)<br><br>2Ô∏è‚É£ Distinguir componentes <b>p√∫blicos</b> y <b>privados</b><br><br>3Ô∏è‚É£ Reconocer que lo privado no es causa, sino conducta a explicar<br><br>4Ô∏è‚É£ Analizar el <b>contexto</b> donde ocurre cada conducta<br><br>5Ô∏è‚É£ Identificar <b>antecedentes</b> y <b>consecuencias</b> de las operantes<br><br>6Ô∏è‚É£ Evitar explicaciones circulares (etiqueta ‚Üí conducta ‚Üí etiqueta)</p></div>'}
],
exercises:[
{type:'seq',skill:'caso_clinico',patient:{name:'Roberto',age:'28 a√±os',gender:'m',initial:'R',badge:'Fobia social'},quote:'"Me pongo rojo, sudo, y me quedo en blanco cuando tengo que hablar en p√∫blico. Soy muy t√≠mido."',questions:[
{text:'"Soy muy t√≠mido." ¬øEs una explicaci√≥n funcional?',opts:['S√≠, describe su personalidad','No ‚Äî es una etiqueta que agrupa conductas sin explicarlas','Es parcialmente correcta','S√≠, si √©l lo siente as√≠'],c:1,fb:'"T√≠mido" es etiqueta. No dice qu√© hace exactamente, ante qu√©, con qu√© consecuencias.'},
{text:'"Me pongo rojo y sudo." ¬øQu√© tipo de conducta es?',opts:['Operante','Respondiente (RC) ‚Äî respuesta fisiol√≥gica condicionada','Voluntaria','No es conducta'],c:1,fb:'Rubor y sudoraci√≥n son respuestas fisiol√≥gicas elicitadas por el EC (situaci√≥n social) tras asociarse a experiencias aversivas previas (EI). Son RC.'},
{text:'"Me quedo en blanco." ¬øP√∫blico o privado?',opts:['P√∫blico, todos lo ven','Privado: es una experiencia interna que solo Roberto percibe','Es ambos','No es relevante'],c:1,fb:'"Quedarse en blanco" es conducta privada ‚Äî Roberto percibe la ausencia de verbalizaciones encubiertas. Externamente se observa el silencio (p√∫blico).'},
{text:'Roberto deja de asistir a reuniones de trabajo. ¬øQu√© tipo de conducta es NO asistir y qu√© la mantiene?',opts:['RC mantenida por CC','Operante mantenida por R- (reduce ansiedad anticipatoria)','Conducta innata','No es conducta, es ausencia'],c:1,fb:'Evitar es operante: reduce la ansiedad (R-). La ansiedad se adquiere por CC, la evitaci√≥n se mantiene por CO. Modelo bifactorial.'}]},
{type:'seq',skill:'caso_clinico',patient:{name:'Luc√≠a',age:'9 a√±os',gender:'f',initial:'L',badge:'Pesadillas'},quote:'Madre: "Tiene pesadillas todas las noches. Viene a nuestra cama y ya no quiere dormir sola."',questions:[
{text:'Las pesadillas (im√°genes aterradoras durante el sue√±o) son:',opts:['No son conducta','Conducta privada ‚Äî estimulaci√≥n visual encubierta','Solo s√≠ntomas neurol√≥gicos','Conducta p√∫blica'],c:1,fb:'Las pesadillas son visi√≥n privada (im√°genes encubiertas). Son conducta privada que sigue las mismas leyes.'},
{text:'"Viene a nuestra cama." ¬øRespondiente u operante?',opts:['Respondiente: provocada por el miedo','Operante: emitida y mantenida por consecuencias','Mixta: un poco de cada','No se puede clasificar'],c:1,fb:'Ir a la cama de los padres es operante: ¬øqu√© consecuencia obtiene? Atenci√≥n, consuelo, proximidad (R+) y reducci√≥n del miedo (R-).'},
{text:'¬øQu√© an√°lisis ser√≠a CIRCULAR?',opts:['"Viene porque obtiene atenci√≥n y el miedo baja"','"Viene porque tiene ansiedad por separaci√≥n"','"Viene cuando tiene pesadillas"','"Viene 5 noches/semana"'],c:1,fb:'"Ansiedad por separaci√≥n" es etiqueta diagn√≥stica. ¬øC√≥mo sabemos que la tiene? Porque viene. ¬øPor qu√© viene? Porque tiene ansiedad. Es circular.'},
{text:'Para intervenir, ¬øqu√© necesitamos identificar?',opts:['El diagn√≥stico correcto','Antecedentes (qu√© pasa antes), la conducta operacionalizada, y las consecuencias (qu√© obtiene)','El trauma original','El tipo de pesadilla'],c:1,fb:'El AF requiere: antecedentes + conducta operacionalizada + consecuencias. El diagn√≥stico no gu√≠a la intervenci√≥n; el AF s√≠.'}]},
{type:'seq',skill:'caso_clinico',patient:{name:'Miguel',age:'45 a√±os',gender:'m',initial:'M',badge:'"Soy ansioso"'},quote:'"Soy una persona ansiosa. Siempre he sido as√≠. Es mi personalidad."',questions:[
{text:'"Soy ansioso. Es mi personalidad." ¬øQu√© problema tiene esta afirmaci√≥n?',opts:['Ninguno, es autoconocimiento','Atribuye la conducta a un rasgo fijo interno, no a variables ambientales','Es parcialmente correcta','Es una buena descripci√≥n'],c:1,fb:'"Es mi personalidad" es explicaci√≥n internalista y est√°tica. La conducta no se debe a un rasgo fijo ‚Äî depende de la interacci√≥n con el ambiente.'},
{text:'Miguel suda y tiembla en reuniones de trabajo (no en casa con amigos). ¬øQu√© indica esto?',opts:['Que disimula la ansiedad con amigos','Que la conducta depende del CONTEXTO, no de un rasgo fijo','Que solo tiene ansiedad laboral','Que la ansiedad es selectiva'],c:1,fb:'Si la conducta var√≠a seg√∫n el contexto, no puede deberse a un "rasgo fijo de personalidad". Depende de las contingencias de cada situaci√≥n.'},
{text:'Miguel piensa "van a notar que estoy nervioso" (privado) ‚Üí suda m√°s (privado) ‚Üí se calla (p√∫blico) ‚Üí nadie le pregunta (consecuencia). ¬øC√≥mo interact√∫an estos componentes?',opts:['El pensamiento causa todo','Es una cadena: la verbalizaci√≥n encubierta funciona como Ed para respuestas fisiol√≥gicas y operantes','Las emociones causan el pensamiento','No est√°n relacionados'],c:1,fb:'El pensamiento funciona como est√≠mulo (no como causa) que participa en una cadena conductual. Cada eslab√≥n puede analizarse funcionalmente.'},
{text:'"Es ansioso porque tiene un trastorno de ansiedad generalizada." ¬øEs explicaci√≥n funcional?',opts:['S√≠, es un diagn√≥stico v√°lido','No ‚Äî es circular. El TAG se diagnostica por las conductas que pretende explicar','Es parcialmente funcional','S√≠, si lo confirma un psiquiatra'],c:1,fb:'Circular: ¬øc√≥mo sabemos que tiene TAG? Porque es ansioso. ¬øPor qu√© es ansioso? Porque tiene TAG. El AF busca variables ambientales concretas.'}]}
]}
]};

// ===== ENGINE (identical to M1) =====
$a=document.getElementById('app');
MOD=MODULE;S.mod='m2';loadP();
function go(v,o){Object.assign(S,o||{},{view:v});if(v==='exercise'){S.answers={};S.seqIdx=0;const l=MOD.levels[S.level];S.pool=shuffle([...Array(l.exercises.length).keys()]).slice(0,l.showCount||l.exercises.length);S.exIdx=0}S.tpOpen=false;saveP();render()}
function render(){const v=S.view;if(v==='home')rHome();else if(v==='theory')rTheory();else if(v==='exercise')rEx();else if(v==='gate')rGate();else if(v==='level-sum')rLSum();else if(v==='mod-sum')rMSum();requestAnimationFrame(()=>{const c=$a.querySelector('.cnt');if(c)c.scrollTop=0})}
function topH(t,s,back,prog){let p='';if(prog!==undefined)p=`<div class="top-prog"><div class="top-prog-bar"><div class="top-prog-fill" style="width:${prog}%"></div></div><div class="top-prog-pct">${Math.round(prog)}%</div></div>`;const tb=S.view==='exercise'?`<div class="top-btn" onclick="togTP()" title="Teor√≠a">${IC.book}</div>`:'';return `<div class="top"><div class="top-back" onclick="${back}" tabindex="0">${IC.back}</div><div style="flex:1;min-width:0"><div class="top-t">${t}</div><div class="top-s">${s}</div></div>${p}<div class="top-acts">${tb}<div class="top-btn" onclick="togDk()">${isDk()?IC.sun:IC.moon}</div></div></div>`}
function tpHTML(){if(!MOD||!MOD.levels[S.level])return '';const l=MOD.levels[S.level];let items='';(l.theory||[]).forEach(t=>{items+=`<div class="acc open"><div class="acc-h" onclick="this.parentElement.classList.toggle('open')"><div class="acc-i" style="background:var(--accent-g)">${t.icon||'üìñ'}</div><div class="acc-l">${t.title}</div><div class="acc-a">‚ñº</div></div><div class="acc-b"><div class="acc-in prose">${t.body}</div></div></div>`});return `<div class="tp-overlay${S.tpOpen?' open':''}" onclick="togTP()"></div><div class="tp${S.tpOpen?' open':''}"><button class="tp-close" onclick="togTP()">${IC.x}</button><div class="tag tag-b" style="margin-bottom:12px">üìñ Referencia te√≥rica</div>${items}</div>`}
function togTP(){S.tpOpen=!S.tpOpen;const p=$a.querySelector('.tp'),o=$a.querySelector('.tp-overlay');if(p)p.classList.toggle('open',S.tpOpen);if(o)o.classList.toggle('open',S.tpOpen)}
function rHome(){const m=MOD;let levels='';m.levels.forEach((l,i)=>{const done=isLD(i),unl=i===0||isLD(i-1),cls=done?'done':(!unl?'locked':'');const sc=P.scores[`l${i}`];let mbar='';if(sc){const p=Math.round((sc.correct/sc.total)*100);mbar=`<div class="lbar"><div class="lbar-f" style="width:${p}%;background:${p>=80?'var(--green)':(p>=50?'var(--gold)':'var(--red)')}"></div></div>`}levels+=`<div class="lcard ${cls}" onclick="${unl?`go('theory',{level:${i}})`:'void(0)'}"><div class="lcard-icon" style="background:${done?'var(--green-g)':`linear-gradient(135deg,${LVL_C[i]},${LVL_C[i]}22)`}">${done?'‚úÖ':LVL_E[i]}</div><div style="flex:1"><div class="lcard-name">${LVL_N[i]}</div><div class="lcard-sub">${l.title} ¬∑ ${l.exercises.length} ejercicios</div>${mbar}</div><div class="lcard-arrow">‚Ä∫</div></div>`});const tl=m.levels.length;let dl=0;for(let i=0;i<tl;i++)if(isLD(i))dl++;const pct=Math.round((dl/tl)*100);
$a.innerHTML=`${topH(m.phase,m.title,"window.location.href='../index.html'")}
<div class="cnt"><div class="anim" style="text-align:center;margin-bottom:16px"><div style="font-size:52px;margin-bottom:8px">${m.icon}</div><div class="card-t" style="font-size:26px">${m.title}</div><div class="card-d" style="max-width:360px;margin:6px auto 0">${m.description}</div></div><div style="display:flex;align-items:center;justify-content:center;gap:20px;margin-bottom:16px" class="anim d1"><div class="ring"><svg width="80" height="80"><circle cx="40" cy="40" r="33" fill="none" stroke="var(--border)" stroke-width="5"/><circle cx="40" cy="40" r="33" fill="none" stroke="var(--accent)" stroke-width="5" stroke-dasharray="${2*Math.PI*33}" stroke-dashoffset="${2*Math.PI*33*(1-pct/100)}" stroke-linecap="round"/></svg><div class="ring-v">${pct}%</div></div><div><div class="stat" style="border:none;padding:4px 0"><b style="font-family:'Space Mono',monospace;font-size:24px;color:var(--bright);display:block">${dl}/${tl}</b><span style="font-size:11px;color:var(--dim);text-transform:uppercase;letter-spacing:.5px">Niveles</span></div></div></div><div style="font-family:'Space Mono',monospace;font-size:11px;text-transform:uppercase;letter-spacing:1.5px;color:var(--muted);margin:16px 0 8px" class="anim d2">Niveles del m√≥dulo</div><div class="anim d3">${levels}</div></div>`}
function isLD(i){const sc=P.scores[`l${i}`];return sc&&(sc.correct/sc.total)>=MASTERY}
function rTheory(){const l=MOD.levels[S.level];let acc='';(l.theory||[]).forEach((t,i)=>{acc+=`<div class="acc ${i===0?'open':''}" onclick="this.classList.toggle('open')"><div class="acc-h"><div class="acc-i" style="background:var(--${t.color||'accent'}-g)">${t.icon||'üìñ'}</div><div class="acc-l">${t.title}</div><div class="acc-a">‚ñº</div></div><div class="acc-b"><div class="acc-in prose">${t.body}</div></div></div>`});$a.innerHTML=`${topH(`Nivel ${S.level+1}`,l.title,"go('home')")}<div class="cnt"><div class="anim"><div class="card"><div class="tag tag-b">üìñ Nivel ${S.level+1} ‚Äî ${LVL_N[S.level]}</div><div class="card-t">${l.title}</div><div class="card-d">${l.description||''}</div></div>${acc}</div></div><div class="bot"><button class="btn btn-p" onclick="go('exercise')">Comenzar ejercicios ‚Ä∫</button></div>`}
function rEx(){const l=MOD.levels[S.level],pi=S.pool[S.exIdx],ex=l.exercises[pi],total=S.pool.length;let ft=0,fc=0;S.pool.forEach((p,i)=>{const e=l.exercises[p];const c=e.type==='seq'?e.questions.length:(e.type==='classify'?e.items.length:1);if(i<S.exIdx)fc+=c;else if(i===S.exIdx)fc+=S.seqIdx;ft+=c});let pips='<div class="pips">';let pi2=0;S.pool.forEach((p,i)=>{const e=l.exercises[p];const c=e.type==='seq'?e.questions.length:(e.type==='classify'?e.items.length:1);for(let s=0;s<c;s++){const k=`${i}-${s}`,a=S.answers[k];let cl=i===S.exIdx&&s===S.seqIdx?'cur':(a===true?'ok':(a===false?'fail':''));pips+=`<div class="pip ${cl}"></div>`;pi2++}});pips+='</div>';const prog=ft?Math.round(fc/ft*100):0;let body='';if(ex.type==='tf')body=mkTF(ex);else if(ex.type==='single')body=mkSingle(ex);else if(ex.type==='multi')body=mkMulti(ex);else if(ex.type==='classify')body=mkCl(ex);else if(ex.type==='seq')body=mkSeq(ex);else if(ex.type==='match')body=mkMat(ex);$a.innerHTML=`${topH(`Nivel ${S.level+1}`,l.title,"go('home')",prog)}<div class="cnt">${pips}<div id="exW" class="anim">${body}</div></div><div class="bot" id="botB"></div>${tpHTML()}`}
function curK(){return `${S.exIdx}-${S.seqIdx}`}function curE(){return MOD.levels[S.level].exercises[S.pool[S.exIdx]]}
function rec(ok,ex){S.answers[curK()]=ok;if(ex&&ex.skill){if(!P.skills[ex.skill])P.skills[ex.skill]={c:0,t:0};P.skills[ex.skill].t++;if(ok)P.skills[ex.skill].c++}if(!ok&&ex){if(!P.errors[S.level])P.errors[S.level]=[];const q=ex.text||ex.s||(ex.questions?ex.questions[S.seqIdx]?.text:'')||'';const c=typeof ex.c==='number'&&ex.opts?ex.opts[ex.c]:'';P.errors[S.level].push({q:q.substring(0,100),a:(typeof c==='string'?c:'').substring(0,100)})}saveP()}
function showNext(){const b=$('botB');if(b)b.innerHTML=`<button class="btn btn-p" onclick="nextEx()">Siguiente ‚Ä∫</button>`}
function showFB(ok,t,h){const f=$('fb');if(!f)return;f.className=`fb show ${ok?'fbok':'fbfail'}`;let hh='';if(!ok&&h)hh=`<div style="margin-top:6px;padding:6px 10px;background:var(--purple-g);border-radius:4px;font-size:13px;color:var(--purple)">üí° ${h}</div>`;f.innerHTML=`<strong>${ok?'‚úÖ ¬°Correcto!':'‚ùå Incorrecto'}</strong>${t}${hh}`;if(!ok){const w=$('exW');if(w){w.classList.add('shake');setTimeout(()=>w.classList.remove('shake'),400)}}}
function mkTF(ex){return `<div class="card"><div class="q-h"><span class="q-type">‚ö°</span><span class="q-tag">V / F</span><span class="q-n">${S.exIdx+1}/${S.pool.length}</span></div><div class="q-text">${ex.s}</div><div class="tf"><div class="tf-b" id="tfV" onclick="chkTF(true)">‚úì Verdadero</div><div class="tf-b" id="tfF" onclick="chkTF(false)">‚úó Falso</div></div><div class="fb" id="fb"></div></div>`}
function chkTF(v){const ex=curE(),ok=v===ex.c;$('tf'+(v?'V':'F')).classList.add(ok?'ok':'bad','dis');$('tf'+(v?'F':'V')).classList.add('dis');if(!ok)$(ex.c?'tfV':'tfF').classList.add('ok');showFB(ok,ok?ex.ok:ex.fail);rec(ok,ex);showNext()}
function mkSingle(ex){let o='';ex.opts.forEach((t,i)=>{o+=`<div class="opt" id="so${i}" onclick="chkS(${i})"><div class="opt-m">${String.fromCharCode(65+i)}</div><div class="opt-t">${t}</div></div>`});return `<div class="card"><div class="q-h"><span class="q-type">üéØ</span><span class="q-tag">Selecci√≥n</span><span class="q-n">${S.exIdx+1}/${S.pool.length}</span></div>${ex.context?`<div class="q-ctx">${ex.context}</div>`:''}<div class="q-text">${ex.text}</div>${o}<div class="fb" id="fb"></div></div>`}
function chkS(i){const ex=curE(),ok=i===ex.c;document.querySelectorAll('.opt').forEach((o,j)=>{o.classList.add('dis');if(j===i)o.classList.add(ok?'ok':'bad');if(j===ex.c&&!ok)o.classList.add('rev')});showFB(ok,ok?ex.ok:ex.fail);rec(ok,ex);showNext()}
let _ms=[];function mkMulti(ex){_ms=[];let o='';ex.opts.forEach((t,i)=>{o+=`<div class="opt" id="mo${i}" onclick="togM(${i})"><div class="opt-m chk">‚òê</div><div class="opt-t">${t}</div></div>`});return `<div class="card"><div class="q-h"><span class="q-type">‚òëÔ∏è</span><span class="q-tag">Multi-selecci√≥n</span><span class="q-n">${S.exIdx+1}/${S.pool.length}</span></div><div class="q-text">${ex.text}</div><div style="font-size:13px;color:var(--dim);margin-bottom:8px">Selecciona <b>todas</b> las opciones correctas y pulsa Comprobar.</div>${o}<div class="fb" id="fb"></div></div><div style="text-align:center;margin-top:6px"><button class="btn btn-p btn-sm" onclick="chkM()">Comprobar</button></div>`}
function togM(i){const e=$('mo'+i);if(!e||e.classList.contains('dis'))return;const x=_ms.indexOf(i);if(x===-1){_ms.push(i);e.classList.add('pick');e.querySelector('.opt-m').textContent='‚òë'}else{_ms.splice(x,1);e.classList.remove('pick');e.querySelector('.opt-m').textContent='‚òê'}}
function chkM(){const ex=curE(),ok=JSON.stringify(_ms.sort())===JSON.stringify([...ex.c].sort());document.querySelectorAll('.opt').forEach((o,i)=>{o.classList.add('dis');if(ex.c.includes(i))o.classList.add('ok');else if(_ms.includes(i))o.classList.add('bad')});showFB(ok,ok?ex.ok:ex.fail);rec(ok,ex);_ms=[];showNext()}
function mkCl(ex){const it=ex.items[S.seqIdx];let c='<div class="cl-cats">';ex.categories.forEach(cat=>{c+=`<div class="cl-c" onclick="chkCl('${cat}')">${cat}</div>`});c+='</div>';return `<div class="card"><div class="q-h"><span class="q-type">üìÇ</span><span class="q-tag">Clasifica</span><span class="q-n">${S.seqIdx+1}/${ex.items.length}</span></div><div class="q-text">"${it.text}"</div>${c}<div class="fb" id="fb"></div></div>`}
function chkCl(cat){const ex=curE(),it=ex.items[S.seqIdx],ok=cat===it.cat;document.querySelectorAll('.cl-c').forEach(c=>{c.classList.add('dis');if(c.textContent===it.cat)c.classList.add('ok');else if(c.textContent===cat&&!ok)c.classList.add('bad')});showFB(ok,ok?`"${it.text}" ‚Üí ${it.cat}.`:`Correcto: "${it.text}" ‚Üí ${it.cat}`);S.answers[curK()]=ok;if(!ok){if(!P.errors[S.level])P.errors[S.level]=[];P.errors[S.level].push({q:it.text.substring(0,80),a:it.cat})}saveP();setTimeout(()=>{if(S.seqIdx<ex.items.length-1){S.seqIdx++;render()}else{S.seqIdx=0;advEx()}},1500)}
function mkSeq(ex){const q=ex.questions[S.seqIdx];let o='';q.opts.forEach((t,i)=>{o+=`<div class="opt" id="sq${i}" onclick="chkSq(${i})"><div class="opt-m">${String.fromCharCode(65+i)}</div><div class="opt-t">${t}</div></div>`});let ph='';if(ex.patient){const p=ex.patient;ph=`<div class="pat"><div class="pat-h"><div class="pat-av ${p.gender}">${p.initial}</div><div><div class="pat-name">${p.name}</div><div class="pat-age">${p.age}</div></div><div class="pat-badge">${p.badge}</div></div><div class="pat-q">${ex.quote}</div></div>`}return `${ph}<div class="card"><div class="q-h"><span class="q-type">üè•</span><span class="q-tag">Caso cl√≠nico</span><span class="q-n">${S.seqIdx+1}/${ex.questions.length}</span></div><div class="q-text">${q.text}</div>${o}<div class="fb" id="fb"></div></div>`}
function chkSq(i){const ex=curE(),q=ex.questions[S.seqIdx],ok=i===q.c;document.querySelectorAll('.opt').forEach((o,j)=>{o.classList.add('dis');if(j===i)o.classList.add(ok?'ok':'bad');if(j===q.c&&!ok)o.classList.add('rev')});showFB(ok,q.fb);S.answers[curK()]=ok;if(!ok){if(!P.errors[S.level])P.errors[S.level]=[];P.errors[S.level].push({q:q.text.substring(0,80),a:q.opts[q.c].substring(0,80)})}saveP();const b=$('botB');if(b){const last=S.seqIdx>=ex.questions.length-1;b.innerHTML=`<button class="btn btn-p" onclick="seqN(${last})">${last?'Siguiente ‚Ä∫':'Siguiente pregunta ‚Ä∫'}</button>`}}
function seqN(last){if(last){S.seqIdx=0;advEx()}else{S.seqIdx++;render()}}
let _mL=null,_mP={},_mC=0;function mkMat(ex){_mL=null;_mP={};_mC=0;const ls=shuffle(ex.pairs.map((p,i)=>({...p,idx:i}))),rs=shuffle(ex.pairs.map((p,i)=>({...p,idx:i})));let l='<div class="mat-c">';ls.forEach(p=>{l+=`<div class="mat-i" id="ml${p.idx}" onclick="matL(${p.idx})">${p.left}</div>`});l+='</div>';let r='<div class="mat-c">';rs.forEach(p=>{r+=`<div class="mat-i" id="mr${p.idx}" onclick="matR(${p.idx})">${p.right}</div>`});r+='</div>';return `<div class="card"><div class="q-h"><span class="q-type">üîó</span><span class="q-tag">Empareja</span><span class="q-n">${S.exIdx+1}/${S.pool.length}</span></div><div class="q-text">${ex.text}</div><div class="mat-w">${l}${r}</div><div class="fb" id="fb"></div></div>`}
function matL(i){document.querySelectorAll('.mat-c:first-child .mat-i').forEach(m=>m.classList.remove('sel'));$('ml'+i).classList.add('sel');_mL=i}
function matR(i){if(_mL===null)return;const ok=_mL===i,ml=$('ml'+_mL),mr=$('mr'+i);if(ml)ml.classList.add(ok?'ok':'bad','dis');if(mr)mr.classList.add(ok?'ok':'bad','dis');if(!ok){setTimeout(()=>{if(ml){ml.classList.remove('bad','dis')}if(mr){mr.classList.remove('bad','dis')}},800)}else{_mC++;const ex=curE();if(_mC===ex.pairs.length){showFB(true,ex.ok||'Todos correctos.');rec(true,ex);showNext()}}_mL=null;document.querySelectorAll('.mat-i').forEach(m=>m.classList.remove('sel'))}
function advEx(){if(S.exIdx<S.pool.length-1){S.exIdx++;S.seqIdx=0;render()}else{let c=0,t=0;for(const[k,v]of Object.entries(S.answers)){if(typeof v==='boolean'){t++;if(v)c++}}P.scores[`l${S.level}`]={correct:c,total:t};saveP();const p=t?c/t:0;if(p>=MASTERY){fireConfetti();go('level-sum')}else{go('gate')}}}
function nextEx(){const ex=curE();if(ex.type==='classify'||ex.type==='seq')return;advEx()}
function rGate(){const sc=P.scores[`l${S.level}`],pct=sc?Math.round((sc.correct/sc.total)*100):0,need=Math.ceil(sc.total*MASTERY);let errs='';const el=P.errors[S.level]||[];const seen=new Set;el.forEach(e=>{if(!seen.has(e.q)&&seen.size<5){seen.add(e.q);errs+=`<div class="rev"><div class="rev-q">${e.q}</div><div class="rev-a">‚úì ${e.a}</div></div>`}});$a.innerHTML=`${topH(`Nivel ${S.level+1}`,MOD.levels[S.level].title,"go('home')")}<div class="cnt"><div class="gate anim"><div class="gate-ic">üîí</div><div class="gate-t">Criterio no alcanzado</div><div class="gate-d">Necesitas <strong>‚â•80%</strong> (${need}/${sc.total}) para avanzar. Obtuviste ${sc.correct}/${sc.total}.</div><div class="gate-bar"><div class="gate-bar-f" style="width:${pct}%;background:${pct>=80?'var(--green)':(pct>=50?'var(--gold)':'var(--red)')}"></div></div><div class="gate-sc" style="color:${pct>=50?'var(--gold)':'var(--red)'}">${pct}%</div>${errs?'<div style="font-family:\'Space Mono\',monospace;font-size:11px;text-transform:uppercase;letter-spacing:1px;color:var(--muted);margin:12px 0 6px">Revisar</div>'+errs:''}</div></div><div class="bot"><button class="btn btn-o" onclick="go('home')">‚Üê M√≥dulo</button><button class="btn btn-w" onclick="retryLvl()">üîÑ Reintentar</button></div>`}
function retryLvl(){delete P.scores[`l${S.level}`];P.errors[S.level]=[];saveP();go('exercise')}
function rLSum(){const sc=P.scores[`l${S.level}`],pct=sc?Math.round((sc.correct/sc.total)*100):0,cls=pct>=80?'great':(pct>=50?'mid':'low');const l=MOD.levels[S.level],hasN=S.level<MOD.levels.length-1;let sk=renderSk(),er=renderEr(),ch='';if(l.cheat){ch=`<div class="cheat"><div class="cheat-t">üìã Conceptos clave</div>`;l.cheat.forEach(c=>{ch+=`<div class="cheat-i">‚Ä¢ ${c}</div>`});ch+='</div>'}$a.innerHTML=`${topH(`Nivel ${S.level+1}`,'Resultados',"go('home')")}<div class="cnt" style="text-align:center"><div class="anim"><div class="sum-c ${cls}"><div class="sum-n">${sc.correct}</div><div class="sum-t">de ${sc.total}</div></div><div class="sum-msg">${pct>=90?'üåü ¬°Excelente!':(pct>=80?'‚úÖ ¬°Nivel superado!':'üí™ Buen progreso')}</div><div class="sum-sub">${LVL_N[S.level]}: ${l.title} ‚Äî ${pct}%</div></div><div style="text-align:left" class="anim d1">${sk}</div><div style="text-align:left" class="anim d2">${er}</div><div style="text-align:left" class="anim d3">${ch}</div></div><div class="bot"><button class="btn btn-icon btn-o" onclick="retryLvl()">${IC.refresh}</button>${hasN?`<button class="btn btn-p" onclick="go('theory',{level:${S.level+1}})">Nivel ${S.level+2} ‚Ä∫</button>`:`<button class="btn btn-g" onclick="go('mod-sum')">Resumen ‚Ä∫</button>`}</div>`}
function rMSum(){let tc=0,tt=0,rows='';MOD.levels.forEach((l,i)=>{const sc=P.scores[`l${i}`];if(sc){tc+=sc.correct;tt+=sc.total;const p=Math.round((sc.correct/sc.total)*100);rows+=`<div style="display:flex;align-items:center;gap:8px;padding:8px 0;border-bottom:1px solid var(--border2)"><span style="font-size:16px">${p>=80?'‚úÖ':(p>=50?'üü°':'üî¥')}</span><span style="flex:1;font-size:14px">${LVL_N[i]}: ${l.title}</span><span style="font-family:'Space Mono',monospace;font-size:13px;font-weight:700;color:${p>=80?'var(--green)':(p>=50?'var(--gold)':'var(--red)')}">${p}%</span></div>`}});const pct=tt?Math.round((tc/tt)*100):0;$a.innerHTML=`${topH(MOD.phase,MOD.title,"go('home')")}<div class="cnt" style="text-align:center"><div class="anim"><div style="font-size:48px;margin-bottom:6px">${pct>=80?'üéâ':'üí™'}</div><div class="sum-c ${pct>=80?'great':(pct>=50?'mid':'low')}"><div class="sum-n">${tc}</div><div class="sum-t">de ${tt}</div></div><div class="sum-msg">${pct>=80?'¬°M√≥dulo completado!':'Sigue practicando'}</div><div class="sum-sub">${MOD.title} ‚Äî ${pct}%</div></div><div class="card anim d1" style="text-align:left">${rows}</div><div style="text-align:left" class="anim d2">${renderSk()}</div></div><div class="bot"><button class="btn btn-o" onclick="window.location.href='../index.html'">‚Üê Plataforma</button></div>`}
function renderSk(){const sk=P.skills,ks=Object.keys(sk);if(!ks.length)return '';let h='<div style="font-family:\'Space Mono\',monospace;font-size:11px;text-transform:uppercase;letter-spacing:1px;color:var(--muted);margin:12px 0 6px">üìä Habilidades</div><div class="sk-grid">';ks.forEach(k=>{const s=sk[k],p=s.t?Math.round((s.c/s.t)*100):0,c=p>=80?'var(--green)':(p>=50?'var(--gold)':'var(--red)');h+=`<div class="sk-r"><span class="sk-name">${k.replace(/_/g,' ').replace(/\b\w/g,l=>l.toUpperCase())}</span><div class="sk-bar"><div class="sk-bar-f" style="width:${p}%;background:${c}"></div></div><span class="sk-pct" style="color:${c}">${p}%</span></div>`});return h+'</div>'}
function renderEr(){const e=P.errors[S.level];if(!e||!e.length)return '';let h='<div style="font-family:\'Space Mono\',monospace;font-size:11px;text-transform:uppercase;letter-spacing:1px;color:var(--muted);margin:12px 0 6px">‚ùå Revisar</div>';const seen=new Set;e.forEach(x=>{if(!seen.has(x.q)&&seen.size<6){seen.add(x.q);h+=`<div class="rev"><div class="rev-q">${x.q}</div><div class="rev-a">‚úì ${x.a}</div></div>`}});return h}
render();
</script>
</body>
</html>
