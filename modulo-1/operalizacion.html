<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>M√≥dulo 1: Operacionalizaci√≥n de la Conducta</title>
<link href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,wght@0,300;0,400;0,500;0,600;0,700;1,400&family=Space+Mono:wght@400;700&family=Fraunces:ital,opsz,wght@0,9..144,300;0,9..144,600;0,9..144,700;1,9..144,400&display=swap" rel="stylesheet">
<style>
:root {
  --bg-deep: #e8f4f8;
  --bg-mid: #d4ecf2;
  --bg-card: #ffffff;
  --bg-card-hover: #f0f9fb;
  --gold: #d4950a;
  --gold-bright: #f0b429;
  --gold-dim: #a87608;
  --gold-glow: rgba(212, 149, 10, 0.1);
  --green: #16a34a;
  --green-bg: rgba(22, 163, 74, 0.1);
  --red: #dc2626;
  --red-bg: rgba(220, 38, 38, 0.08);
  --blue: #0e7490;
  --blue-bg: rgba(14, 116, 144, 0.08);
  --text: #2c4a56;
  --text-dim: #6b8a97;
  --text-bright: #1a3340;
  --border: rgba(14, 116, 144, 0.15);
  --border-gold: rgba(212, 149, 10, 0.25);
  --radius: 16px;
  --radius-sm: 10px;
  --shadow: 0 4px 24px rgba(14, 116, 144, 0.08);
  --shadow-card: 0 2px 12px rgba(0,0,0,0.06);
}

* { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

html, body {
  height: 100%;
  overflow: hidden;
  background: linear-gradient(160deg, #dff0f5 0%, #e8f4f8 30%, #edf6f0 60%, #e4f0f6 100%);
  color: var(--text);
  font-family: 'DM Sans', sans-serif;
  font-size: 17px;
  line-height: 1.65;
}

/* ===== WORKSHOP BANNER ===== */
.workshop-banner {
  background: linear-gradient(135deg, rgba(212,149,10,0.08), rgba(14,116,144,0.06));
  border: 1.5px solid rgba(212,149,10,0.2);
  border-radius: var(--radius);
  padding: 18px 20px;
  margin-bottom: 24px;
  display: flex;
  align-items: center;
  gap: 14px;
  cursor: pointer;
  transition: all 0.25s;
  box-shadow: 0 3px 16px rgba(212,149,10,0.08);
  text-decoration: none;
  position: relative;
  overflow: hidden;
}
.workshop-banner::after {
  content: '';
  position: absolute;
  top: -50%; right: -20%;
  width: 120px; height: 120px;
  background: radial-gradient(circle, rgba(212,149,10,0.1) 0%, transparent 70%);
  border-radius: 50%;
  pointer-events: none;
}
.workshop-banner:active { transform: scale(0.98); }
.workshop-icon {
  width: 52px; height: 52px;
  background: linear-gradient(135deg, var(--gold), var(--gold-bright));
  border-radius: 14px;
  display: flex; align-items: center; justify-content: center;
  font-size: 26px;
  flex-shrink: 0;
  box-shadow: 0 4px 14px rgba(212,149,10,0.2);
}
.workshop-info { flex: 1; z-index: 1; }
.workshop-tag {
  font-family: 'Space Mono', monospace;
  font-size: 10px;
  text-transform: uppercase;
  letter-spacing: 1.2px;
  color: var(--gold-dim);
  margin-bottom: 3px;
}
.workshop-name {
  font-family: 'Fraunces', serif;
  font-size: 16px;
  font-weight: 600;
  color: var(--text-bright);
  margin-bottom: 2px;
}
.workshop-desc {
  font-size: 13px;
  color: var(--text-dim);
  line-height: 1.4;
}
.workshop-arrow {
  font-size: 22px;
  color: var(--gold);
  z-index: 1;
}

/* ===== FLOATING GOLDEN PARTICLES ===== */
#particles-canvas {
  position: fixed;
  inset: 0;
  z-index: 0;
  pointer-events: none;
}

/* ===== SCREEN SYSTEM ===== */
.screen {
  position: fixed;
  inset: 0;
  display: flex;
  flex-direction: column;
  opacity: 0;
  pointer-events: none;
  transition: opacity 0.4s ease, transform 0.4s ease;
  transform: translateX(30px);
  z-index: 1;
  background: transparent;
}
.screen.active {
  opacity: 1;
  pointer-events: auto;
  transform: translateX(0);
  z-index: 10;
}
.screen.exit-left {
  opacity: 0;
  transform: translateX(-30px);
}

/* ===== TOP BAR ===== */
.topbar {
  display: flex;
  align-items: center;
  padding: 12px 16px;
  gap: 12px;
  background: rgba(255, 255, 255, 0.85);
  backdrop-filter: blur(16px);
  border-bottom: 1px solid rgba(14,116,144,0.1);
  flex-shrink: 0;
  z-index: 20;
}
.topbar-back {
  width: 36px; height: 36px;
  border-radius: 50%;
  background: var(--bg-deep);
  border: 1px solid var(--border);
  color: var(--blue);
  display: flex; align-items: center; justify-content: center;
  cursor: pointer;
  font-size: 18px;
  transition: all 0.2s;
}
.topbar-back:active { transform: scale(0.9); background: var(--bg-mid); }
.topbar-info { flex: 1; }
.topbar-title {
  font-family: 'Fraunces', serif;
  font-size: 16px;
  font-weight: 600;
  color: var(--blue);
  letter-spacing: 0.3px;
}
.topbar-subtitle { font-size: 12px; color: var(--text-dim); }
.topbar-progress-wrap {
  display: flex; align-items: center; gap: 6px;
}
.topbar-progress-bar {
  width: 60px; height: 6px;
  background: rgba(14,116,144,0.1);
  border-radius: 3px;
  overflow: hidden;
}
.topbar-progress-fill {
  height: 100%;
  background: linear-gradient(90deg, var(--gold), var(--gold-bright));
  border-radius: 3px;
  transition: width 0.5s ease;
}
.topbar-progress-text { font-size: 11px; color: var(--gold-dim); font-weight: 600; font-family: 'Space Mono', monospace; }

/* ===== SCROLLABLE CONTENT ===== */
.content {
  flex: 1;
  overflow-y: auto;
  overflow-x: hidden;
  padding: 20px 16px 100px;
  scroll-behavior: smooth;
  -webkit-overflow-scrolling: touch;
}

/* ===== HOME SCREEN ===== */
.home-hero {
  text-align: center;
  padding: 32px 0 24px;
}
.home-icon {
  width: 80px; height: 80px;
  background: linear-gradient(135deg, var(--gold), var(--gold-bright));
  border-radius: 24px;
  display: flex; align-items: center; justify-content: center;
  font-size: 40px;
  margin: 0 auto 20px;
  box-shadow: 0 8px 30px rgba(212,149,10,0.25);
  animation: float 3s ease-in-out infinite;
}
@keyframes float {
  0%, 100% { transform: translateY(0); }
  50% { transform: translateY(-8px); }
}
.home-title {
  font-family: 'Fraunces', serif;
  font-size: 28px;
  font-weight: 700;
  color: var(--text-bright);
  margin-bottom: 8px;
  line-height: 1.2;
}
.home-desc {
  font-size: 16px;
  color: var(--text-dim);
  max-width: 340px;
  margin: 0 auto 24px;
}
.home-stats {
  display: flex;
  justify-content: center;
  gap: 24px;
  margin-bottom: 8px;
}
.home-stat {
  text-align: center;
}
.home-stat-num {
  font-family: 'Space Mono', monospace;
  font-size: 24px;
  font-weight: 700;
  color: var(--blue);
}
.home-stat-label { font-size: 12px; color: var(--text-dim); text-transform: uppercase; letter-spacing: 0.5px; }

/* ===== LEVEL CARDS ===== */
.levels-section-title {
  font-family: 'Fraunces', serif;
  font-size: 14px;
  color: var(--gold-dim);
  text-transform: uppercase;
  letter-spacing: 1.5px;
  margin: 24px 0 16px;
}
.level-card {
  background: var(--bg-card);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  padding: 18px;
  margin-bottom: 12px;
  display: flex;
  align-items: center;
  gap: 14px;
  cursor: pointer;
  transition: all 0.25s;
  position: relative;
  overflow: hidden;
  box-shadow: var(--shadow-card);
}
.level-card::before {
  content: '';
  position: absolute;
  left: 0; top: 0; bottom: 0;
  width: 4px;
  background: var(--gold);
  border-radius: 0 4px 4px 0;
  opacity: 0;
  transition: opacity 0.25s;
}
.level-card:active { transform: scale(0.98); background: var(--bg-card-hover); }
.level-card:active::before { opacity: 1; }
.level-card.completed { border-color: rgba(22,163,74,0.3); }
.level-card.completed::before { opacity: 1; background: var(--green); }
.level-card.locked { opacity: 0.45; pointer-events: none; }

.level-num {
  width: 44px; height: 44px;
  border-radius: 14px;
  display: flex; align-items: center; justify-content: center;
  font-family: 'Space Mono', monospace;
  font-weight: 700;
  font-size: 18px;
  flex-shrink: 0;
  background: rgba(14,116,144,0.08);
  color: var(--blue);
  border: 1px solid rgba(14,116,144,0.15);
}
.level-card.completed .level-num { background: var(--green-bg); color: var(--green); border-color: rgba(22,163,74,0.2); }
.level-card.locked .level-num { background: rgba(0,0,0,0.03); color: var(--text-dim); border-color: rgba(0,0,0,0.06); }

.level-info { flex: 1; }
.level-name { font-weight: 600; font-size: 16px; color: var(--text-bright); margin-bottom: 3px; }
.level-desc { font-size: 13.5px; color: var(--text-dim); line-height: 1.4; }
.level-arrow { color: var(--text-dim); font-size: 20px; }
.level-card.completed .level-arrow { color: var(--green); }
.level-check { color: var(--green); font-size: 20px; }

/* ===== THEORY SECTIONS ===== */
.theory-block {
  background: var(--bg-card);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  padding: 20px;
  margin-bottom: 20px;
  box-shadow: var(--shadow-card);
}
.theory-label {
  font-family: 'Space Mono', monospace;
  font-size: 11px;
  text-transform: uppercase;
  letter-spacing: 1.5px;
  color: var(--gold-dim);
  margin-bottom: 12px;
  display: flex;
  align-items: center;
  gap: 6px;
}
.theory-heading {
  font-family: 'Fraunces', serif;
  font-size: 22px;
  font-weight: 700;
  color: var(--text-bright);
  margin-bottom: 12px;
  line-height: 1.3;
}
.theory-text {
  font-size: 15.5px;
  color: var(--text);
  margin-bottom: 12px;
  line-height: 1.75;
}
.theory-text:last-child { margin-bottom: 0; }

.theory-highlight {
  background: rgba(212,149,10,0.07);
  border-left: 3px solid var(--gold);
  padding: 14px 16px;
  border-radius: 0 var(--radius-sm) var(--radius-sm) 0;
  margin: 16px 0;
  font-size: 15.5px;
  color: var(--text-bright);
  line-height: 1.65;
}
.theory-highlight em {
  color: var(--gold-dim);
  font-style: normal;
  font-weight: 600;
}
.theory-source {
  font-size: 12px;
  color: var(--text-dim);
  font-style: italic;
  margin-top: 8px;
}
.theory-example {
  background: rgba(14,116,144,0.05);
  border: 1px solid rgba(14,116,144,0.12);
  border-radius: var(--radius-sm);
  padding: 14px 16px;
  margin: 14px 0;
}
.theory-example-label {
  font-size: 12px;
  font-weight: 700;
  color: var(--blue);
  text-transform: uppercase;
  letter-spacing: 0.8px;
  margin-bottom: 6px;
}
.theory-example p { font-size: 14.5px; color: var(--text); margin: 0; }

/* ===== EXERCISE SECTIONS ===== */
.exercise-section {
  margin-top: 28px;
}
.exercise-section-title {
  font-family: 'Space Mono', monospace;
  font-size: 12px;
  text-transform: uppercase;
  letter-spacing: 1.5px;
  color: var(--green);
  margin-bottom: 16px;
  display: flex; align-items: center; gap: 6px;
}
.question-card {
  background: var(--bg-card);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  padding: 20px;
  margin-bottom: 16px;
  box-shadow: var(--shadow-card);
}
.question-number {
  font-family: 'Space Mono', monospace;
  font-size: 11px;
  color: var(--gold-dim);
  text-transform: uppercase;
  letter-spacing: 1px;
  margin-bottom: 8px;
}
.question-text {
  font-size: 17px;
  font-weight: 500;
  color: var(--text-bright);
  margin-bottom: 16px;
  line-height: 1.55;
}
.question-context {
  font-size: 14.5px;
  color: var(--text-dim);
  font-style: italic;
  margin-bottom: 14px;
  padding: 10px 14px;
  background: rgba(14,116,144,0.04);
  border-radius: var(--radius-sm);
  border-left: 2px solid rgba(14,116,144,0.15);
}

/* ===== OPTIONS ===== */
.option {
  display: flex;
  align-items: flex-start;
  gap: 12px;
  padding: 14px 16px;
  border: 1.5px solid rgba(14,116,144,0.12);
  border-radius: var(--radius-sm);
  margin-bottom: 8px;
  cursor: pointer;
  transition: all 0.2s;
  -webkit-user-select: none;
  user-select: none;
  background: rgba(14,116,144,0.02);
}
.option:active { transform: scale(0.98); }
.option.selected { border-color: var(--gold); background: rgba(212,149,10,0.06); }
.option.correct { border-color: var(--green); background: var(--green-bg); }
.option.incorrect { border-color: var(--red); background: var(--red-bg); }
.option.disabled { pointer-events: none; }
.option.dimmed { opacity: 0.4; }

.option-marker {
  width: 24px; height: 24px;
  border-radius: 50%;
  border: 2px solid rgba(14,116,144,0.2);
  display: flex; align-items: center; justify-content: center;
  font-size: 12px; font-weight: 700;
  flex-shrink: 0;
  margin-top: 1px;
  transition: all 0.2s;
  color: var(--text-dim);
}
.option.selected .option-marker { border-color: var(--gold); color: var(--gold-dim); background: rgba(212,149,10,0.1); }
.option.correct .option-marker { border-color: var(--green); color: #fff; background: var(--green); }
.option.incorrect .option-marker { border-color: var(--red); color: #fff; background: var(--red); }

.option-text {
  font-size: 15.5px;
  color: var(--text);
  line-height: 1.55;
}
.option.correct .option-text { color: var(--text-bright); }
.option.incorrect .option-text { color: var(--text-dim); }

/* ===== FEEDBACK ===== */
.feedback {
  padding: 14px 16px;
  border-radius: var(--radius-sm);
  margin-top: 12px;
  font-size: 14.5px;
  line-height: 1.65;
  display: none;
  animation: feedbackIn 0.3s ease;
}
@keyframes feedbackIn {
  from { opacity: 0; transform: translateY(8px); }
  to { opacity: 1; transform: translateY(0); }
}
.feedback.show { display: block; }
.feedback.correct {
  background: rgba(22,163,74,0.08);
  border: 1px solid rgba(22,163,74,0.2);
  color: #166534;
}
.feedback.incorrect {
  background: rgba(220,38,38,0.06);
  border: 1px solid rgba(220,38,38,0.15);
  color: #991b1b;
}
.feedback strong { color: var(--text-bright); }

/* ===== MULTI-SELECT (for classify exercises) ===== */
.classify-target {
  background: var(--bg-card);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  padding: 16px;
  margin-bottom: 12px;
}
.classify-label {
  font-size: 14px;
  font-weight: 600;
  margin-bottom: 10px;
  padding: 5px 12px;
  border-radius: 6px;
  display: inline-block;
}
.classify-label.motor { background: rgba(14,116,144,0.1); color: #0e7490; }
.classify-label.cognitivo { background: rgba(126,58,183,0.1); color: #7e3ab7; }
.classify-label.fisiologico { background: rgba(190,50,120,0.1); color: #be3278; }

.drag-item {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  padding: 9px 15px;
  background: rgba(14,116,144,0.05);
  border: 1px solid rgba(14,116,144,0.12);
  border-radius: 20px;
  font-size: 14px;
  color: var(--text);
  margin: 4px;
  cursor: pointer;
  transition: all 0.2s;
  -webkit-user-select: none;
  user-select: none;
}
.drag-item:active { transform: scale(0.95); }
.drag-item.placed { opacity: 0.3; pointer-events: none; }
.drag-item.correct-item { background: var(--green-bg); border-color: rgba(22,163,74,0.25); color: #166534; }
.drag-item.incorrect-item { background: var(--red-bg); border-color: rgba(220,38,38,0.25); color: #991b1b; }

/* ===== BOTTOM ACTION BAR ===== */
.bottom-bar {
  position: fixed;
  bottom: 0; left: 0; right: 0;
  padding: 12px 16px;
  padding-bottom: max(12px, env(safe-area-inset-bottom));
  background: rgba(255, 255, 255, 0.9);
  backdrop-filter: blur(16px);
  border-top: 1px solid rgba(14,116,144,0.1);
  z-index: 20;
  display: flex;
  gap: 10px;
}
.btn {
  flex: 1;
  padding: 15px 20px;
  border-radius: var(--radius-sm);
  font-family: 'DM Sans', sans-serif;
  font-size: 16px;
  font-weight: 600;
  border: none;
  cursor: pointer;
  transition: all 0.2s;
  text-align: center;
}
.btn:active { transform: scale(0.97); }
.btn-primary {
  background: linear-gradient(135deg, var(--gold), var(--gold-bright));
  color: #ffffff;
  box-shadow: 0 4px 16px rgba(212,149,10,0.25);
}
.btn-primary:disabled { opacity: 0.4; pointer-events: none; }
.btn-secondary {
  background: var(--bg-card);
  color: var(--text);
  border: 1px solid var(--border);
}
.btn-success {
  background: linear-gradient(135deg, var(--green), #22c55e);
  color: #ffffff;
  box-shadow: 0 4px 16px rgba(22,163,74,0.25);
}

/* ===== SUMMARY SCREEN ===== */
.summary-circle {
  width: 140px; height: 140px;
  border-radius: 50%;
  display: flex; flex-direction: column;
  align-items: center; justify-content: center;
  margin: 24px auto;
  position: relative;
}
.summary-circle::before {
  content: '';
  position: absolute;
  inset: 0;
  border-radius: 50%;
  border: 4px solid rgba(14,116,144,0.1);
}
.summary-circle::after {
  content: '';
  position: absolute;
  inset: 0;
  border-radius: 50%;
  border: 4px solid transparent;
  border-top-color: var(--gold);
  transform: rotate(-90deg);
}
.summary-score {
  font-family: 'Space Mono', monospace;
  font-size: 42px;
  font-weight: 700;
  color: var(--text-bright);
  line-height: 1;
}
.summary-total { font-size: 13px; color: var(--text-dim); }
.summary-message {
  text-align: center;
  font-family: 'Fraunces', serif;
  font-size: 24px;
  font-weight: 600;
  color: var(--text-bright);
  margin: 16px 0 8px;
}
.summary-sub { text-align: center; font-size: 15px; color: var(--text-dim); margin-bottom: 24px; }

.summary-breakdown {
  background: var(--bg-card);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  padding: 16px;
  margin-bottom: 16px;
  box-shadow: var(--shadow-card);
}
.summary-item {
  display: flex;
  align-items: center;
  gap: 10px;
  padding: 10px 0;
  border-bottom: 1px solid rgba(14,116,144,0.06);
}
.summary-item:last-child { border-bottom: none; }
.summary-item-icon { font-size: 20px; }
.summary-item-text { flex: 1; font-size: 14.5px; color: var(--text); }
.summary-item-result { font-family: 'Space Mono', monospace; font-size: 13px; font-weight: 700; }
.summary-item-result.ok { color: var(--green); }
.summary-item-result.fail { color: var(--red); }

/* ===== UTILITIES ===== */
.mt-sm { margin-top: 8px; }
.mt-md { margin-top: 16px; }
.mt-lg { margin-top: 24px; }
.text-center { text-align: center; }
.hidden { display: none !important; }

/* ===== ANIMATIONS ===== */
@keyframes slideUp {
  from { opacity: 0; transform: translateY(20px); }
  to { opacity: 1; transform: translateY(0); }
}
.animate-in { animation: slideUp 0.5s ease forwards; }
.delay-1 { animation-delay: 0.1s; opacity: 0; }
.delay-2 { animation-delay: 0.2s; opacity: 0; }
.delay-3 { animation-delay: 0.3s; opacity: 0; }
.delay-4 { animation-delay: 0.4s; opacity: 0; }

/* scrollbar */
.content::-webkit-scrollbar { width: 3px; }
.content::-webkit-scrollbar-track { background: transparent; }
.content::-webkit-scrollbar-thumb { background: rgba(14,116,144,0.15); border-radius: 3px; }

/* ===== CASE STUDY SPECIAL ===== */
.case-vignette {
  background: linear-gradient(135deg, rgba(212,149,10,0.06), rgba(14,116,144,0.05));
  border: 1px solid rgba(212,149,10,0.15);
  border-radius: var(--radius);
  padding: 20px;
  margin-bottom: 20px;
  position: relative;
  box-shadow: var(--shadow-card);
}
.case-vignette::before {
  content: 'üìã';
  position: absolute;
  top: -12px; left: 16px;
  font-size: 24px;
}
.case-vignette-title {
  font-family: 'Fraunces', serif;
  font-size: 18px;
  font-weight: 600;
  color: var(--gold-dim);
  margin-bottom: 10px;
  margin-top: 4px;
}
.case-vignette p { font-size: 14.5px; color: var(--text); line-height: 1.75; margin-bottom: 8px; }
.case-vignette p:last-child { margin-bottom: 0; }

.step-indicator {
  display: flex;
  align-items: center;
  gap: 4px;
  justify-content: center;
  margin-bottom: 20px;
}
.step-dot {
  width: 8px; height: 8px;
  border-radius: 50%;
  background: rgba(14,116,144,0.12);
  transition: all 0.3s;
}
.step-dot.active { background: var(--gold); width: 24px; border-radius: 4px; }
.step-dot.done { background: var(--green); }
</style>
</head>
<body>
<canvas id="particles-canvas"></canvas>

<!-- ==================== HOME SCREEN ==================== -->
<div class="screen active" id="screen-home">
  <div class="topbar">
    <div class="topbar-back" onclick="goToDashboard()">‚Üê</div>
    <div class="topbar-info">
      <div class="topbar-title">Fase 1 ¬∑ Fundamentos</div>
      <div class="topbar-subtitle">M√≥dulo 1 de 3</div>
    </div>
  </div>
  <div class="content">
    <div class="home-hero animate-in">
      <div class="home-icon">üìã</div>
      <div class="home-title">Operacionalizaci√≥n de la Conducta</div>
      <div class="home-desc">Aprende a definir conductas de forma medible, observable y funcional ‚Äî la base de todo an√°lisis funcional.</div>
      <div class="home-stats">
        <div class="home-stat">
          <div class="home-stat-num">6</div>
          <div class="home-stat-label">Niveles</div>
        </div>
        <div class="home-stat">
          <div class="home-stat-num">24</div>
          <div class="home-stat-label">Ejercicios</div>
        </div>
        <div class="home-stat">
          <div class="home-stat-num">~50</div>
          <div class="home-stat-label">Minutos</div>
        </div>
      </div>
    </div>

    <!-- WORKSHOP BANNER -->
    <a class="workshop-banner animate-in delay-1" href="talleropera.html">
      <div class="workshop-icon">üî¨</div>
      <div class="workshop-info">
        <div class="workshop-tag">‚≠ê Herramienta pr√°ctica</div>
        <div class="workshop-name">Taller de Operacionalizaci√≥n</div>
        <div class="workshop-desc">Practica convertir quejas vagas en formulaciones conductuales medibles paso a paso</div>
      </div>
      <div class="workshop-arrow">‚Ä∫</div>
    </a>

    <div class="levels-section-title animate-in delay-1">Niveles del m√≥dulo</div>

    <div class="level-card animate-in delay-1" onclick="startLevel(1)">
      <div class="level-num">1</div>
      <div class="level-info">
        <div class="level-name">¬øQu√© es Conducta?</div>
        <div class="level-desc">Reconoce qu√© es y qu√© no es conducta desde el an√°lisis del comportamiento</div>
      </div>
      <div class="level-arrow">‚Ä∫</div>
    </div>

    <div class="level-card animate-in delay-2 locked" id="lcard-2" onclick="startLevel(2)">
      <div class="level-num">2</div>
      <div class="level-info">
        <div class="level-name">Triple Sistema de Respuesta</div>
        <div class="level-desc">Clasifica conductas en componentes motor, cognitivo y fisiol√≥gico</div>
      </div>
      <div class="level-arrow">‚Ä∫</div>
    </div>

    <div class="level-card animate-in delay-2 locked" id="lcard-3" onclick="startLevel(3)">
      <div class="level-num">3</div>
      <div class="level-info">
        <div class="level-name">Par√°metros de la Conducta</div>
        <div class="level-desc">Identifica frecuencia, intensidad, duraci√≥n y ocurrencia</div>
      </div>
      <div class="level-arrow">‚Ä∫</div>
    </div>

    <div class="level-card animate-in delay-3 locked" id="lcard-4" onclick="startLevel(4)">
      <div class="level-num">4</div>
      <div class="level-info">
        <div class="level-name">De la Etiqueta a la Operacionalizaci√≥n</div>
        <div class="level-desc">Transforma descripciones vagas en definiciones medibles y observables</div>
      </div>
      <div class="level-arrow">‚Ä∫</div>
    </div>

    <div class="level-card animate-in delay-3 locked" id="lcard-5" onclick="startLevel(5)">
      <div class="level-num">5</div>
      <div class="level-info">
        <div class="level-name">Funci√≥n vs. Morfolog√≠a</div>
        <div class="level-desc">Diferencia la topograf√≠a de la funci√≥n en casos concretos</div>
      </div>
      <div class="level-arrow">‚Ä∫</div>
    </div>

    <div class="level-card animate-in delay-4 locked" id="lcard-6" onclick="startLevel(6)">
      <div class="level-num">6</div>
      <div class="level-info">
        <div class="level-name">Caso Cl√≠nico Integrador</div>
        <div class="level-desc">Aplica todo lo aprendido en una vi√±eta cl√≠nica simulada</div>
      </div>
      <div class="level-arrow">‚Ä∫</div>
    </div>
  </div>
</div>

<!-- ==================== LEVEL SCREEN (dynamic) ==================== -->
<div class="screen" id="screen-level">
  <div class="topbar">
    <div class="topbar-back" onclick="backToHome()">‚Üê</div>
    <div class="topbar-info">
      <div class="topbar-title" id="level-topbar-title">Nivel 1</div>
      <div class="topbar-subtitle" id="level-topbar-sub">¬øQu√© es Conducta?</div>
    </div>
    <div class="topbar-progress-wrap">
      <div class="topbar-progress-bar">
        <div class="topbar-progress-fill" id="level-progress-fill" style="width:0%"></div>
      </div>
      <div class="topbar-progress-text" id="level-progress-text">0%</div>
    </div>
  </div>
  <div class="content" id="level-content">
    <!-- Dynamic content injected here -->
  </div>
  <div class="bottom-bar" id="level-bottom">
    <button class="btn btn-primary" id="btn-check" onclick="checkCurrentQuestion()" disabled>Comprobar</button>
  </div>
</div>

<!-- ==================== SUMMARY SCREEN ==================== -->
<div class="screen" id="screen-summary">
  <div class="topbar">
    <div class="topbar-back" onclick="backToHome()">‚Üê</div>
    <div class="topbar-info">
      <div class="topbar-title">Resumen del Nivel</div>
      <div class="topbar-subtitle" id="summary-level-name"></div>
    </div>
  </div>
  <div class="content" id="summary-content">
    <!-- Dynamic -->
  </div>
  <div class="bottom-bar">
    <button class="btn btn-secondary" onclick="backToHome()">Volver al m√≥dulo</button>
    <button class="btn btn-success" id="btn-next-level" onclick="goNextLevel()">Siguiente nivel ‚Ä∫</button>
  </div>
</div>

<script>
// ===================================================================
// GOLDEN FLOATING PARTICLES
// ===================================================================
(function() {
  const canvas = document.getElementById('particles-canvas');
  const ctx = canvas.getContext('2d');
  let particles = [];
  const PARTICLE_COUNT = 28;

  function resize() {
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
  }
  window.addEventListener('resize', resize);
  resize();

  class Particle {
    constructor() { this.reset(); }
    reset() {
      this.x = Math.random() * canvas.width;
      this.y = Math.random() * canvas.height;
      this.size = Math.random() * 3.5 + 1;
      this.speedX = (Math.random() - 0.5) * 0.3;
      this.speedY = -Math.random() * 0.4 - 0.1;
      this.opacity = Math.random() * 0.5 + 0.15;
      this.pulse = Math.random() * Math.PI * 2;
      this.pulseSpeed = Math.random() * 0.02 + 0.008;
    }
    update() {
      this.x += this.speedX;
      this.y += this.speedY;
      this.pulse += this.pulseSpeed;
      if (this.y < -10 || this.x < -10 || this.x > canvas.width + 10) {
        this.y = canvas.height + 10;
        this.x = Math.random() * canvas.width;
      }
    }
    draw() {
      const glow = Math.sin(this.pulse) * 0.15 + 0.85;
      const alpha = this.opacity * glow;
      ctx.save();
      ctx.globalAlpha = alpha;
      // golden glow
      ctx.shadowBlur = this.size * 4;
      ctx.shadowColor = 'rgba(212, 149, 10, 0.4)';
      ctx.beginPath();
      ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
      ctx.fillStyle = `rgba(222, 165, 30, ${alpha})`;
      ctx.fill();
      // bright center
      ctx.beginPath();
      ctx.arc(this.x, this.y, this.size * 0.4, 0, Math.PI * 2);
      ctx.fillStyle = `rgba(255, 220, 100, ${alpha * 0.8})`;
      ctx.fill();
      ctx.restore();
    }
  }

  for (let i = 0; i < PARTICLE_COUNT; i++) particles.push(new Particle());

  function animate() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    particles.forEach(p => { p.update(); p.draw(); });
    requestAnimationFrame(animate);
  }
  animate();
})();
// ===================================================================
// DATA: ALL LEVELS CONTENT
// ===================================================================
const LEVELS = {
  1: {
    title: "¬øQu√© es Conducta?",
    theory: `
      <div class="theory-block">
        <div class="theory-label">üìñ Concepto fundamental</div>
        <div class="theory-heading">La conducta es todo lo que hace un organismo</div>
        <div class="theory-text">Desde el An√°lisis del Comportamiento, la conducta se define como <strong>cualquier actividad que realiza un organismo</strong>. No es algo que se "tiene", sino algo que se "hace". Es una propiedad relacional, no esencial: surge de la interacci√≥n entre el organismo y su ambiente.</div>
        <div class="theory-highlight">
          <em>Regla clave:</em> Expresar la conducta como un <em>verbo</em> (acci√≥n), no como un <em>sustantivo</em> (cosa). Un enamorado no "tiene amor": <em>ama</em>. Un delincuente no "tiene agresividad": <em>agrede</em>. Una persona no "tiene memoria": <em>recuerda</em>.
        </div>
        <div class="theory-source">‚Äî Procesos Psicol√≥gicos B√°sicos: Un An√°lisis Funcional (Guti√©rrez Dom√≠nguez)</div>
      </div>
      <div class="theory-block">
        <div class="theory-label">üî¨ Conducta p√∫blica y privada</div>
        <div class="theory-heading">Lo encubierto tambi√©n es conducta</div>
        <div class="theory-text">El Conductismo Radical de Skinner incluye los <strong>eventos privados</strong> (pensamientos, emociones, sensaciones) como conducta leg√≠tima. Un evento privado no tiene propiedades especiales por ser inaccesible a otros; se distingue solo por su <strong>accesibilidad limitada</strong>, no por su naturaleza.</div>
        <div class="theory-text">Pensar, imaginar, emocionarse, percibir... son conductas que operan bajo los mismos principios de aprendizaje que las conductas manifiestas. La diferencia es de <strong>accesibilidad</strong>, no de esencia.</div>
        <div class="theory-example">
          <div class="theory-example-label">Ejemplo</div>
          <p>Cuando en un examen imaginas objetos en movimiento para resolver un problema de f√≠sica, est√°s emitiendo una <strong>conducta operante encubierta</strong> (visi√≥n operante) que tiene consecuencias sobre tu conducta manifiesta.</p>
        </div>
        <div class="theory-source">‚Äî Skinner (1953), Ciencia y Conducta Humana</div>
      </div>
      <div class="theory-block">
        <div class="theory-label">‚öôÔ∏è Principio ITEMA</div>
        <div class="theory-heading">La conducta como fen√≥meno interactivo</div>
        <div class="theory-text">Seg√∫n el modelo del Manual de An√°lisis Funcional (ITEMA), la conducta no se entiende como una acci√≥n aislada, sino como un <strong>fen√≥meno interactivo</strong>: la interacci√≥n de alguna actividad (f√≠sica, cognitiva o fisiol√≥gica) de un ser en un contexto determinado.</div>
        <div class="theory-highlight">
          Solo entendiendo el <em>contexto</em> (antecedente o consecuente) donde se produce una acci√≥n, podremos entender el comportamiento del sujeto y su <em>funci√≥n</em>.
        </div>
        <div class="theory-source">‚Äî Manual de An√°lisis Funcional, ITEMA (Rocha y Almaz√°n)</div>
      </div>
    `,
    questions: [
      {
        type: 'single',
        text: '¬øCu√°l de las siguientes afirmaciones refleja mejor la definici√≥n de conducta desde el An√°lisis del Comportamiento?',
        options: [
          'La conducta es √∫nicamente lo que podemos ver y medir externamente',
          'La conducta es cualquier actividad que realiza un organismo, incluyendo lo p√∫blico y lo privado',
          'La conducta es la manifestaci√≥n externa de procesos mentales internos',
          'La conducta es sin√≥nimo de movimiento corporal voluntario'
        ],
        correct: 1,
        feedback_ok: '¬°Exacto! La conducta incluye toda actividad del organismo. Skinner defini√≥ conducta como "cualquier cosa que haga un organismo", incluyendo pensar, sentir e imaginar.',
        feedback_fail: 'La respuesta correcta es la B. Desde el Conductismo Radical, la conducta incluye tanto lo p√∫blico (observable por otros) como lo privado (pensamientos, emociones). Se distingue por accesibilidad, no por naturaleza.'
      },
      {
        type: 'single',
        text: 'Un paciente dice: "Tengo mucha ansiedad". Desde la perspectiva conductual, ¬øcu√°l es el problema con esta formulaci√≥n?',
        options: [
          'Deber√≠a decir "sufro de ansiedad" para ser m√°s preciso',
          'Trata la ansiedad como una cosa que se posee, cuando deber√≠a describirse como algo que se hace',
          'No hay ning√∫n problema, es una descripci√≥n cl√≠nica v√°lida',
          'Deber√≠a especificar el diagn√≥stico del DSM'
        ],
        correct: 1,
        feedback_ok: '¬°Correcto! La conducta se expresa como verbo, no sustantivo. No se "tiene" ansiedad ‚Äî el organismo "se activa", "anticipa peligro", "evita situaciones". Describir conductas como posesiones oscurece las relaciones funcionales.',
        feedback_fail: 'La respuesta correcta es la B. Desde el an√°lisis conductual, la conducta es una propiedad relacional, no esencial. Expresarla como sustantivo ("tener ansiedad") impide ver las relaciones funcionales con el entorno.'
      },
      {
        type: 'single',
        text: '¬øCu√°l de estas opciones es un ejemplo de conducta privada?',
        options: [
          'Un ni√±o levanta la mano en clase',
          'Una persona imagina el rostro de un ser querido al oler su perfume',
          'Un atleta corre los 100 metros',
          'Un perro saliva ante el sonido de una campana'
        ],
        correct: 1,
        feedback_ok: '¬°Bien! Imaginar es una conducta privada (visi√≥n condicionada). Es conducta leg√≠tima que opera bajo principios de condicionamiento cl√°sico: el perfume (EC) elicita la imagen (RC privada).',
        feedback_fail: 'La respuesta correcta es la B. Imaginar un rostro al oler un perfume es una respuesta condicionada privada. Solo es accesible al individuo que la emite, pero es conducta real sometida a las mismas leyes del aprendizaje.'
      },
      {
        type: 'single',
        text: 'Seg√∫n el modelo ITEMA, ¬øpor qu√© es fundamental entender el contexto para comprender una conducta?',
        options: [
          'Porque el contexto determina el diagn√≥stico cl√≠nico del paciente',
          'Porque la conducta es un fen√≥meno interactivo cuya funci√≥n solo se entiende en relaci√≥n con su antecedente y consecuente',
          'Porque sin contexto no podemos clasificar la conducta en el DSM',
          'Porque el contexto nos dice qu√© piensa el paciente'
        ],
        correct: 1,
        feedback_ok: '¬°Perfecto! La conducta es interacci√≥n organismo-entorno. Su funci√≥n emerge de esa relaci√≥n. Sin conocer antecedentes y consecuentes, no podemos comprender por qu√© una persona se comporta como lo hace.',
        feedback_fail: 'La respuesta correcta es la B. El modelo ITEMA establece que la conducta es un fen√≥meno interactivo. Solo entendiendo el contexto (antecedente y consecuente) podemos entender la funci√≥n del comportamiento.'
      }
    ]
  },

  2: {
    title: "Triple Sistema de Respuesta",
    theory: `
      <div class="theory-block">
        <div class="theory-label">üìñ Los tres componentes</div>
        <div class="theory-heading">Motor, Cognitivo y Fisiol√≥gico</div>
        <div class="theory-text">Cuando describimos una conducta-problema para el an√°lisis funcional, debemos atender a su <strong>morfolog√≠a</strong>, que se descompone en tres sistemas de respuesta:</div>
        <div class="theory-highlight">
          <em>Motor:</em> Acciones manifiestas y observables (correr, gritar, golpear, escribir, evitar una situaci√≥n).
        </div>
        <div class="theory-highlight">
          <em>Cognitivo:</em> Verbalizaciones encubiertas (pensamientos) asociadas a est√≠mulos que tienen alguna consecuencia relevante cl√≠nicamente. "Pensar por pensar" no cuenta.
        </div>
        <div class="theory-highlight">
          <em>Fisiol√≥gico:</em> Respuestas del organismo: tensi√≥n muscular, sudoraci√≥n, taquicardia, mareos, temblor, etc. Las <em>respuestas emocionales</em> son la combinaci√≥n de componentes cognitivos y fisiol√≥gicos.
        </div>
        <div class="theory-source">‚Äî Manual de An√°lisis Funcional, ITEMA (Rocha y Almaz√°n), p.84</div>
      </div>
      <div class="theory-block">
        <div class="theory-label">üîë Principio clave</div>
        <div class="theory-heading">Mismos principios de aprendizaje</div>
        <div class="theory-text">Ya sean componentes manifiestos o encubiertos, lo importante es que <strong>operan bajo los mismos principios de aprendizaje</strong>. De ah√≠ que se consideren equivalentes desde el punto de vista funcional.</div>
        <div class="theory-example">
          <div class="theory-example-label">Caso ejemplo: Fobia a las ara√±as (ITEMA)</div>
          <p><strong>Motor:</strong> Conductas de escape (salir corriendo, pedir ayuda para que alguien la mate).</p>
          <p><strong>Fisiol√≥gico:</strong> Escalofr√≠os, temblor, tensi√≥n muscular, sudoraci√≥n, taquicardia.</p>
          <p><strong>Cognitivo:</strong> Verbalizaciones anticipatorias sobre la probabilidad de aparici√≥n.</p>
        </div>
      </div>
    `,
    questions: [
      {
        type: 'single',
        text: 'Un cliente con fobia social, antes de una presentaci√≥n, piensa: "Van a notar que estoy nervioso y se van a re√≠r de m√≠". ¬øA qu√© componente pertenece?',
        options: ['Motor', 'Cognitivo', 'Fisiol√≥gico', 'Emocional puro'],
        correct: 1,
        feedback_ok: '¬°Correcto! Es una verbalizaci√≥n encubierta (pensamiento) anticipatoria que tiene funci√≥n discriminativa para conductas de evitaci√≥n. Es componente cognitivo.',
        feedback_fail: 'La respuesta correcta es Cognitivo. Los pensamientos anticipatorios son verbalizaciones encubiertas que, cuando tienen consecuencias relevantes cl√≠nicamente (como discriminar la evitaci√≥n), se clasifican como componente cognitivo.'
      },
      {
        type: 'single',
        text: 'Tras recibir una mala noticia, una persona siente un nudo en el est√≥mago y taquicardia. ¬øQu√© componente es?',
        options: ['Motor', 'Cognitivo', 'Fisiol√≥gico', 'Ninguno, no es conducta'],
        correct: 2,
        feedback_ok: '¬°Exacto! Las respuestas del sistema nervioso aut√≥nomo (taquicardia, sensaciones viscerales) son componentes fisiol√≥gicos. Son respuestas del organismo ante la estimulaci√≥n.',
        feedback_fail: 'La respuesta correcta es Fisiol√≥gico. La taquicardia y las sensaciones viscerales son respuestas fisiol√≥gicas del organismo. Son conducta real, aunque el acceso sea principalmente privado.'
      },
      {
        type: 'single',
        text: 'Una persona con agorafobia sale corriendo de un centro comercial cuando empieza a sentirse agobiada. ¬øA qu√© componente corresponde "salir corriendo"?',
        options: ['Motor', 'Cognitivo', 'Fisiol√≥gico', 'Emocional'],
        correct: 0,
        feedback_ok: '¬°Bien! Salir corriendo es una acci√≥n manifiesta observable ‚Äî componente motor. Es una conducta de escape que probablemente se mantiene por reforzamiento negativo (reducci√≥n de la activaci√≥n aversiva).',
        feedback_fail: 'La respuesta correcta es Motor. Salir corriendo es una acci√≥n observable y manifiesta, por tanto es componente motor. Es una conducta de escape mantenida t√≠picamente por reforzamiento negativo.'
      },
      {
        type: 'single',
        text: 'Seg√∫n ITEMA, las respuestas emocionales (por ejemplo, sentir "miedo") se consideran:',
        options: [
          'Un cuarto componente independiente del triple sistema',
          'La combinaci√≥n de componentes cognitivos y fisiol√≥gicos',
          'Exclusivamente componente fisiol√≥gico',
          'No son conducta, son estados mentales internos'
        ],
        correct: 1,
        feedback_ok: '¬°Perfecto! Las respuestas emocionales son el resultado de la combinaci√≥n de componentes cognitivos (verbalizaciones encubiertas) y fisiol√≥gicos (activaci√≥n del organismo). No son un sistema aparte.',
        feedback_fail: 'La respuesta correcta es la B. Seg√∫n ITEMA, las emociones no son un sistema separado sino la combinaci√≥n de componentes cognitivos y fisiol√≥gicos actuando conjuntamente.'
      }
    ]
  },

  3: {
    title: "Par√°metros de la Conducta",
    theory: `
      <div class="theory-block">
        <div class="theory-label">üìñ Topograf√≠a conductual</div>
        <div class="theory-heading">Los cuatro par√°metros para medir la conducta</div>
        <div class="theory-text">Para describir adecuadamente una conducta-problema necesitamos cuantificarla a trav√©s de sus <strong>par√°metros topogr√°ficos</strong>. Estos son los aspectos medibles que permiten operativizar la conducta:</div>
        <div class="theory-highlight"><em>Ocurrencia:</em> Si la conducta se da o no en una situaci√≥n determinada. Es el par√°metro m√°s b√°sico. ¬øAparece la conducta?</div>
        <div class="theory-highlight"><em>Frecuencia:</em> Cu√°ntas veces aparece la conducta en un per√≠odo de tiempo. Permite establecer l√≠neas base y medir cambios.</div>
        <div class="theory-highlight"><em>Intensidad:</em> La fuerza o magnitud con la que se presenta la conducta. Por ejemplo, no es lo mismo un llanto leve que uno inconsolable.</div>
        <div class="theory-highlight"><em>Duraci√≥n:</em> El tiempo que la conducta se mantiene activa. Un episodio de rumia que dura 5 minutos es diferente de uno que dura 3 horas.</div>
        <div class="theory-source">‚Äî Manual de An√°lisis Funcional, ITEMA (Rocha y Almaz√°n), p.83-84</div>
      </div>
      <div class="theory-block">
        <div class="theory-label">‚öôÔ∏è Aplicaci√≥n cl√≠nica</div>
        <div class="theory-heading">¬øPor qu√© medir par√°metros?</div>
        <div class="theory-text">El an√°lisis de secuencias debe incluir <strong>aspectos cuantitativos, medibles y operativizables</strong>. Los par√°metros nos permiten establecer una l√≠nea base antes de la intervenci√≥n, evaluar si el tratamiento produce cambios, y comunicarnos con precisi√≥n entre profesionales.</div>
        <div class="theory-text">Las conductas operantes var√≠an en sus par√°metros (frecuencia, intensidad y duraci√≥n) debido a los est√≠mulos consecuentes. Por eso, medir estos par√°metros antes y despu√©s de modificar contingencias es la forma de demostrar cambio terap√©utico.</div>
      </div>
    `,
    questions: [
      {
        type: 'single',
        text: 'Un terapeuta registra que su paciente ha tenido 12 episodios de llanto en la √∫ltima semana. ¬øQu√© par√°metro est√° midiendo?',
        options: ['Ocurrencia', 'Frecuencia', 'Intensidad', 'Duraci√≥n'],
        correct: 1,
        feedback_ok: '¬°Correcto! Contar cu√°ntas veces ocurre una conducta en un per√≠odo de tiempo es medir su frecuencia. Es el par√°metro m√°s utilizado para establecer l√≠neas base.',
        feedback_fail: 'La respuesta correcta es Frecuencia. Registrar el n√∫mero de episodios en un per√≠odo de tiempo determinado es una medida de frecuencia.'
      },
      {
        type: 'single',
        text: 'Una madre reporta: "Cuando mi hijo hace berrinches, se tira al suelo y grita tan fuerte que los vecinos lo escuchan". ¬øA qu√© par√°metro se refiere "tan fuerte que los vecinos lo escuchan"?',
        options: ['Ocurrencia', 'Frecuencia', 'Intensidad', 'Duraci√≥n'],
        correct: 2,
        feedback_ok: '¬°Exacto! La magnitud o fuerza del grito (que alcanza a ser escuchado por los vecinos) es una medida de intensidad. Nos habla de la fuerza con que se emite la conducta.',
        feedback_fail: 'La respuesta correcta es Intensidad. La fuerza del grito, que incluso los vecinos escuchan, nos indica la magnitud o intensidad de la conducta.'
      },
      {
        type: 'single',
        text: '"El paciente dice que cuando empieza a rumiar sobre el trabajo, puede pasar hasta 2 horas sin poder parar." ¬øQu√© par√°metro se describe aqu√≠?',
        options: ['Ocurrencia', 'Frecuencia', 'Intensidad', 'Duraci√≥n'],
        correct: 3,
        feedback_ok: '¬°Bien! Las 2 horas de rumia indican la duraci√≥n de la conducta, es decir, cu√°nto tiempo se mantiene activa en cada episodio.',
        feedback_fail: 'La respuesta correcta es Duraci√≥n. El tiempo que la conducta se mantiene activa (2 horas rumiando) es una medida de duraci√≥n.'
      },
      {
        type: 'single',
        text: '¬øCu√°l es la diferencia principal entre "ocurrencia" y "frecuencia"?',
        options: [
          'No hay diferencia, son sin√≥nimos',
          'La ocurrencia indica si la conducta se da o no; la frecuencia cu√°ntas veces se da en un per√≠odo',
          'La ocurrencia se mide en tiempo; la frecuencia en n√∫mero',
          'La frecuencia es m√°s importante cl√≠nicamente que la ocurrencia'
        ],
        correct: 1,
        feedback_ok: '¬°Perfecto! La ocurrencia es dicot√≥mica (s√≠/no, se da o no se da), mientras que la frecuencia cuantifica cu√°ntas veces aparece. Son par√°metros complementarios.',
        feedback_fail: 'La respuesta correcta es la B. La ocurrencia es el par√°metro m√°s b√°sico: ¬øse da la conducta? (s√≠/no). La frecuencia a√±ade informaci√≥n cuantitativa: ¬øcu√°ntas veces?'
      }
    ]
  },

  4: {
    title: "De la Etiqueta a la Operacionalizaci√≥n",
    theory: `
      <div class="theory-block">
        <div class="theory-label">üìñ El problema de las etiquetas</div>
        <div class="theory-heading">Rechazar los r√≥tulos, describir la conducta</div>
        <div class="theory-text">Desde la Modificaci√≥n de Conducta, las <strong>etiquetas diagn√≥sticas</strong> y el modelo m√©dico pierden valor explicativo. Los sistemas de clasificaci√≥n basados en la morfolog√≠a de las respuestas tienen poca utilidad para explicar los problemas. Decir que alguien "es agresivo" o "tiene depresi√≥n" no nos dice nada sobre las relaciones funcionales que mantienen esas conductas.</div>
        <div class="theory-highlight">
          <em>Operacionalizar</em> significa describir la conducta en t√©rminos <em>observables</em>, <em>medibles</em> y <em>cuantificables</em>, atendiendo al triple sistema de respuesta y a sus par√°metros. La descripci√≥n debe permitir que dos observadores independientes puedan identificar la misma conducta.
        </div>
        <div class="theory-source">‚Äî Manual de An√°lisis Funcional, ITEMA (Rocha y Almaz√°n), p.40-41</div>
      </div>
      <div class="theory-block">
        <div class="theory-label">üî¨ Esquema E-R-E</div>
        <div class="theory-heading">Operacionalizar dentro de la secuencia funcional</div>
        <div class="theory-text">Al identificar los problemas del cliente, hay que <strong>describirlos y operativizarlos</strong> tomando como secuencia b√°sica el esquema <strong>E-R-E</strong> (Est√≠mulo-Respuesta-Est√≠mulo). Debemos prestar especial atenci√≥n a los aspectos que hacen que esa conducta, para esa persona en concreto, resulte desadaptativa en el contexto y momento en el que tiene lugar.</div>
        <div class="theory-example">
          <div class="theory-example-label">Mal vs. Bien operacionalizado</div>
          <p>‚ùå "El paciente es agresivo"</p>
          <p>‚úÖ "El paciente golpea la mesa con el pu√±o (motor) cuando su jefe le asigna tareas nuevas (antecedente), acompa√±ado de tensi√≥n mandibular y aumento de tasa card√≠aca (fisiol√≥gico), pensando 'siempre me cargan a m√≠ todo' (cognitivo). Frecuencia: 3-4 veces/semana."</p>
        </div>
      </div>
    `,
    questions: [
      {
        type: 'single',
        text: '¬øCu√°l de las siguientes es la mejor operacionalizaci√≥n de "un ni√±o con problemas de atenci√≥n"?',
        options: [
          'El ni√±o tiene TDAH y no puede concentrarse',
          'El ni√±o se distrae porque tiene un d√©ficit en la funci√≥n ejecutiva',
          'El ni√±o permanece mirando la tarea menos de 2 minutos antes de mirar hacia la ventana o hablar con un compa√±ero, esto ocurre en 8 de cada 10 tareas asignadas',
          'El ni√±o es distra√≠do y no presta atenci√≥n a nada'
        ],
        correct: 2,
        feedback_ok: '¬°Excelente! Esta descripci√≥n es observable (mirar la tarea, mirar la ventana, hablar), medible (menos de 2 min, 8 de 10 tareas) y espec√≠fica. Permite que cualquier observador identifique la misma conducta.',
        feedback_fail: 'La respuesta correcta es la C. Es la √∫nica que describe la conducta en t√©rminos observables y medibles, con par√°metros concretos (duraci√≥n, frecuencia) que permiten evaluaci√≥n objetiva.'
      },
      {
        type: 'single',
        text: '"La paciente se muestra dependiente emocionalmente." ¬øPor qu√© esta descripci√≥n es inadecuada para un an√°lisis funcional?',
        options: [
          'Porque "dependiente" es un t√©rmino muy coloquial',
          'Porque es una etiqueta que no describe conductas concretas, medibles ni observables, ni permite identificar relaciones funcionales',
          'Porque las emociones no se incluyen en el an√°lisis funcional',
          'Porque falta el nombre del diagn√≥stico'
        ],
        correct: 1,
        feedback_ok: '¬°Correcto! "Dependiente emocionalmente" es una etiqueta descriptiva que no nos dice qu√© hace la persona concretamente, con qu√© frecuencia, ni en qu√© contextos. Sin operacionalizar, no podemos analizar relaciones funcionales.',
        feedback_fail: 'La respuesta correcta es la B. Las etiquetas como "dependiente" no permiten identificar qu√© conductas concretas ocurren, en qu√© situaciones, ni qu√© las mantiene. Para un AF necesitamos conductas operacionalizadas.'
      },
      {
        type: 'single',
        text: '¬øCu√°l es la mejor operacionalizaci√≥n de "el paciente est√° deprimido"?',
        options: [
          'El paciente tiene un trastorno depresivo mayor seg√∫n DSM-5',
          'El paciente permanece en cama m√°s de 14 horas diarias (motor), refiere pensamientos de inutilidad como "no sirvo para nada" varias veces al d√≠a (cognitivo), y presenta llanto espont√°neo 3-4 veces/semana con duraci√≥n de 10-15 min (motor/fisiol√≥gico)',
          'El paciente se siente triste y sin ganas de nada',
          'El paciente presenta √°nimo bajo y apat√≠a generalizada'
        ],
        correct: 1,
        feedback_ok: '¬°Perfecto! Describe conductas concretas en los tres sistemas de respuesta (motor, cognitivo, fisiol√≥gico) con par√°metros espec√≠ficos (horas, veces/d√≠a, veces/semana, duraci√≥n). Esto s√≠ permite hacer un an√°lisis funcional.',
        feedback_fail: 'La respuesta correcta es la B. Es la √∫nica que descompone la "depresi√≥n" en conductas concretas y medibles dentro del triple sistema de respuesta, con par√°metros cuantificables.'
      },
      {
        type: 'single',
        text: 'Seg√∫n ITEMA, una buena operacionalizaci√≥n de la conducta-problema debe atender a:',
        options: [
          'Solo a la funcionalidad (RC u RO)',
          'Solo a la morfolog√≠a (motor, cognitivo, fisiol√≥gico)',
          'Funcionalidad, topograf√≠a (par√°metros) y morfolog√≠a (triple sistema)',
          'Al diagn√≥stico CIE-10 correspondiente'
        ],
        correct: 2,
        feedback_ok: '¬°Excelente! ITEMA indica que para describir la conducta-problema debemos atender a: su funcionalidad (RC vs RO), su topograf√≠a (par√°metros de ocurrencia, frecuencia, intensidad, duraci√≥n) y su morfolog√≠a (componentes motor, cognitivo, fisiol√≥gico).',
        feedback_fail: 'La respuesta correcta es la C. Seg√∫n ITEMA, la descripci√≥n completa de la conducta-problema incluye: funcionalidad (¬øaltera el organismo o act√∫a sobre el entorno?), topograf√≠a (par√°metros), y morfolog√≠a (triple sistema).'
      }
    ]
  },

  5: {
    title: "Funci√≥n vs. Morfolog√≠a",
    theory: `
      <div class="theory-block">
        <div class="theory-label">üìñ El concepto de operante</div>
        <div class="theory-heading">La funci√≥n define la conducta, no su forma</div>
        <div class="theory-text">Skinner defini√≥ la <strong>operante</strong> por su funci√≥n (relaci√≥n con sus consecuencias), no por su morfolog√≠a o topograf√≠a. Una misma clase de respuestas puede tener formas muy distintas pero pertenecer a la misma operante si producen las mismas consecuencias.</div>
        <div class="theory-highlight">
          <em>Una misma topograf√≠a</em> de respuesta puede tener <em>distintas funciones</em>. Y <em>distintas topograf√≠as</em> pueden tener la <em>misma funci√≥n</em>. Lo que importa al an√°lisis funcional es la relaci√≥n con antecedentes y consecuentes, no la forma.
        </div>
        <div class="theory-source">‚Äî Manual de An√°lisis Funcional, ITEMA (Rocha y Almaz√°n), p.34; Procesos Psicol√≥gicos B√°sicos, cap. 4</div>
      </div>
      <div class="theory-block">
        <div class="theory-label">‚ö†Ô∏è Error frecuente</div>
        <div class="theory-heading">Confundir forma y funci√≥n en cl√≠nica</div>
        <div class="theory-text">Un error com√∫n es asumir que conductas que "se ven igual" tienen la misma funci√≥n. Por ejemplo, un ni√±o que llora puede estar buscando atenci√≥n social (R+ social), escapando de una tarea aversiva (R-), o respondiendo a dolor f√≠sico (RC). La misma topograf√≠a ‚Äî tres funciones completamente distintas que requieren intervenciones diferentes.</div>
        <div class="theory-example">
          <div class="theory-example-label">Ejemplo inverso</div>
          <p>Tres personas con "el mismo problema" (evitaci√≥n social): una no va a fiestas, otra habla constantemente para evitar silencios, y otra bebe alcohol antes de socializar. <strong>Tres topograf√≠as distintas, misma funci√≥n:</strong> todas reducen la estimulaci√≥n aversiva asociada al contacto social (reforzamiento negativo).</p>
        </div>
      </div>
    `,
    questions: [
      {
        type: 'single',
        text: 'Un ni√±o llora cuando su madre le dice que apague la tablet. La madre, para que pare de llorar, le deja seguir jugando. ¬øCu√°l es la funci√≥n m√°s probable del llanto en esta secuencia?',
        options: [
          'Expresar tristeza genuina por la p√©rdida',
          'Respuesta condicionada de malestar (RC)',
          'Operante mantenida por reforzamiento negativo (escape de la retirada de la tablet)',
          'Operante mantenida por reforzamiento positivo (atenci√≥n social de la madre)'
        ],
        correct: 2,
        feedback_ok: '¬°Correcto! El llanto funciona como operante de escape: su consecuencia es la retirada de la situaci√≥n aversiva (que le quiten la tablet). La madre, al ceder, refuerza negativamente el llanto.',
        feedback_fail: 'La respuesta correcta es la C. El llanto produce la consecuencia de que no le retiren la tablet (se elimina la situaci√≥n aversiva). Es reforzamiento negativo: la conducta se mantiene porque elimina algo aversivo.'
      },
      {
        type: 'single',
        text: 'Dos pacientes llegan quej√°ndose de "insomnio". El paciente A se queda en cama rumiando preocupaciones laborales. El paciente B se queda despierto porque mira el m√≥vil hasta las 3am. ¬øQu√© ilustra este ejemplo?',
        options: [
          'Que el insomnio tiene diferentes causas biol√≥gicas',
          'Que la misma etiqueta topogr√°fica ("insomnio") puede tener funciones y secuencias funcionales completamente distintas',
          'Que ambos necesitan la misma medicaci√≥n',
          'Que el diagn√≥stico de insomnio es incorrecto en uno de los dos'
        ],
        correct: 1,
        feedback_ok: '¬°Exacto! "No dormir" es la misma topograf√≠a, pero las cadenas funcionales son muy diferentes. En A, la rumia (conducta encubierta) es mantenida por R- parcial; en B, el uso del m√≥vil es mantenido por R+ (estimulaci√≥n). Intervenciones muy distintas.',
        feedback_fail: 'La respuesta correcta es la B. Este ejemplo ilustra por qu√© las etiquetas topogr√°ficas son insuficientes: la misma "forma" de conducta puede tener relaciones funcionales completamente diferentes.'
      },
      {
        type: 'single',
        text: 'Un adolescente se autolesiona cort√°ndose. En el an√°lisis funcional se descubre que la autolesi√≥n reduce r√°pidamente una activaci√≥n emocional intensa. ¬øQu√© tipo de reforzamiento mantiene esta conducta?',
        options: [
          'Reforzamiento positivo (obtiene atenci√≥n)',
          'Reforzamiento negativo (elimina estimulaci√≥n aversiva)',
          'Castigo positivo (se produce dolor)',
          'No hay reforzamiento, es una conducta patol√≥gica'
        ],
        correct: 1,
        feedback_ok: '¬°Correcto! La autolesi√≥n se mantiene por reforzamiento negativo: la conducta elimina o reduce la activaci√≥n emocional aversiva. El dolor f√≠sico queda subordinado a la funci√≥n de escape del malestar emocional. Esto es clave para la intervenci√≥n.',
        feedback_fail: 'La respuesta correcta es reforzamiento negativo. La conducta se mantiene porque su consecuencia es la reducci√≥n de la estimulaci√≥n aversiva (activaci√≥n emocional intensa). La forma (cortarse) no define la funci√≥n (escape).'
      },
      {
        type: 'single',
        text: '¬øPor qu√© es un error dise√±ar la misma intervenci√≥n para todas las personas que "evitan situaciones sociales"?',
        options: [
          'Porque algunos diagn√≥sticos son m√°s graves que otros',
          'Porque la misma topograf√≠a (evitaci√≥n) puede mantenerse por funciones distintas en cada persona, y la intervenci√≥n debe dirigirse a la funci√≥n, no a la forma',
          'Porque cada persona tiene diferente personalidad',
          'No es un error, la evitaci√≥n social se trata siempre con exposici√≥n'
        ],
        correct: 1,
        feedback_ok: '¬°Perfecto! Este es el principio fundamental: la intervenci√≥n se dirige a la funci√≥n, no a la forma. Una persona puede evitar por R- (reducir ansiedad), otra por R+ (atenci√≥n), otra por falta de habilidades. Cada funci√≥n requiere una estrategia diferente.',
        feedback_fail: 'La respuesta correcta es la B. Cada caso es √∫nico porque la misma topograf√≠a de evitaci√≥n puede responder a diferentes relaciones funcionales. El AF analiza la funci√≥n espec√≠fica de cada caso para dise√±ar la intervenci√≥n adecuada.'
      }
    ]
  },

  6: {
    title: "Caso Cl√≠nico Integrador",
    theory: `
      <div class="case-vignette">
        <div class="case-vignette-title">Caso cl√≠nico: Elena, 28 a√±os</div>
        <p>Elena acude a consulta porque "tiene mucha ansiedad en el trabajo". Trabaja como coordinadora de proyectos en una empresa de consultor√≠a. Lleva 8 meses en el puesto.</p>
        <p>Refiere que cuando su jefe le asigna presentaciones ante clientes, "se bloquea". Describe que la noche anterior a la presentaci√≥n apenas duerme, y la ma√±ana del d√≠a, siente "un nudo en el est√≥mago" y le tiemblan las manos. Ha llegado a llamar diciendo que est√° enferma para no presentar (3 veces en los √∫ltimos 2 meses).</p>
        <p>Cuando consigue ir, habla muy r√°pido, evita el contacto visual con la audiencia, y dice que piensa cosas como "van a notar que no estoy preparada" y "me van a despedir si lo hago mal". Despu√©s de la presentaci√≥n, su jefe generalmente le dice "buen trabajo" pero ella piensa "solo lo dice por compromiso".</p>
        <p>En cambio, cuando trabaja en su despacho preparando informes, se desempe√±a bien y recibe evaluaciones positivas.</p>
      </div>
      <div class="theory-block">
        <div class="theory-label">üéØ Tu tarea</div>
        <div class="theory-heading">Aplica lo aprendido en los 5 niveles</div>
        <div class="theory-text">Vas a analizar el caso de Elena paso a paso: identificar conductas concretas, descomponerlas en el triple sistema, asignar par√°metros y elegir la mejor operacionalizaci√≥n. Cada pregunta simula una decisi√≥n cl√≠nica real.</div>
      </div>
    `,
    questions: [
      {
        type: 'single',
        text: 'El terapeuta inicial registra: "Elena tiene ansiedad laboral". ¬øCu√°l es el primer paso para mejorar esta formulaci√≥n?',
        options: [
          'Buscar el diagn√≥stico de trastorno de ansiedad generalizada en el DSM-5',
          'Identificar las conductas concretas (motor, cognitivo, fisiol√≥gico) que Elena emite en las situaciones problem√°ticas',
          'Investigar si Elena tuvo traumas en la infancia',
          'Aplicar un cuestionario de ansiedad estandarizado'
        ],
        correct: 1,
        feedback_ok: '¬°Correcto! El primer paso es operacionalizar: convertir la etiqueta "ansiedad laboral" en conductas concretas y observables dentro del triple sistema de respuesta, situadas en sus contextos espec√≠ficos.',
        feedback_fail: 'La respuesta correcta es la B. Antes de cualquier otra cosa, necesitamos saber qu√© conductas concretas est√° emitiendo Elena. "Ansiedad laboral" es una etiqueta que no describe la interacci√≥n funcional.'
      },
      {
        type: 'single',
        text: 'Del caso de Elena, "le tiemblan las manos y siente un nudo en el est√≥mago". ¬øA qu√© componente del triple sistema pertenece?',
        options: ['Motor', 'Cognitivo', 'Fisiol√≥gico', 'Todos a la vez'],
        correct: 2,
        feedback_ok: '¬°Exacto! El temblor de manos y la sensaci√≥n de nudo en el est√≥mago son respuestas fisiol√≥gicas del organismo. Son respuestas condicionadas (RC) ante el est√≠mulo condicionado aversivo (la presentaci√≥n).',
        feedback_fail: 'La respuesta correcta es Fisiol√≥gico. El temblor y las sensaciones viscerales son respuestas del organismo (componente fisiol√≥gico), probablemente RC ante el EC aversivo de la presentaci√≥n.'
      },
      {
        type: 'single',
        text: 'Elena ha llamado diciendo que est√° enferma para no presentar, 3 veces en los √∫ltimos 2 meses. ¬øQu√© par√°metro y qu√© tipo de conducta estamos describiendo?',
        options: [
          'Intensidad de una respuesta condicionada',
          'Frecuencia de una conducta de evitaci√≥n (operante)',
          'Duraci√≥n de un episodio de ansiedad',
          'Ocurrencia de un s√≠ntoma depresivo'
        ],
        correct: 1,
        feedback_ok: '¬°Perfecto! "3 veces en 2 meses" es un dato de frecuencia. Llamar para no ir es una conducta de evitaci√≥n (operante) que probablemente se mantiene por reforzamiento negativo: elimina la exposici√≥n al est√≠mulo aversivo.',
        feedback_fail: 'La respuesta correcta es la B. Contamos 3 episodios en 2 meses (frecuencia) de una conducta de evitaci√≥n, que es operante mantenida por la consecuencia de no exponerse a la situaci√≥n temida (R-).'
      },
      {
        type: 'single',
        text: '"Van a notar que no estoy preparada" y "me van a despedir si lo hago mal". ¬øQu√© funci√≥n cumplen estos pensamientos en la secuencia funcional?',
        options: [
          'Son la causa de la ansiedad de Elena',
          'Son respuestas cognitivas (verbalizaciones encubiertas) que funcionan como est√≠mulos discriminativos para las conductas de evitaci√≥n',
          'Son s√≠ntomas del trastorno de ansiedad',
          'Son irrelevantes para el an√°lisis funcional'
        ],
        correct: 1,
        feedback_ok: '¬°Excelente! Los pensamientos anticipatorios son verbalizaciones encubiertas (componente cognitivo) que funcionan como E·¥∞ (est√≠mulos discriminativos) para las conductas de evitaci√≥n. Discriminan la "disponibilidad" del reforzador negativo (si evito, no sufro).',
        feedback_fail: 'La respuesta correcta es la B. Desde el an√°lisis funcional, estos pensamientos son conductas verbales encubiertas que funcionan como est√≠mulos discriminativos: se√±alan que evitar producir√° alivio (R-).'
      }
    ]
  }
};

// ===================================================================
// APP STATE
// ===================================================================
let state = {
  currentLevel: 0,
  currentQuestion: 0,
  answers: {},       // { levelId: [0,1,1,0...] } 1=correct
  unlockedLevels: [1],
  completedLevels: [],
  selectedOption: null,
  questionChecked: false
};

// Try load from localStorage
try {
  const saved = localStorage.getItem('afc_mod1_state');
  if (saved) {
    const parsed = JSON.parse(saved);
    state.unlockedLevels = parsed.unlockedLevels || [1];
    state.completedLevels = parsed.completedLevels || [];
    state.answers = parsed.answers || {};
  }
} catch(e) {}

function saveState() {
  try {
    localStorage.setItem('afc_mod1_state', JSON.stringify({
      unlockedLevels: state.unlockedLevels,
      completedLevels: state.completedLevels,
      answers: state.answers
    }));
  } catch(e) {}
}

// ===================================================================
// NAVIGATION
// ===================================================================
function showScreen(id) {
  document.querySelectorAll('.screen').forEach(s => {
    s.classList.remove('active');
    s.classList.remove('exit-left');
  });
  setTimeout(() => {
    document.getElementById(id).classList.add('active');
  }, 50);
}

function goToDashboard() {
  // In real app, would navigate away. For now just show alert
  alert('Volver al Dashboard (en la versi√≥n completa, navegar√≠a al dashboard principal)');
}

function backToHome() {
  updateHomeCards();
  showScreen('screen-home');
}

function updateHomeCards() {
  for (let i = 1; i <= 6; i++) {
    const card = document.getElementById('lcard-' + i);
    if (!card) continue;
    card.classList.remove('locked', 'completed');
    if (state.completedLevels.includes(i)) {
      card.classList.add('completed');
      card.querySelector('.level-arrow').innerHTML = '‚úì';
      card.querySelector('.level-arrow').style.color = 'var(--green)';
    } else if (!state.unlockedLevels.includes(i)) {
      card.classList.add('locked');
    }
  }
  // Level 1 card doesn't have id lcard-1, it's always unlocked
}

// ===================================================================
// LEVEL RENDERING
// ===================================================================
function startLevel(levelId) {
  if (!state.unlockedLevels.includes(levelId) && !state.completedLevels.includes(levelId)) return;
  
  state.currentLevel = levelId;
  state.currentQuestion = 0;
  state.selectedOption = null;
  state.questionChecked = false;
  state.answers[levelId] = [];

  const level = LEVELS[levelId];
  
  document.getElementById('level-topbar-title').textContent = 'Nivel ' + levelId;
  document.getElementById('level-topbar-sub').textContent = level.title;
  updateProgress(0, level.questions.length);
  
  renderLevelContent(levelId);
  showScreen('screen-level');
}

function renderLevelContent(levelId) {
  const level = LEVELS[levelId];
  const content = document.getElementById('level-content');
  const qIdx = state.currentQuestion;
  
  // Show theory only before first question
  if (qIdx === 0) {
    content.innerHTML = level.theory;
    document.getElementById('btn-check').textContent = 'Comenzar ejercicios ‚Ä∫';
    document.getElementById('btn-check').disabled = false;
    document.getElementById('btn-check').onclick = () => showQuestion(levelId);
    content.scrollTop = 0;
    return;
  }
  
  showQuestion(levelId);
}

function showQuestion(levelId) {
  const level = LEVELS[levelId];
  const qIdx = state.currentQuestion;
  
  if (qIdx >= level.questions.length) {
    showSummary(levelId);
    return;
  }
  
  const q = level.questions[qIdx];
  const content = document.getElementById('level-content');
  
  updateProgress(qIdx, level.questions.length);
  
  let html = `
    <div class="question-card animate-in">
      <div class="question-number">Pregunta ${qIdx + 1} de ${level.questions.length}</div>
      <div class="question-text">${q.text}</div>
      ${q.context ? `<div class="question-context">${q.context}</div>` : ''}
      <div id="options-container">
  `;
  
  const letters = ['A', 'B', 'C', 'D'];
  q.options.forEach((opt, i) => {
    html += `
      <div class="option" id="opt-${i}" onclick="selectOption(${i})">
        <div class="option-marker">${letters[i]}</div>
        <div class="option-text">${opt}</div>
      </div>
    `;
  });
  
  html += `
      </div>
      <div class="feedback" id="feedback-box"></div>
    </div>
  `;
  
  content.innerHTML = html;
  content.scrollTop = 0;
  
  state.selectedOption = null;
  state.questionChecked = false;
  
  const btn = document.getElementById('btn-check');
  btn.textContent = 'Comprobar';
  btn.disabled = true;
  btn.className = 'btn btn-primary';
  btn.onclick = () => checkCurrentQuestion();
}

function selectOption(idx) {
  if (state.questionChecked) return;
  
  state.selectedOption = idx;
  
  document.querySelectorAll('.option').forEach((el, i) => {
    el.classList.remove('selected');
    if (i === idx) el.classList.add('selected');
  });
  
  document.getElementById('btn-check').disabled = false;
}

function checkCurrentQuestion() {
  if (state.selectedOption === null || state.questionChecked) return;
  
  state.questionChecked = true;
  const levelId = state.currentLevel;
  const level = LEVELS[levelId];
  const q = level.questions[state.currentQuestion];
  const correct = state.selectedOption === q.correct;
  
  if (!state.answers[levelId]) state.answers[levelId] = [];
  state.answers[levelId].push(correct ? 1 : 0);
  
  // Style options
  document.querySelectorAll('.option').forEach((el, i) => {
    el.classList.add('disabled');
    if (i === q.correct) {
      el.classList.remove('selected');
      el.classList.add('correct');
    } else if (i === state.selectedOption && !correct) {
      el.classList.add('incorrect');
    } else {
      el.classList.add('dimmed');
    }
  });
  
  // Show feedback
  const fb = document.getElementById('feedback-box');
  fb.className = 'feedback show ' + (correct ? 'correct' : 'incorrect');
  fb.innerHTML = correct 
    ? `<strong>‚úì ¬°Correcto!</strong><br>${q.feedback_ok}`
    : `<strong>‚úó No exactamente</strong><br>${q.feedback_fail}`;
  
  // Scroll to feedback
  setTimeout(() => fb.scrollIntoView({ behavior: 'smooth', block: 'nearest' }), 100);
  
  // Change button
  const btn = document.getElementById('btn-check');
  const isLast = state.currentQuestion >= level.questions.length - 1;
  btn.textContent = isLast ? 'Ver resumen ‚Ä∫' : 'Siguiente pregunta ‚Ä∫';
  btn.className = 'btn ' + (correct ? 'btn-success' : 'btn-primary');
  btn.onclick = () => {
    state.currentQuestion++;
    showQuestion(levelId);
  };
}

function updateProgress(current, total) {
  const pct = total > 0 ? Math.round((current / total) * 100) : 0;
  document.getElementById('level-progress-fill').style.width = pct + '%';
  document.getElementById('level-progress-text').textContent = pct + '%';
}

// ===================================================================
// SUMMARY
// ===================================================================
function showSummary(levelId) {
  const level = LEVELS[levelId];
  const answers = state.answers[levelId] || [];
  const correct = answers.filter(a => a === 1).length;
  const total = answers.length;
  const pct = Math.round((correct / total) * 100);
  const passed = pct >= 75;
  
  document.getElementById('summary-level-name').textContent = level.title;
  
  let msg, sub;
  if (pct === 100) { msg = '¬°Perfecto!'; sub = 'Dominas este nivel por completo.'; }
  else if (pct >= 75) { msg = '¬°Muy bien!'; sub = 'Has superado el nivel. ¬°Sigue as√≠!'; }
  else if (pct >= 50) { msg = 'Casi lo tienes'; sub = 'Necesitas al menos 75% para avanzar. Revisa la teor√≠a e int√©ntalo de nuevo.'; }
  else { msg = 'Sigue practicando'; sub = 'Revisa bien la teor√≠a antes de intentarlo otra vez.'; }
  
  let breakdownHtml = '';
  level.questions.forEach((q, i) => {
    const ok = answers[i] === 1;
    breakdownHtml += `
      <div class="summary-item">
        <div class="summary-item-icon">${ok ? '‚úÖ' : '‚ùå'}</div>
        <div class="summary-item-text">Pregunta ${i + 1}</div>
        <div class="summary-item-result ${ok ? 'ok' : 'fail'}">${ok ? 'Correcta' : 'Incorrecta'}</div>
      </div>
    `;
  });
  
  document.getElementById('summary-content').innerHTML = `
    <div class="summary-circle" style="border-color: ${passed ? 'var(--green)' : 'var(--gold)'}">
      <div class="summary-score">${correct}</div>
      <div class="summary-total">de ${total}</div>
    </div>
    <div class="summary-message">${msg}</div>
    <div class="summary-sub">${sub}</div>
    <div class="summary-breakdown">
      ${breakdownHtml}
    </div>
    ${!passed ? '<div style="text-align:center;margin-top:12px;"><button class="btn btn-primary" style="display:inline-block;flex:none;padding:12px 28px;" onclick="startLevel('+levelId+')">Reintentar nivel</button></div>' : ''}
  `;
  
  // If passed, unlock next level
  if (passed) {
    if (!state.completedLevels.includes(levelId)) {
      state.completedLevels.push(levelId);
    }
    const next = levelId + 1;
    if (next <= 6 && !state.unlockedLevels.includes(next)) {
      state.unlockedLevels.push(next);
    }
    saveState();
    
    const nextBtn = document.getElementById('btn-next-level');
    if (levelId >= 6) {
      nextBtn.textContent = '¬°M√≥dulo completado! üéâ';
      nextBtn.onclick = () => backToHome();
    } else {
      nextBtn.textContent = 'Siguiente nivel ‚Ä∫';
      nextBtn.onclick = () => goNextLevel();
    }
    nextBtn.style.display = '';
  } else {
    document.getElementById('btn-next-level').style.display = 'none';
  }
  
  showScreen('screen-summary');
}

function goNextLevel() {
  const next = state.currentLevel + 1;
  if (next <= 6) startLevel(next);
  else backToHome();
}

// ===================================================================
// INIT
// ===================================================================
updateHomeCards();
</script>

</body>
</html>
